<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Bezier Moi | cormullion</title>
<meta name="generator" content="Jekyll v3.7.3" />
<meta property="og:title" content="Bezier Moi" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="This post was inspired mostly by the arrival of the new Julia package Literate.jl by Fredrik Ekre. Literate lets you write a Julia source file, a Markdown blog post, and a Jupyter notebook all at the same time. It’s magic, or, at least, indistinguishable from magic… As a result, you might be able to find a Jupyter notebook version of this Markdown-converted Julia source file somewhere nearby (look in the github repo for this blog, perhaps). The code uses the following packages, Literate, Luxor, Colors, Roots, Fontconfig, DataFrames, Iterators, ColorSchemes, and should work in Julia v0.6 (some packages such as Colors have yet to be updated to work with version 0.7)." />
<meta property="og:description" content="This post was inspired mostly by the arrival of the new Julia package Literate.jl by Fredrik Ekre. Literate lets you write a Julia source file, a Markdown blog post, and a Jupyter notebook all at the same time. It’s magic, or, at least, indistinguishable from magic… As a result, you might be able to find a Jupyter notebook version of this Markdown-converted Julia source file somewhere nearby (look in the github repo for this blog, perhaps). The code uses the following packages, Literate, Luxor, Colors, Roots, Fontconfig, DataFrames, Iterators, ColorSchemes, and should work in Julia v0.6 (some packages such as Colors have yet to be updated to work with version 0.7)." />
<link rel="canonical" href="http://localhost:4000/blog/2018/06/21/bezier.html" />
<meta property="og:url" content="http://localhost:4000/blog/2018/06/21/bezier.html" />
<meta property="og:site_name" content="cormullion" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-06-21T01:00:00+01:00" />
<script type="application/ld+json">
{"url":"http://localhost:4000/blog/2018/06/21/bezier.html","headline":"Bezier Moi","dateModified":"2018-06-21T01:00:00+01:00","datePublished":"2018-06-21T01:00:00+01:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/blog/2018/06/21/bezier.html"},"description":"This post was inspired mostly by the arrival of the new Julia package Literate.jl by Fredrik Ekre. Literate lets you write a Julia source file, a Markdown blog post, and a Jupyter notebook all at the same time. It’s magic, or, at least, indistinguishable from magic… As a result, you might be able to find a Jupyter notebook version of this Markdown-converted Julia source file somewhere nearby (look in the github repo for this blog, perhaps). The code uses the following packages, Literate, Luxor, Colors, Roots, Fontconfig, DataFrames, Iterators, ColorSchemes, and should work in Julia v0.6 (some packages such as Colors have yet to be updated to work with version 0.7).","@type":"BlogPosting","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="cormullion" /></head>
<body><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>

<p class="homebutton"><a href="https://cormullion.github.io">home</a></p>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Bezier Moi</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2018-06-21T01:00:00+01:00" itemprop="datePublished">21 June 2018
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <blockquote>
  <p>This post was inspired mostly by the arrival of the new Julia package <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a> by Fredrik Ekre. Literate lets you write a Julia source file, a Markdown blog post, and a Jupyter notebook all at the same time. It’s magic, or, at least, indistinguishable from magic… As a result, you might be able to find a Jupyter notebook version of this Markdown-converted Julia source file somewhere nearby (look in the <a href="https://github.com/cormullion/cormullion.github.io">github repo</a> for this blog, perhaps). The code uses the following packages, Literate, Luxor, Colors, Roots, Fontconfig, DataFrames, Iterators, ColorSchemes, and should work in Julia v0.6 (some packages such as Colors have yet to be updated to work with version 0.7).</p>
</blockquote>

<h1 id="bézier-moi">Bézier moi!</h1>

<p>Luxor provides some support for Bézier curves, but there’s no room for any more documentation—it’s already too big. So the intention of this post is to provide some of the missing information about what’s up with Bézier curves and how you might use them. And I confess in advance to wasting some of your bandwidth with some pointlessly colourful graphics.</p>

<p>There’s not a lot of mathematical material here, but fortunately the internet is <em>awash</em> with high-quality information about Bézier curves. The two articles you should definitely read instead of this post, or at least before, are:</p>

<ul>
  <li>
    <p><a href="https://pomax.github.io/bezierinfo/">https://pomax.github.io/bezierinfo/</a>  An exhaustive and exhausting examination of Bézier curves by Mike ‘Pomax’ Kamermans, Mozilla JavaScript guru, complete with interactive JavaScript graphics.</p>
  </li>
  <li>
    <p><a href="http://mae.engr.ucdavis.edu/~farouki/bernstein.pdf">http://mae.engr.ucdavis.edu/~farouki/bernstein.pdf</a> A paper exploring the history and mathematics of curves by Professor Rida T. Farouki (University of California Davis).</p>
  </li>
</ul>

<h2 id="historical-background">Historical background</h2>

<p>The story is quite well known: two engineers employed in the French car industry, <em>Paul de Faget de Casteljau</em>, at Citroen, and <em>Pierre Etienne Bézier</em>, at Renault, worked—mostly independently—on the mathematics of curves in the early 1960s, as the industry made its first tentative steps towards using computers for design and production.</p>

<p><img src="/images/bezier/2560px-Bornholm_Rundt_2012.jpg" alt="Citroen DS" /></p>

<p>(This is the Citroen DS, which was once voted the most beautiful car ever made, apparently. Image from the WikiMedia Commons photographed by <a href="https://commons.wikimedia.org/w/index.php?curid=28638457">Klugschnacker</a>)</p>

<p>De Casteljau and Bézier were interested in mathematical tools that would allow designers to intuitively construct and manipulate complex shapes. This problem was especially critical for “free–form” shapes that couldn’t easily be specified by centre points, axes, angles, and dimensions. The motivation was also partly to replace the laborious, variable, and expensive process of sculpting clay models to specify the desired shape.</p>

<p>De Casteljau found some resistance when his mathematical researches were introduced into the design studio. He observed that:</p>

<blockquote>
  <p>the designers were astonished and scandalized. Was it some kind of joke? It was considered nonsense to represent a car body mathematically. It was enough to please the eye, the word ‘accuracy’ had no meaning. [quoted in Farouki]</p>
</blockquote>

<p>Bézier popularized, but did not actually create, what we know today as the Bézier curve. He mainly developed the notation, and devised the idea of nodes with attached “control handles”, which the designers could use to adjust the shapes as easily as they used the turn indicators on their beloved Citroen DSs.</p>

<p>De Casteljau is also remembered for the <a href="https://en.wikipedia.org/wiki/De_Casteljau%27s_algorithm">algorithm</a> that bears his name.</p>

<h2 id="the-shortest-distance">The shortest distance?</h2>

<p>With the lingering thought of old Renaults and Citroens in mind, it’s tempting to think of a Bézier curve as a line that takes, not the shortest distance between two points, but takes instead the scenic route.</p>

<p>Let’s define four points:</p>

<figure class="highlight"><pre><code class="language-julia" data-lang="julia"><span class="n">using</span> <span class="n">Luxor</span>
<span class="n">P1</span>  <span class="o">=</span> <span class="n">Point</span><span class="x">(</span><span class="o">-</span><span class="mi">200</span><span class="x">,</span> <span class="mi">0</span><span class="x">)</span>
<span class="n">CP1</span> <span class="o">=</span> <span class="n">Point</span><span class="x">(</span><span class="o">-</span><span class="mi">100</span><span class="x">,</span> <span class="o">-</span><span class="mi">100</span><span class="x">)</span>
<span class="n">CP2</span> <span class="o">=</span> <span class="n">Point</span><span class="x">(</span><span class="mi">100</span><span class="x">,</span> <span class="o">-</span><span class="mi">100</span><span class="x">)</span>
<span class="n">P2</span>  <span class="o">=</span> <span class="n">Point</span><span class="x">(</span><span class="mi">200</span><span class="x">,</span> <span class="mi">0</span><span class="x">)</span>
<span class="nd">@png</span> <span class="n">begin</span>
    <span class="n">circle</span><span class="o">.</span><span class="x">([</span><span class="n">P1</span><span class="x">,</span> <span class="n">CP1</span><span class="x">,</span> <span class="n">CP2</span><span class="x">,</span> <span class="n">P2</span><span class="x">],</span> <span class="mi">5</span><span class="x">,</span> <span class="x">:</span><span class="n">fill</span><span class="x">)</span>
    <span class="n">label</span><span class="o">.</span><span class="x">([</span><span class="s">"P1"</span><span class="x">,</span> <span class="s">"CP1"</span><span class="x">,</span> <span class="s">"CP2"</span><span class="x">,</span> <span class="s">"P2"</span><span class="x">],</span> <span class="x">:</span><span class="n">N</span><span class="x">,</span> <span class="x">[</span><span class="n">P1</span><span class="x">,</span> <span class="n">CP1</span><span class="x">,</span> <span class="n">CP2</span><span class="x">,</span> <span class="n">P2</span><span class="x">],</span> <span class="n">offset</span><span class="o">=</span><span class="mi">10</span><span class="x">)</span>
<span class="k">end</span> <span class="mi">800</span> <span class="mi">300</span> <span class="s">"images/bezier/fourpoints.png"</span></code></pre></figure>

<p><img src="/images/bezier/fourpoints.png" alt="four points" /></p>

<p>The first and last points, P1 and P2, are the start and end of the line. The second point, CP1, controls the direction of the line as it leaves the first point, and the third point, CP2, determines the way the line approaches the fourth point. PostScript guru Don Lancaster (see footnote) uses the terms ‘influence point’ and ‘enthusiasm’—so the second influence point determines the enthusiasm with which the curve travels towards its final destination.</p>

<p>The graphics primitive <code class="highlighter-rouge">curve()</code> function draws a Bézier curve between P1 and P2, taking into account the positions of control points CP1 and CP2. It takes just three points, using the current position as the starting point.</p>

<figure class="highlight"><pre><code class="language-julia" data-lang="julia"><span class="n">using</span> <span class="n">Colors</span>
<span class="nd">@png</span> <span class="n">begin</span>
    <span class="n">sethue</span><span class="x">(</span><span class="s">"red"</span><span class="x">)</span>
    <span class="n">label</span><span class="o">.</span><span class="x">([</span><span class="s">"P1"</span><span class="x">,</span> <span class="s">"CP1"</span><span class="x">,</span> <span class="s">"CP2"</span><span class="x">,</span> <span class="s">"P2"</span><span class="x">],</span> <span class="x">:</span><span class="n">N</span><span class="x">,</span> <span class="x">[</span><span class="n">P1</span><span class="x">,</span> <span class="n">CP1</span><span class="x">,</span> <span class="n">CP2</span><span class="x">,</span> <span class="n">P2</span><span class="x">])</span>
    <span class="n">line</span><span class="x">(</span><span class="n">P1</span><span class="x">,</span> <span class="n">CP1</span><span class="x">,:</span><span class="n">stroke</span><span class="x">)</span>
    <span class="n">line</span><span class="x">(</span><span class="n">CP2</span><span class="x">,</span> <span class="n">P2</span><span class="x">,:</span><span class="n">stroke</span><span class="x">)</span>
    <span class="n">sethue</span><span class="x">(</span><span class="s">"black"</span><span class="x">)</span>
    <span class="n">move</span><span class="x">(</span><span class="n">P1</span><span class="x">)</span>
    <span class="n">curve</span><span class="x">(</span><span class="n">CP1</span><span class="x">,</span> <span class="n">CP2</span><span class="x">,</span> <span class="n">P2</span><span class="x">)</span>
    <span class="n">strokepath</span><span class="x">()</span>
    <span class="n">circle</span><span class="o">.</span><span class="x">([</span><span class="n">P1</span><span class="x">,</span> <span class="n">CP1</span><span class="x">,</span> <span class="n">CP2</span><span class="x">,</span> <span class="n">P2</span><span class="x">],</span> <span class="mi">3</span><span class="x">,</span> <span class="x">:</span><span class="n">fill</span><span class="x">)</span>
<span class="k">end</span> <span class="mi">800</span> <span class="mi">300</span> <span class="s">"images/bezier/curve.png"</span></code></pre></figure>

<p><img src="/images/bezier/curve.png" alt="simple bezier curve" /></p>

<p>The control points are like handles, controlling the shape of the curve. If you’ve used Adobe Illustrator or some other vector graphics software, you’ll be familiar with the idea of interactively dragging the handles around to get interesting curves. In Luxor, though, we sacrifice interactivity in favour of ruthless machine-driven automation. In the following animation, the control handles explore the geometry of a couple of hypotrochoids, while the helpless Bézier curve is pinned between them and forced into sinuous contortions:</p>

<h1><img src="/images/bezier/animation.gif" alt="animation gif" /></h1>

<p>Can I make this in Adobe Illustrator? Hold my beer…</p>

<p>While you’re waiting, have a look at another animation; this is my artist’s impression of the De Casteljau algorithm dividing the control polygons around a Bézier curve as the parameter <code class="highlighter-rouge">n</code> moves from 0 to 1. The idea is that as <code class="highlighter-rouge">p1</code> divides <code class="highlighter-rouge">A</code> to <code class="highlighter-rouge">A1</code>, <code class="highlighter-rouge">p2</code> divides <code class="highlighter-rouge">A1</code> to <code class="highlighter-rouge">B1</code> and <code class="highlighter-rouge">p3</code> divides <code class="highlighter-rouge">B1</code> to <code class="highlighter-rouge">B</code>. So, <code class="highlighter-rouge">pp1</code> divides <code class="highlighter-rouge">p1</code> to <code class="highlighter-rouge">p2</code>, and <code class="highlighter-rouge">pp2</code> divides <code class="highlighter-rouge">p2</code> to <code class="highlighter-rouge">p3</code>. And you keep doing this until you can’t divide any more, and eventually the point <code class="highlighter-rouge">P</code> plots the course of the final Bézier curve. The red and blue parts of the curve show that this technique is also a good way to split a single Bézier curve into two separate ones, and the red and blue parts are separate control polygons.</p>

<p><img src="/images/bezier/decasteljau.gif" alt="De Casteljau" /></p>

<p>In Luxor, a <code class="highlighter-rouge">BezierPathSegment</code> type contains four 2D points, stored in the fields <code class="highlighter-rouge">p1</code>, <code class="highlighter-rouge">cp1</code>, <code class="highlighter-rouge">cp2</code>, and <code class="highlighter-rouge">p2</code>, and a <code class="highlighter-rouge">BezierPath</code> is an array of one or more of these BezierPathSegments. The <code class="highlighter-rouge">drawbezierpath()</code> function draws a BezierPath or BezierPathSegment, with similar results to the <code class="highlighter-rouge">curve()</code> function:</p>

<figure class="highlight"><pre><code class="language-julia" data-lang="julia"><span class="nd">@png</span> <span class="n">begin</span>
    <span class="n">P1</span>  <span class="o">=</span> <span class="n">Point</span><span class="x">(</span><span class="o">-</span><span class="mi">200</span><span class="x">,</span> <span class="mi">0</span><span class="x">)</span>
    <span class="n">CP1</span> <span class="o">=</span> <span class="n">Point</span><span class="x">(</span><span class="o">-</span><span class="mi">100</span><span class="x">,</span> <span class="o">-</span><span class="mi">100</span><span class="x">)</span>
    <span class="n">CP2</span> <span class="o">=</span> <span class="n">Point</span><span class="x">(</span><span class="mi">100</span><span class="x">,</span> <span class="o">-</span><span class="mi">100</span><span class="x">)</span>
    <span class="n">P2</span>  <span class="o">=</span> <span class="n">Point</span><span class="x">(</span><span class="mi">200</span><span class="x">,</span> <span class="mi">0</span><span class="x">)</span>

    <span class="n">sethue</span><span class="x">(</span><span class="s">"red"</span><span class="x">)</span>
    <span class="n">label</span><span class="o">.</span><span class="x">([</span><span class="s">"P1"</span><span class="x">,</span> <span class="s">"CP1"</span><span class="x">,</span> <span class="s">"CP2"</span><span class="x">,</span> <span class="s">"P2"</span><span class="x">],</span> <span class="x">:</span><span class="n">N</span><span class="x">,</span> <span class="x">[</span><span class="n">P1</span><span class="x">,</span> <span class="n">CP1</span><span class="x">,</span> <span class="n">CP2</span><span class="x">,</span> <span class="n">P2</span><span class="x">])</span>
    <span class="n">line</span><span class="x">(</span><span class="n">P1</span><span class="x">,</span> <span class="n">CP1</span><span class="x">,:</span><span class="n">stroke</span><span class="x">)</span>
    <span class="n">line</span><span class="x">(</span><span class="n">P2</span><span class="x">,</span> <span class="n">CP2</span><span class="x">,:</span><span class="n">stroke</span><span class="x">)</span>
    <span class="n">sethue</span><span class="x">(</span><span class="s">"black"</span><span class="x">)</span>

    <span class="n">beziersegment</span> <span class="o">=</span> <span class="n">BezierPathSegment</span><span class="x">(</span><span class="n">P1</span><span class="x">,</span> <span class="n">CP1</span><span class="x">,</span> <span class="n">CP2</span><span class="x">,</span> <span class="n">P2</span><span class="x">)</span>
    <span class="n">circle</span><span class="o">.</span><span class="x">(</span><span class="n">beziersegment</span><span class="x">,</span> <span class="mi">3</span><span class="x">,</span> <span class="x">:</span><span class="n">fill</span><span class="x">)</span>
    <span class="n">drawbezierpath</span><span class="x">(</span><span class="n">beziersegment</span><span class="x">,</span> <span class="x">:</span><span class="n">stroke</span><span class="x">)</span>
<span class="k">end</span> <span class="mi">800</span> <span class="mi">250</span> <span class="s">"images/bezier/drawbezierpath.png"</span></code></pre></figure>

<p><img src="/images/bezier/drawbezierpath.png" alt="draw a Bezier path" /></p>

<p>This last function, <code class="highlighter-rouge">drawbezierpath()</code> is a typical Luxor drawing function, in that you can provide <code class="highlighter-rouge">:fill</code> as an alternative action to <code class="highlighter-rouge">:stroke</code>.</p>

<p>An easy way to make a BezierPath is to use <code class="highlighter-rouge">makebezierpath()</code> and supply a polygon. For example, let’s make a triangle with <code class="highlighter-rouge">ngon()</code> and use it as the skeleton for a new Bézier path:</p>

<figure class="highlight"><pre><code class="language-julia" data-lang="julia"><span class="nd">@png</span> <span class="n">begin</span>
    <span class="n">sethue</span><span class="x">(</span><span class="s">"red"</span><span class="x">)</span>
    <span class="n">triangle</span> <span class="o">=</span> <span class="n">ngon</span><span class="x">(</span><span class="n">O</span><span class="x">,</span> <span class="mi">120</span><span class="x">,</span> <span class="mi">3</span><span class="x">,</span> <span class="n">vertices</span><span class="o">=</span><span class="n">true</span><span class="x">)</span>
    <span class="n">poly</span><span class="x">(</span><span class="n">triangle</span><span class="x">,</span> <span class="x">:</span><span class="n">stroke</span><span class="x">,</span> <span class="n">close</span><span class="o">=</span><span class="n">true</span><span class="x">)</span>

    <span class="n">sethue</span><span class="x">(</span><span class="s">"black"</span><span class="x">)</span>
    <span class="n">bezierpath</span> <span class="o">=</span> <span class="n">makebezierpath</span><span class="x">(</span><span class="n">triangle</span><span class="x">)</span>
    <span class="n">drawbezierpath</span><span class="x">(</span><span class="n">bezierpath</span><span class="x">,</span> <span class="x">:</span><span class="n">stroke</span><span class="x">)</span>
    <span class="n">circle</span><span class="o">.</span><span class="x">(</span><span class="n">triangle</span><span class="x">,</span> <span class="mi">5</span><span class="x">,</span> <span class="x">:</span><span class="n">fill</span><span class="x">)</span>

    <span class="k">for</span> <span class="n">bps</span> <span class="k">in</span> <span class="n">bezierpath</span>
        <span class="n">circle</span><span class="o">.</span><span class="x">(</span><span class="n">bps</span><span class="x">,</span> <span class="mi">3</span><span class="x">,</span> <span class="x">:</span><span class="n">fill</span><span class="x">)</span>
        <span class="n">line</span><span class="x">(</span><span class="n">bps</span><span class="x">[</span><span class="mi">1</span><span class="x">],</span> <span class="n">bps</span><span class="x">[</span><span class="mi">2</span><span class="x">],</span> <span class="x">:</span><span class="n">stroke</span><span class="x">)</span>
        <span class="n">line</span><span class="x">(</span><span class="n">bps</span><span class="x">[</span><span class="mi">3</span><span class="x">],</span> <span class="n">bps</span><span class="x">[</span><span class="mi">4</span><span class="x">],</span> <span class="x">:</span><span class="n">stroke</span><span class="x">)</span>
    <span class="k">end</span>

    <span class="n">label</span><span class="o">.</span><span class="x">([</span><span class="s">"p1"</span><span class="x">,</span> <span class="s">"p2"</span><span class="x">,</span> <span class="s">"p3"</span><span class="x">],</span> <span class="x">[:</span><span class="n">S</span><span class="x">,</span> <span class="x">:</span><span class="n">NW</span><span class="x">,</span> <span class="x">:</span><span class="n">E</span><span class="x">],</span> <span class="n">triangle</span><span class="x">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">10</span><span class="x">)</span>
<span class="k">end</span> <span class="mi">800</span> <span class="mi">400</span> <span class="s">"images/bezier/makebezierpath.png"</span></code></pre></figure>

<p><img src="/images/bezier/makebezierpath.png" alt="make bezier path" /></p>

<p>Here <code class="highlighter-rouge">makebezierpath()</code> converted the three points into an array of three separate Bézier path segments. The control points are positioned so that the curve flows freely from one segment to the segment.</p>

<h2 id="going-straight">Going straight</h2>

<p>Bézier curves can have straight bits too. This animation shows the control points moving towards the points they’re controlling. When they merge, the Bézier path appears to become a series of straight lines:</p>

<figure class="highlight"><pre><code class="language-julia" data-lang="julia"><span class="k">function</span><span class="nf"> frame</span><span class="x">(</span><span class="n">scene</span><span class="x">,</span> <span class="n">framenumber</span><span class="x">)</span>
    <span class="n">background</span><span class="x">(</span><span class="s">"white"</span><span class="x">)</span>
    <span class="n">eased_n</span> <span class="o">=</span> <span class="n">scene</span><span class="o">.</span><span class="n">easingfunction</span><span class="x">(</span><span class="n">framenumber</span><span class="x">,</span> <span class="mi">0</span><span class="x">,</span> <span class="mi">1</span><span class="x">,</span> <span class="n">scene</span><span class="o">.</span><span class="n">framerange</span><span class="o">.</span><span class="n">stop</span><span class="x">)</span>
    <span class="n">sethue</span><span class="x">(</span><span class="s">"red"</span><span class="x">)</span>
    <span class="n">triangle</span> <span class="o">=</span> <span class="n">ngon</span><span class="x">(</span><span class="n">O</span><span class="x">,</span> <span class="mi">120</span><span class="x">,</span> <span class="mi">3</span><span class="x">,</span> <span class="n">vertices</span><span class="o">=</span><span class="n">true</span><span class="x">)</span>
    <span class="n">poly</span><span class="x">(</span><span class="n">triangle</span><span class="x">,</span> <span class="x">:</span><span class="n">stroke</span><span class="x">,</span> <span class="n">close</span><span class="o">=</span><span class="n">true</span><span class="x">)</span>
    <span class="n">sethue</span><span class="x">(</span><span class="s">"black"</span><span class="x">)</span>
    <span class="n">bezierpath</span> <span class="o">=</span> <span class="n">makebezierpath</span><span class="x">(</span><span class="n">triangle</span><span class="x">)</span>
    <span class="n">newbezierpath</span> <span class="o">=</span> <span class="n">BezierPath</span><span class="x">()</span>
    <span class="k">for</span> <span class="n">bps</span> <span class="k">in</span> <span class="n">bezierpath</span>
        <span class="n">push!</span><span class="x">(</span><span class="n">newbezierpath</span><span class="x">,</span>
            <span class="n">BezierPathSegment</span><span class="x">(</span><span class="n">bps</span><span class="o">.</span><span class="n">p1</span><span class="x">,</span>
             <span class="n">between</span><span class="x">(</span><span class="n">bps</span><span class="o">.</span><span class="n">cp1</span><span class="x">,</span> <span class="n">bps</span><span class="o">.</span><span class="n">p1</span><span class="x">,</span> <span class="n">eased_n</span><span class="x">),</span>
             <span class="n">between</span><span class="x">(</span><span class="n">bps</span><span class="o">.</span><span class="n">cp2</span><span class="x">,</span> <span class="n">bps</span><span class="o">.</span><span class="n">p2</span><span class="x">,</span> <span class="n">eased_n</span><span class="x">),</span>
             <span class="n">bps</span><span class="o">.</span><span class="n">p2</span><span class="x">))</span>
    <span class="k">end</span>
    <span class="k">for</span> <span class="n">bps</span> <span class="k">in</span> <span class="n">newbezierpath</span>
        <span class="n">circle</span><span class="o">.</span><span class="x">(</span><span class="n">bps</span><span class="x">,</span> <span class="mi">3</span><span class="x">,</span> <span class="x">:</span><span class="n">fill</span><span class="x">)</span>
        <span class="n">line</span><span class="x">(</span><span class="n">bps</span><span class="o">.</span><span class="n">p1</span><span class="x">,</span> <span class="n">bps</span><span class="o">.</span><span class="n">cp1</span><span class="x">,</span> <span class="x">:</span><span class="n">stroke</span><span class="x">)</span>
        <span class="n">line</span><span class="x">(</span><span class="n">bps</span><span class="o">.</span><span class="n">cp2</span><span class="x">,</span> <span class="n">bps</span><span class="o">.</span><span class="n">p2</span><span class="x">,</span> <span class="x">:</span><span class="n">stroke</span><span class="x">)</span>
    <span class="k">end</span>
    <span class="n">drawbezierpath</span><span class="x">(</span><span class="n">newbezierpath</span><span class="x">,</span> <span class="x">:</span><span class="n">stroke</span><span class="x">)</span>
<span class="k">end</span>

<span class="n">width</span><span class="x">,</span> <span class="n">height</span> <span class="o">=</span> <span class="x">(</span><span class="mi">256</span><span class="x">,</span> <span class="mi">256</span><span class="x">)</span>

<span class="n">bedtimemovie</span> <span class="o">=</span> <span class="n">Movie</span><span class="x">(</span><span class="n">width</span><span class="x">,</span> <span class="n">height</span><span class="x">,</span> <span class="s">"bedtimemovie"</span><span class="x">)</span>
<span class="c"># probably requires ffmpeg installed</span>
<span class="n">animate</span><span class="x">(</span><span class="n">bedtimemovie</span><span class="x">,</span> <span class="x">[</span><span class="n">Scene</span><span class="x">(</span><span class="n">bedtimemovie</span><span class="x">,</span> <span class="n">frame</span><span class="x">,</span> <span class="mi">1</span><span class="x">:</span><span class="mi">150</span><span class="x">,</span> <span class="n">easingfunction</span><span class="o">=</span><span class="n">easeoutquad</span><span class="x">)],</span> <span class="n">creategif</span><span class="o">=</span><span class="n">true</span><span class="x">,</span> <span class="n">framerate</span><span class="o">=</span><span class="mi">30</span><span class="x">,</span> <span class="n">pathname</span><span class="o">=</span><span class="s">"images/bezier/bedtimemovie.gif"</span><span class="x">)</span></code></pre></figure>

<h1 id="-1"><img src="/images/bezier/bedtimemovie.gif" alt="bedtime for Béziers" /></h1>

<p>This is a process known to very young Adobe Illustrator users as ‘putting the Bézier handles to bed’.</p>

<p>It’s also fun to move the control points somewhere else. Here, they’re multiplied by 2, while the first and last points are left unchanged:</p>

<figure class="highlight"><pre><code class="language-julia" data-lang="julia"><span class="nd">@png</span> <span class="n">begin</span>
    <span class="n">sethue</span><span class="x">(</span><span class="s">"red"</span><span class="x">)</span>
    <span class="n">triangle</span> <span class="o">=</span> <span class="n">ngon</span><span class="x">(</span><span class="n">O</span><span class="x">,</span> <span class="mi">100</span><span class="x">,</span> <span class="mi">3</span><span class="x">,</span> <span class="n">vertices</span><span class="o">=</span><span class="n">true</span><span class="x">)</span>
    <span class="n">poly</span><span class="x">(</span><span class="n">triangle</span><span class="x">,</span> <span class="x">:</span><span class="n">stroke</span><span class="x">,</span> <span class="n">close</span><span class="o">=</span><span class="n">true</span><span class="x">)</span>

    <span class="n">sethue</span><span class="x">(</span><span class="s">"purple"</span><span class="x">)</span>
    <span class="n">bezierpath</span> <span class="o">=</span> <span class="n">makebezierpath</span><span class="x">(</span><span class="n">triangle</span><span class="x">)</span>
    <span class="n">drawbezierpath</span><span class="x">(</span><span class="n">bezierpath</span><span class="x">,</span> <span class="x">:</span><span class="n">stroke</span><span class="x">)</span>
    <span class="n">sethue</span><span class="x">(</span><span class="s">"magenta"</span><span class="x">)</span>
    <span class="k">for</span> <span class="n">bps</span> <span class="k">in</span> <span class="n">bezierpath</span>
        <span class="n">bps</span> <span class="o">=</span> <span class="n">BezierPathSegment</span><span class="x">(</span><span class="n">bps</span><span class="x">[</span><span class="mi">1</span><span class="x">],</span> <span class="mi">2</span><span class="n">bps</span><span class="x">[</span><span class="mi">2</span><span class="x">],</span> <span class="mi">2</span><span class="n">bps</span><span class="x">[</span><span class="mi">3</span><span class="x">],</span> <span class="n">bps</span><span class="x">[</span><span class="mi">4</span><span class="x">])</span>
        <span class="n">drawbezierpath</span><span class="x">(</span><span class="n">bps</span><span class="x">,</span> <span class="x">:</span><span class="n">stroke</span><span class="x">)</span>
    <span class="k">end</span>

<span class="k">end</span> <span class="mi">800</span> <span class="mi">400</span> <span class="s">"images/bezier/movecontrolpoints.png"</span></code></pre></figure>

<p><img src="/images/bezier/movecontrolpoints.png" alt="moving control points" /></p>

<p>We could make even more copies, multiplying the control points each time through:</p>

<figure class="highlight"><pre><code class="language-julia" data-lang="julia"><span class="nd">@png</span> <span class="n">begin</span>
    <span class="n">setline</span><span class="x">(</span><span class="o">.</span><span class="mi">5</span><span class="x">)</span>
    <span class="n">pgon</span> <span class="o">=</span> <span class="n">ngon</span><span class="x">(</span><span class="n">O</span><span class="x">,</span> <span class="mi">100</span><span class="x">,</span> <span class="mi">3</span><span class="x">,</span> <span class="n">vertices</span><span class="o">=</span><span class="n">true</span><span class="x">)</span>
    <span class="n">bezierpath</span> <span class="o">=</span> <span class="n">makebezierpath</span><span class="x">(</span><span class="n">pgon</span><span class="x">)</span>

    <span class="k">for</span> <span class="n">bpseg</span> <span class="k">in</span> <span class="n">bezierpath</span>
        <span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="mi">1</span><span class="x">:</span><span class="mi">20</span>
            <span class="n">bpseg</span><span class="o">.</span><span class="n">cp1</span> <span class="o">*=</span> <span class="mf">1.05</span>
            <span class="n">bpseg</span><span class="o">.</span><span class="n">cp2</span> <span class="o">*=</span> <span class="mf">1.05</span>
            <span class="n">drawbezierpath</span><span class="x">(</span><span class="n">bpseg</span><span class="x">,</span> <span class="x">:</span><span class="n">stroke</span><span class="x">)</span>
        <span class="k">end</span>
    <span class="k">end</span>
<span class="k">end</span> <span class="mi">800</span> <span class="mi">400</span> <span class="s">"images/bezier/movecontrolpointsmore.png"</span></code></pre></figure>

<p><img src="/images/bezier/movecontrolpointsmore.png" alt="moving multiple control points" /></p>

<p>Try changing the initial triangle to a pentagon or heptagon by changing the <code class="highlighter-rouge">3</code> in <code class="highlighter-rouge">ngon()</code>. And try multiplying by less than 1.05 too…</p>

<p>Should you ever want to draw Bézier curves “the hard way”, try this. The standard Bézier function is available in Luxor as <code class="highlighter-rouge">bezier()</code>, and we could draw a small hue-varying circle at each point:</p>

<figure class="highlight"><pre><code class="language-julia" data-lang="julia"><span class="nd">@png</span> <span class="n">begin</span>
    <span class="n">setopacity</span><span class="x">(</span><span class="mf">0.6</span><span class="x">)</span>
    <span class="n">P1</span>  <span class="o">=</span> <span class="n">Point</span><span class="x">(</span><span class="o">-</span><span class="mi">250</span><span class="x">,</span> <span class="mi">0</span><span class="x">)</span>
    <span class="n">CP1</span> <span class="o">=</span> <span class="n">Point</span><span class="x">(</span><span class="o">-</span><span class="mi">200</span><span class="x">,</span> <span class="o">-</span><span class="mi">150</span><span class="x">)</span>
    <span class="n">CP2</span> <span class="o">=</span> <span class="n">Point</span><span class="x">(</span><span class="mi">200</span><span class="x">,</span> <span class="o">-</span><span class="mi">150</span><span class="x">)</span>
    <span class="n">P2</span>  <span class="o">=</span> <span class="n">Point</span><span class="x">(</span><span class="mi">250</span><span class="x">,</span> <span class="mi">0</span><span class="x">)</span>
    <span class="n">circle</span><span class="o">.</span><span class="x">([</span><span class="n">P1</span><span class="x">,</span> <span class="n">CP1</span><span class="x">,</span> <span class="n">CP2</span><span class="x">,</span> <span class="n">P2</span><span class="x">],</span> <span class="mi">3</span><span class="x">,</span> <span class="x">:</span><span class="n">fill</span><span class="x">)</span>

    <span class="k">for</span> <span class="n">u</span> <span class="k">in</span> <span class="mf">0.0</span><span class="x">:</span><span class="mf">0.025</span><span class="x">:</span><span class="mf">1.0</span>
        <span class="n">sethue</span><span class="x">(</span><span class="n">Colors</span><span class="o">.</span><span class="n">HSV</span><span class="x">(</span><span class="n">rescale</span><span class="x">(</span><span class="n">u</span><span class="x">,</span> <span class="mi">0</span><span class="x">,</span> <span class="mi">1</span><span class="x">,</span> <span class="mi">0</span><span class="x">,</span> <span class="mi">360</span><span class="x">),</span> <span class="mi">1</span><span class="x">,</span> <span class="mi">1</span><span class="x">))</span>
        <span class="n">pt</span> <span class="o">=</span> <span class="n">bezier</span><span class="x">(</span><span class="n">u</span><span class="x">,</span> <span class="n">P1</span><span class="x">,</span> <span class="n">CP1</span><span class="x">,</span> <span class="n">CP2</span><span class="x">,</span> <span class="n">P2</span><span class="x">)</span>
        <span class="n">circle</span><span class="x">(</span><span class="n">pt</span><span class="x">,</span> <span class="mi">5</span><span class="x">,</span> <span class="x">:</span><span class="n">fill</span><span class="x">)</span>
    <span class="k">end</span>

<span class="k">end</span> <span class="mi">800</span> <span class="mi">400</span> <span class="s">"images/bezier/thehardway.png"</span></code></pre></figure>

<p><img src="/images/bezier/thehardway.png" alt="bezier the hard way" /></p>

<p>What happens if you step <code class="highlighter-rouge">u</code> from say, -25.0 to 25.0? And is that supposed to happen? (Spoiler: the curve doubles back and shoots off to <code class="highlighter-rouge">(±∞/∞)</code>.)</p>

<h2 id="out-of-control">Out of control</h2>

<p>Suppose you wanted to draw a Bézier curve but you didn’t know where the control points were, but you did know a couple of points that should lie on the line? Again, Luxor has the answer for you, in the form of a function called <code class="highlighter-rouge">bezierfrompoints()</code>. You supply four points, and the function returns the points of the Bézier curve that passes through them.</p>

<figure class="highlight"><pre><code class="language-julia" data-lang="julia"><span class="nd">@png</span> <span class="n">begin</span>
    <span class="n">sethue</span><span class="x">(</span><span class="s">"grey80"</span><span class="x">)</span>
    <span class="n">box</span><span class="x">(</span><span class="n">O</span><span class="x">,</span> <span class="mi">120</span><span class="x">,</span> <span class="mi">100</span><span class="x">,</span> <span class="x">:</span><span class="n">stroke</span><span class="x">)</span>
    <span class="n">corners</span> <span class="o">=</span> <span class="n">box</span><span class="x">(</span><span class="n">O</span><span class="x">,</span> <span class="mi">120</span><span class="x">,</span> <span class="mi">100</span><span class="x">,</span> <span class="n">vertices</span><span class="o">=</span><span class="n">true</span><span class="x">)</span>
    <span class="n">label</span><span class="o">.</span><span class="x">([</span><span class="s">"1"</span><span class="x">,</span> <span class="s">"2"</span><span class="x">,</span><span class="s">"3"</span><span class="x">,</span> <span class="s">"4"</span><span class="x">],</span> <span class="x">:</span><span class="n">se</span><span class="x">,</span> <span class="n">corners</span><span class="x">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">10</span><span class="x">)</span>
    <span class="n">sethue</span><span class="x">(</span><span class="s">"red"</span><span class="x">)</span>
    <span class="n">circle</span><span class="o">.</span><span class="x">(</span><span class="n">corners</span><span class="x">,</span> <span class="mi">5</span><span class="x">,</span> <span class="x">:</span><span class="n">fill</span><span class="x">)</span>

    <span class="n">startpoint</span><span class="x">,</span> <span class="n">cp1</span><span class="x">,</span> <span class="n">cp2</span><span class="x">,</span> <span class="n">endpoint</span>  <span class="o">=</span> <span class="n">bezierfrompoints</span><span class="x">(</span><span class="n">corners</span><span class="o">...</span><span class="x">)</span>

    <span class="n">sethue</span><span class="x">(</span><span class="s">"purple"</span><span class="x">)</span>
    <span class="n">line</span><span class="x">(</span><span class="n">startpoint</span><span class="x">,</span> <span class="n">cp1</span><span class="x">,</span> <span class="x">:</span><span class="n">stroke</span><span class="x">)</span>
    <span class="n">line</span><span class="x">(</span><span class="n">endpoint</span><span class="x">,</span> <span class="n">cp2</span><span class="x">,</span> <span class="x">:</span><span class="n">stroke</span><span class="x">)</span>

    <span class="n">sethue</span><span class="x">(</span><span class="s">"turquoise"</span><span class="x">)</span>
    <span class="n">circle</span><span class="o">.</span><span class="x">([</span><span class="n">cp1</span><span class="x">,</span> <span class="n">cp2</span><span class="x">,</span> <span class="n">startpoint</span><span class="x">,</span> <span class="n">endpoint</span><span class="x">],</span> <span class="mi">3</span><span class="x">,</span> <span class="x">:</span><span class="n">fill</span><span class="x">)</span>

    <span class="n">sethue</span><span class="x">(</span><span class="s">"blue"</span><span class="x">)</span>
    <span class="n">drawbezierpath</span><span class="x">(</span><span class="n">BezierPathSegment</span><span class="x">(</span><span class="n">startpoint</span><span class="x">,</span> <span class="n">cp1</span><span class="x">,</span> <span class="n">cp2</span><span class="x">,</span> <span class="n">endpoint</span><span class="x">),</span> <span class="x">:</span><span class="n">stroke</span><span class="x">)</span>
<span class="k">end</span> <span class="mi">800</span> <span class="mi">300</span> <span class="s">"images/bezier/bezierfrompoints.png"</span></code></pre></figure>

<p><img src="/images/bezier/bezierfrompoints.png" alt="bezier through four points" /></p>

<p>Note that this function returns all four points, but of course you already knew the first and last ones (in <code class="highlighter-rouge">corners</code>), you just wanted the two control points.</p>

<h2 id="on-the-right-path">On the right path?</h2>

<p>In Luxor the three main ways to make graphic lines and shapes are: <em>paths</em>, <em>polygons</em>, and <em>BezierPaths</em>. Paths are the fundamental building blocks of graphics, consisting of one or more sequences of straight and Bézier curves. A polygon is an array of points, which will be converted to a path when you draw it. And BezierPaths consist of a list of BezierPathSegments, which will also be converted to ordinary paths when they’re drawn.</p>

<p>It’s useful to be able to convert between the different types:</p>

<table>
  <thead>
    <tr>
      <th>Function</th>
      <th>Converts</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="highlighter-rouge">makebezierpath(pgon)</code></td>
      <td>polygon to BezierPath</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">pathtopoly()</code></td>
      <td>current path to array of polygons</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">pathtobezierpaths()</code></td>
      <td>current path to array of BezierPaths</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">beziertopoly(bpseg)</code></td>
      <td>BezierPathSegment to polygon</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">bezierpathtopoly(bezierpath)</code></td>
      <td>BezierPath to polygon</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">bezierfrompoints(p1, p2, p3, p4)</code></td>
      <td>convert four points to BezierPathSegment</td>
    </tr>
  </tbody>
</table>

<h2 id="cant-draw-a-circle">Can’t draw a circle?</h2>

<p>Having witnessed the ability of a simple Bézier curve to adopt so many shapes, it’s a bit surprising to find out that you can’t use a Bézier curve to draw a circle. Well, it can do a very good impression of one, of course, but mathematically it can’t produce a purely circular curve. You can see this if you draw a <em>very</em> large circle and a <em>very</em> large matching Bézier segment. For a circle with radius 10 meters (and that’s one big PDF), the discrepancy between the pure circle and the Bézier approximation isn’t much bigger than the size of this period/full stop.←</p>

<p>We non-scientists are lucky in not having to worry about errors of this magnitude…</p>

<h1 id="-2"><img src="/images/bezier/10metrecircle.png" alt="a 10 metre circle" /></h1>

<p>In the above picture, the red circle is made by <code class="highlighter-rouge">circle()</code>, the green one is made with Bézier curves (as used by <code class="highlighter-rouge">circlepath()</code> and <code class="highlighter-rouge">ellipse()</code>).</p>

<h2 id="055228474983-is-the-magic-number">“0.55228474983 is the magic number”</h2>

<p>To draw approximate circles using Bézier curves, you need to know the magic number, usually called <em>kappa</em>, which has the value 0.552284…. We’re looking at a Bézier curve pretending to be a circular quadrant, with control points positioned at a certain distance kappa from the end points. But how far? What value of kappa—what length of handle—will give us the most circular curve?</p>

<p>A picture of the problem, using a deliberately not-very-good guess at a value for <em>kappa</em> of 0.5:</p>

<figure class="highlight"><pre><code class="language-julia" data-lang="julia"><span class="nd">@png</span> <span class="n">begin</span>
    <span class="n">scale</span><span class="x">(</span><span class="mi">3</span><span class="x">)</span>
    <span class="n">fontsize</span><span class="x">(</span><span class="mi">7</span><span class="x">)</span>
    <span class="n">translate</span><span class="x">(</span><span class="mi">0</span><span class="x">,</span> <span class="o">-</span><span class="mi">50</span><span class="x">)</span>
    <span class="n">setline</span><span class="x">(</span><span class="mi">1</span><span class="x">)</span>

    <span class="n">radius</span> <span class="o">=</span> <span class="mi">100</span>

    <span class="n">kappa_guess</span> <span class="o">=</span> <span class="o">.</span><span class="mi">5</span>

    <span class="n">sethue</span><span class="x">(</span><span class="s">"red"</span><span class="x">)</span>
    <span class="n">arc</span><span class="x">(</span><span class="n">O</span><span class="x">,</span> <span class="n">radius</span><span class="x">,</span> <span class="mi">0</span><span class="x">,</span> <span class="nb">pi</span><span class="o">/</span><span class="mi">2</span><span class="x">,</span> <span class="x">:</span><span class="n">stroke</span><span class="x">)</span>

    <span class="n">sethue</span><span class="x">(</span><span class="s">"black"</span><span class="x">)</span>
    <span class="n">quadrant</span> <span class="o">=</span> <span class="n">BezierPathSegment</span><span class="x">(</span>
        <span class="n">Point</span><span class="x">(</span><span class="mi">0</span><span class="x">,</span> <span class="n">radius</span><span class="x">),</span>
        <span class="n">Point</span><span class="x">(</span><span class="n">kappa_guess</span> <span class="o">*</span> <span class="n">radius</span><span class="x">,</span> <span class="n">radius</span><span class="x">),</span>
        <span class="n">Point</span><span class="x">(</span><span class="n">radius</span><span class="x">,</span> <span class="n">kappa_guess</span> <span class="o">*</span> <span class="n">radius</span><span class="x">),</span>
        <span class="n">Point</span><span class="x">(</span><span class="n">radius</span><span class="x">,</span> <span class="mi">0</span><span class="x">))</span>
    <span class="n">circle</span><span class="o">.</span><span class="x">(</span><span class="n">quadrant</span><span class="x">,</span> <span class="mi">1</span><span class="x">,</span> <span class="x">:</span><span class="n">fill</span><span class="x">)</span>
    <span class="n">arrow</span><span class="x">(</span><span class="n">quadrant</span><span class="o">.</span><span class="n">p1</span><span class="x">,</span> <span class="n">quadrant</span><span class="o">.</span><span class="n">cp1</span><span class="x">,</span> <span class="n">arrowheadlength</span><span class="o">=</span><span class="mi">5</span><span class="x">)</span>
    <span class="n">arrow</span><span class="x">(</span><span class="n">quadrant</span><span class="o">.</span><span class="n">p2</span><span class="x">,</span> <span class="n">quadrant</span><span class="o">.</span><span class="n">cp2</span><span class="x">,</span> <span class="n">arrowheadlength</span><span class="o">=</span><span class="mi">5</span><span class="x">)</span>

    <span class="n">drawbezierpath</span><span class="x">(</span><span class="n">quadrant</span><span class="x">,</span> <span class="x">:</span><span class="n">stroke</span><span class="x">)</span>

    <span class="n">arrow</span><span class="x">(</span><span class="n">O</span><span class="x">,</span> <span class="n">bezier</span><span class="x">(</span><span class="mf">0.5</span><span class="x">,</span> <span class="n">quadrant</span><span class="o">...</span><span class="x">))</span>

    <span class="n">label</span><span class="o">.</span><span class="x">([</span><span class="s">"(0, 1)"</span><span class="x">,</span> <span class="s">"(k, 1)"</span><span class="x">,</span> <span class="s">"(1, k)"</span><span class="x">,</span> <span class="s">"(1, 0)"</span><span class="x">],</span> <span class="x">[:</span><span class="n">S</span><span class="x">,</span> <span class="x">:</span><span class="n">S</span><span class="x">,</span> <span class="x">:</span><span class="n">E</span><span class="x">,</span> <span class="x">:</span><span class="n">E</span><span class="x">],</span> <span class="n">quadrant</span><span class="x">)</span>
    <span class="n">label</span><span class="x">(</span><span class="s">"kappa_guess = 0.5"</span><span class="x">,</span> <span class="x">:</span><span class="n">S</span><span class="x">,</span> <span class="n">midpoint</span><span class="x">(</span><span class="n">quadrant</span><span class="o">.</span><span class="n">p1</span><span class="x">,</span> <span class="n">quadrant</span><span class="o">.</span><span class="n">cp1</span><span class="x">),</span> <span class="n">offset</span><span class="o">=</span><span class="mi">15</span><span class="x">)</span>
<span class="k">end</span> <span class="mi">800</span> <span class="mi">450</span> <span class="s">"images/bezier/kappaguess.png"</span></code></pre></figure>

<p><img src="/images/bezier/kappaguess.png" alt="guessing at kappa" /></p>

<p>To solve this, we’ll define a function that takes a value for <code class="highlighter-rouge">kappa</code> and works out the radius at the center of the Bézier curve.</p>

<figure class="highlight"><pre><code class="language-julia" data-lang="julia"><span class="n">_radiusofbezier</span><span class="x">(</span><span class="n">kappa</span><span class="x">)</span> <span class="o">=</span> <span class="n">norm</span><span class="x">(</span><span class="n">O</span><span class="x">,</span>
    <span class="n">bezier</span><span class="x">(</span><span class="mf">0.5</span><span class="x">,</span> <span class="n">BezierPathSegment</span><span class="x">(</span>
        <span class="n">Point</span><span class="x">(</span><span class="mi">0</span><span class="x">,</span> <span class="mi">1</span><span class="x">),</span>
        <span class="n">Point</span><span class="x">(</span><span class="n">kappa</span> <span class="o">*</span> <span class="mi">1</span><span class="x">,</span> <span class="mi">1</span><span class="x">),</span>
        <span class="n">Point</span><span class="x">(</span><span class="mi">1</span><span class="x">,</span> <span class="n">kappa</span> <span class="o">*</span> <span class="mi">1</span><span class="x">),</span>
        <span class="n">Point</span><span class="x">(</span><span class="mi">1</span><span class="x">,</span> <span class="mi">0</span><span class="x">)</span>
        <span class="x">)</span><span class="o">...</span><span class="x">))</span>

<span class="n">radiusofbezier</span><span class="x">(</span><span class="n">x</span><span class="x">)</span> <span class="o">=</span> <span class="n">_radiusofbezier</span><span class="x">(</span><span class="n">x</span><span class="x">)</span> <span class="o">-</span> <span class="mi">1</span></code></pre></figure>

<p>And we’ll use one of the many excellent packages in <a href="https://github.com/JuliaMath/">JuliaMath</a>, Roots.jl, to find the zero point:</p>

<figure class="highlight"><pre><code class="language-julia" data-lang="julia"><span class="n">using</span> <span class="n">Roots</span>
<span class="n">find_zero</span><span class="x">(</span><span class="n">radiusofbezier</span><span class="x">,</span> <span class="x">(</span><span class="mi">0</span><span class="x">,</span> <span class="mi">1</span><span class="x">),</span> <span class="n">verbose</span><span class="o">=</span><span class="n">true</span><span class="x">)</span>

<span class="n">Results</span> <span class="n">of</span> <span class="n">univariate</span> <span class="n">zero</span> <span class="n">finding</span><span class="x">:</span>
<span class="o">*</span> <span class="n">Converged</span> <span class="n">to</span><span class="x">:</span> <span class="mf">0.5522847498307936</span>
<span class="o">*</span> <span class="n">Algorithm</span><span class="x">:</span> <span class="n">Roots</span><span class="o">.</span><span class="n">Bisection64</span><span class="x">()</span>
<span class="o">*</span> <span class="n">iterations</span><span class="x">:</span> <span class="mi">59</span>
<span class="o">*</span> <span class="k">function</span><span class="nf"> evaluations</span><span class="x">:</span> <span class="mi">61</span>
<span class="o">*</span> <span class="n">stopped</span> <span class="n">as</span> <span class="o">|</span><span class="n">f</span><span class="x">(</span><span class="n">x_n</span><span class="x">)</span><span class="o">|</span> <span class="o">≤</span> <span class="n">max</span><span class="x">(</span><span class="n">δ</span><span class="x">,</span> <span class="n">max</span><span class="x">(</span><span class="mi">1</span><span class="x">,</span><span class="o">|</span><span class="n">x</span><span class="o">|</span><span class="x">)</span><span class="n">⋅ϵ</span><span class="x">)</span> <span class="n">using</span> <span class="n">δ</span> <span class="o">=</span> <span class="n">atol</span><span class="x">,</span> <span class="n">ϵ</span> <span class="o">=</span> <span class="n">rtol</span>
<span class="n">Trace</span><span class="x">:</span>
<span class="n">x_0</span> <span class="o">=</span>  <span class="mf">0.0000000000000000</span><span class="x">,</span>   <span class="n">f</span><span class="x">(</span><span class="n">x_0</span><span class="x">)</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.2928932188134524</span>
<span class="n">x_1</span> <span class="o">=</span>  <span class="mf">0.0000000000000000</span><span class="x">,</span>   <span class="n">f</span><span class="x">(</span><span class="n">x_1</span><span class="x">)</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.2928932188134524</span>
<span class="n">x_2</span> <span class="o">=</span>  <span class="mf">0.0000000000000000</span><span class="x">,</span>   <span class="n">f</span><span class="x">(</span><span class="n">x_2</span><span class="x">)</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.2928932188134524</span>
<span class="n">x_3</span> <span class="o">=</span>  <span class="mf">0.0000000000000000</span><span class="x">,</span>   <span class="n">f</span><span class="x">(</span><span class="n">x_3</span><span class="x">)</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.2928932188134524</span>
<span class="n">x_4</span> <span class="o">=</span>  <span class="mf">0.0000000000000000</span><span class="x">,</span>   <span class="n">f</span><span class="x">(</span><span class="n">x_4</span><span class="x">)</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.2928932188134524</span>
<span class="n">x_5</span> <span class="o">=</span>  <span class="mf">0.0000000002401066</span><span class="x">,</span>   <span class="n">f</span><span class="x">(</span><span class="n">x_5</span><span class="x">)</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.2928932186861167</span>
<span class="n">x_6</span> <span class="o">=</span>  <span class="mf">0.0000154972076416</span><span class="x">,</span>   <span class="n">f</span><span class="x">(</span><span class="n">x_6</span><span class="x">)</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.2928850001779929</span>
<span class="n">x_7</span> <span class="o">=</span>  <span class="mf">0.0039367675781250</span><span class="x">,</span>   <span class="n">f</span><span class="x">(</span><span class="n">x_7</span><span class="x">)</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.2908054325256169</span>
<span class="n">x_8</span> <span class="o">=</span>  <span class="mf">0.0627441406250000</span><span class="x">,</span>   <span class="n">f</span><span class="x">(</span><span class="n">x_8</span><span class="x">)</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.2596181133267076</span>
<span class="n">x_9</span> <span class="o">=</span>  <span class="mf">0.2504882812500000</span><span class="x">,</span>   <span class="n">f</span><span class="x">(</span><span class="n">x_9</span><span class="x">)</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.1600517471037238</span>
<span class="n">x_10</span> <span class="o">=</span>  <span class="mf">0.5004882812500000</span><span class="x">,</span>  <span class="n">f</span><span class="x">(</span><span class="n">x_10</span><span class="x">)</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.0274692256312462</span>
<span class="n">x_11</span> <span class="o">=</span>  <span class="mf">0.5004882812500000</span><span class="x">,</span>  <span class="n">f</span><span class="x">(</span><span class="n">x_11</span><span class="x">)</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.0274692256312462</span>
<span class="n">x_12</span> <span class="o">=</span>  <span class="mf">0.5004882812500000</span><span class="x">,</span>  <span class="n">f</span><span class="x">(</span><span class="n">x_12</span><span class="x">)</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.0274692256312462</span>
<span class="n">x_13</span> <span class="o">=</span>  <span class="mf">0.5004882812500000</span><span class="x">,</span>  <span class="n">f</span><span class="x">(</span><span class="n">x_13</span><span class="x">)</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.0274692256312462</span>
<span class="n">x_14</span> <span class="o">=</span>  <span class="mf">0.5317077636718750</span><span class="x">,</span>  <span class="n">f</span><span class="x">(</span><span class="n">x_14</span><span class="x">)</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.0109125948370147</span>
<span class="n">x_15</span> <span class="o">=</span>  <span class="mf">0.5473175048828125</span><span class="x">,</span>  <span class="n">f</span><span class="x">(</span><span class="n">x_15</span><span class="x">)</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.0026342794398989</span>
<span class="n">x_16</span> <span class="o">=</span>  <span class="mf">0.5473175048828125</span><span class="x">,</span>  <span class="n">f</span><span class="x">(</span><span class="n">x_16</span><span class="x">)</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.0026342794398989</span>
<span class="n">x_17</span> <span class="o">=</span>  <span class="mf">0.5512199401855469</span><span class="x">,</span>  <span class="n">f</span><span class="x">(</span><span class="n">x_17</span><span class="x">)</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.0005647005906200</span>
<span class="n">x_18</span> <span class="o">=</span>  <span class="mf">0.5512199401855469</span><span class="x">,</span>  <span class="n">f</span><span class="x">(</span><span class="n">x_18</span><span class="x">)</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.0005647005906200</span>
<span class="n">x_19</span> <span class="o">=</span>  <span class="mf">0.5521955490112305</span><span class="x">,</span>  <span class="n">f</span><span class="x">(</span><span class="n">x_19</span><span class="x">)</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.0000473058783003</span>
<span class="n">x_20</span> <span class="o">=</span>  <span class="mf">0.5521955490112305</span><span class="x">,</span>  <span class="n">f</span><span class="x">(</span><span class="n">x_20</span><span class="x">)</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.0000473058783003</span>
<span class="n">x_21</span> <span class="o">=</span>  <span class="mf">0.5521955490112305</span><span class="x">,</span>  <span class="n">f</span><span class="x">(</span><span class="n">x_21</span><span class="x">)</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.0000473058783003</span>
<span class="n">x_22</span> <span class="o">=</span>  <span class="mf">0.5521955490112305</span><span class="x">,</span>  <span class="n">f</span><span class="x">(</span><span class="n">x_22</span><span class="x">)</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.0000473058783003</span>
<span class="n">x_23</span> <span class="o">=</span>  <span class="mf">0.5522565245628357</span><span class="x">,</span>  <span class="n">f</span><span class="x">(</span><span class="n">x_23</span><span class="x">)</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.0000149687087803</span>
<span class="n">x_24</span> <span class="o">=</span>  <span class="mf">0.5522565245628357</span><span class="x">,</span>  <span class="n">f</span><span class="x">(</span><span class="n">x_24</span><span class="x">)</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.0000149687087803</span>
<span class="n">x_25</span> <span class="o">=</span>  <span class="mf">0.5522717684507370</span><span class="x">,</span>  <span class="n">f</span><span class="x">(</span><span class="n">x_25</span><span class="x">)</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.0000068844164003</span>
<span class="n">x_26</span> <span class="o">=</span>  <span class="mf">0.5522793903946877</span><span class="x">,</span>  <span class="n">f</span><span class="x">(</span><span class="n">x_26</span><span class="x">)</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.0000028422702103</span>
<span class="n">x_27</span> <span class="o">=</span>  <span class="mf">0.5522832013666630</span><span class="x">,</span>  <span class="n">f</span><span class="x">(</span><span class="n">x_27</span><span class="x">)</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.0000008211971153</span>
<span class="n">x_28</span> <span class="o">=</span>  <span class="mf">0.5522832013666630</span><span class="x">,</span>  <span class="n">f</span><span class="x">(</span><span class="n">x_28</span><span class="x">)</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.0000008211971153</span>
<span class="n">x_29</span> <span class="o">=</span>  <span class="mf">0.5522841541096568</span><span class="x">,</span>  <span class="n">f</span><span class="x">(</span><span class="n">x_29</span><span class="x">)</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.0000003159288415</span>
<span class="n">x_30</span> <span class="o">=</span>  <span class="mf">0.5522846304811537</span><span class="x">,</span>  <span class="n">f</span><span class="x">(</span><span class="n">x_30</span><span class="x">)</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.0000000632947047</span>
<span class="n">x_31</span> <span class="o">=</span>  <span class="mf">0.5522846304811537</span><span class="x">,</span>  <span class="n">f</span><span class="x">(</span><span class="n">x_31</span><span class="x">)</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.0000000632947047</span>
<span class="n">x_32</span> <span class="o">=</span>  <span class="mf">0.5522847495740280</span><span class="x">,</span>  <span class="n">f</span><span class="x">(</span><span class="n">x_32</span><span class="x">)</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.0000000001361705</span>
<span class="n">x_33</span> <span class="o">=</span>  <span class="mf">0.5522847495740280</span><span class="x">,</span>  <span class="n">f</span><span class="x">(</span><span class="n">x_33</span><span class="x">)</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.0000000001361705</span>
<span class="n">x_34</span> <span class="o">=</span>  <span class="mf">0.5522847495740280</span><span class="x">,</span>  <span class="n">f</span><span class="x">(</span><span class="n">x_34</span><span class="x">)</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.0000000001361705</span>
<span class="n">x_35</span> <span class="o">=</span>  <span class="mf">0.5522847495740280</span><span class="x">,</span>  <span class="n">f</span><span class="x">(</span><span class="n">x_35</span><span class="x">)</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.0000000001361705</span>
<span class="n">x_36</span> <span class="o">=</span>  <span class="mf">0.5522847495740280</span><span class="x">,</span>  <span class="n">f</span><span class="x">(</span><span class="n">x_36</span><span class="x">)</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.0000000001361705</span>
<span class="n">x_37</span> <span class="o">=</span>  <span class="mf">0.5522847495740280</span><span class="x">,</span>  <span class="n">f</span><span class="x">(</span><span class="n">x_37</span><span class="x">)</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.0000000001361705</span>
<span class="n">x_38</span> <span class="o">=</span>  <span class="mf">0.5522847495740280</span><span class="x">,</span>  <span class="n">f</span><span class="x">(</span><span class="n">x_38</span><span class="x">)</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.0000000001361705</span>
<span class="n">x_39</span> <span class="o">=</span>  <span class="mf">0.5522847495740280</span><span class="x">,</span>  <span class="n">f</span><span class="x">(</span><span class="n">x_39</span><span class="x">)</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.0000000001361705</span>
<span class="n">x_40</span> <span class="o">=</span>  <span class="mf">0.5522847495740280</span><span class="x">,</span>  <span class="n">f</span><span class="x">(</span><span class="n">x_40</span><span class="x">)</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.0000000001361705</span>
<span class="n">x_41</span> <span class="o">=</span>  <span class="mf">0.5522847498066312</span><span class="x">,</span>  <span class="n">f</span><span class="x">(</span><span class="n">x_41</span><span class="x">)</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.0000000000128140</span>
<span class="n">x_42</span> <span class="o">=</span>  <span class="mf">0.5522847498066312</span><span class="x">,</span>  <span class="n">f</span><span class="x">(</span><span class="n">x_42</span><span class="x">)</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.0000000000128140</span>
<span class="n">x_43</span> <span class="o">=</span>  <span class="mf">0.5522847498066312</span><span class="x">,</span>  <span class="n">f</span><span class="x">(</span><span class="n">x_43</span><span class="x">)</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.0000000000128140</span>
<span class="n">x_44</span> <span class="o">=</span>  <span class="mf">0.5522847498066312</span><span class="x">,</span>  <span class="n">f</span><span class="x">(</span><span class="n">x_44</span><span class="x">)</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.0000000000128140</span>
<span class="n">x_45</span> <span class="o">=</span>  <span class="mf">0.5522847498211689</span><span class="x">,</span>  <span class="n">f</span><span class="x">(</span><span class="n">x_45</span><span class="x">)</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.0000000000051041</span>
<span class="n">x_46</span> <span class="o">=</span>  <span class="mf">0.5522847498284378</span><span class="x">,</span>  <span class="n">f</span><span class="x">(</span><span class="n">x_46</span><span class="x">)</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.0000000000012493</span>
<span class="n">x_47</span> <span class="o">=</span>  <span class="mf">0.5522847498284378</span><span class="x">,</span>  <span class="n">f</span><span class="x">(</span><span class="n">x_47</span><span class="x">)</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.0000000000012493</span>
<span class="n">x_48</span> <span class="o">=</span>  <span class="mf">0.5522847498302550</span><span class="x">,</span>  <span class="n">f</span><span class="x">(</span><span class="n">x_48</span><span class="x">)</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.0000000000002855</span>
<span class="n">x_49</span> <span class="o">=</span>  <span class="mf">0.5522847498302550</span><span class="x">,</span>  <span class="n">f</span><span class="x">(</span><span class="n">x_49</span><span class="x">)</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.0000000000002855</span>
<span class="n">x_50</span> <span class="o">=</span>  <span class="mf">0.5522847498307093</span><span class="x">,</span>  <span class="n">f</span><span class="x">(</span><span class="n">x_50</span><span class="x">)</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.0000000000000447</span>
<span class="n">x_51</span> <span class="o">=</span>  <span class="mf">0.5522847498307093</span><span class="x">,</span>  <span class="n">f</span><span class="x">(</span><span class="n">x_51</span><span class="x">)</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.0000000000000447</span>
<span class="n">x_52</span> <span class="o">=</span>  <span class="mf">0.5522847498307093</span><span class="x">,</span>  <span class="n">f</span><span class="x">(</span><span class="n">x_52</span><span class="x">)</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.0000000000000447</span>
<span class="n">x_53</span> <span class="o">=</span>  <span class="mf">0.5522847498307660</span><span class="x">,</span>  <span class="n">f</span><span class="x">(</span><span class="n">x_53</span><span class="x">)</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.0000000000000145</span>
<span class="n">x_54</span> <span class="o">=</span>  <span class="mf">0.5522847498307660</span><span class="x">,</span>  <span class="n">f</span><span class="x">(</span><span class="n">x_54</span><span class="x">)</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.0000000000000145</span>
<span class="n">x_55</span> <span class="o">=</span>  <span class="mf">0.5522847498307802</span><span class="x">,</span>  <span class="n">f</span><span class="x">(</span><span class="n">x_55</span><span class="x">)</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.0000000000000070</span>
<span class="n">x_56</span> <span class="o">=</span>  <span class="mf">0.5522847498307873</span><span class="x">,</span>  <span class="n">f</span><span class="x">(</span><span class="n">x_56</span><span class="x">)</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.0000000000000032</span>
<span class="n">x_57</span> <span class="o">=</span>  <span class="mf">0.5522847498307909</span><span class="x">,</span>  <span class="n">f</span><span class="x">(</span><span class="n">x_57</span><span class="x">)</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.0000000000000013</span>
<span class="n">x_58</span> <span class="o">=</span>  <span class="mf">0.5522847498307927</span><span class="x">,</span>  <span class="n">f</span><span class="x">(</span><span class="n">x_58</span><span class="x">)</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.0000000000000004</span>
<span class="n">x_59</span> <span class="o">=</span>  <span class="mf">0.5522847498307936</span><span class="x">,</span>  <span class="n">f</span><span class="x">(</span><span class="n">x_59</span><span class="x">)</span> <span class="o">=</span>  <span class="mf">0.0000000000000000</span>
<span class="mf">0.5522847498307936</span></code></pre></figure>

<p>So that’s <code class="highlighter-rouge">kappa</code>.</p>

<p>Alternatively, we can use algebraic sorcery and the parametric equation for the Bézier cubic function to conjure the value from the following incantations:</p>

<script type="math/tex; mode=display">\begin{equation}
 \mathbf{p1} = (0, 1)                                                                                               \\\
 \mathbf{cp1} = (k, 1)                                                                                              \\\
 \mathbf{cp2} = (1, k)                                                                                              \\\
 \mathbf{p2} = (1, 0)                                                                                               \\\
 B(u) = \mathbf{p1}(1 - u)³ + \mathbf{cp1} 3u(1 - u)² + \mathbf{cp2}3u²(1 - u) + \mathbf{p2} u³ \\\
 u = 0.5                                                                                                            \\\
\sqrt{0.5}  = \frac{\mathbf{p1}}{8} + \frac{3\mathbf{cp1}}{8} + \frac{3\mathbf{cp2}}{8} + \frac{\mathbf{p2}}{}      \\\
x: \sqrt{0.5}  = \frac{0}{8} + \frac{3 k}{8} + \frac{3}{8} + \frac{1}{8}                                            \\\
y: \sqrt{0.5}  = \frac{1}{8} + \frac{3 }{8} + \frac{3 k}{8} + \frac{0}{8}                                           \\\
\frac{\sqrt{2}}{2} = 3  \frac{k}{8} + \frac{4}{8}                                                                   \\\
\sqrt{2} = 3  \frac{k}{4} + \frac{4}{4}                                                                             \\\
 \sqrt{2} = 3  \frac{k}{4} + 1                                                                                      \\\
 \sqrt{2} - 1 = 3  \frac{k}{4}                                                                                      \\\
3 k  = 4  (\sqrt{2} - 1)                                                                                            \\\
k = \frac{4}{3}  (\sqrt{2} - 1)                                                                                     \\\
k = 0.5522847498307936                                                                                              \\\
\end{equation}</script>

<p>I suspect most applications simply hard-code the magic number 0.552284… directly.</p>

<p>The following code shows how we could animate the process of changing the length of the handles by changing the value of kappa. Blink and you’ll miss the sweet spot, though, and the movement of the handles is imperceptible, so perhaps this isn’t the best way of illustrating the construction.</p>

<figure class="highlight"><pre><code class="language-julia" data-lang="julia"><span class="k">function</span><span class="nf"> frame</span><span class="x">(</span><span class="n">scene</span><span class="x">,</span> <span class="n">framenumber</span><span class="x">)</span>
    <span class="n">background</span><span class="x">(</span><span class="s">"white"</span><span class="x">)</span>
    <span class="n">eased_n</span> <span class="o">=</span> <span class="n">scene</span><span class="o">.</span><span class="n">easingfunction</span><span class="x">(</span><span class="n">framenumber</span><span class="x">,</span> <span class="mi">0</span><span class="x">,</span> <span class="mi">1</span><span class="x">,</span> <span class="n">scene</span><span class="o">.</span><span class="n">framerange</span><span class="o">.</span><span class="n">stop</span><span class="x">)</span>

    <span class="n">radius</span> <span class="o">=</span> <span class="mi">250</span>
    <span class="n">setline</span><span class="x">(</span><span class="mi">1</span><span class="x">)</span>
    <span class="n">sethue</span><span class="x">(</span><span class="s">"black"</span><span class="x">)</span>
    <span class="n">kappa</span> <span class="o">=</span> <span class="n">rescale</span><span class="x">(</span><span class="n">eased_n</span><span class="x">,</span> <span class="mi">0</span><span class="x">,</span> <span class="mi">1</span><span class="x">,</span> <span class="mf">0.525</span><span class="x">,</span> <span class="mf">0.575</span><span class="x">)</span>

    <span class="n">handlelength</span> <span class="o">=</span> <span class="x">(</span><span class="n">radius</span><span class="o">/</span><span class="mi">2</span><span class="x">)</span>  <span class="o">*</span> <span class="n">kappa</span>

    <span class="n">left</span>   <span class="o">=</span> <span class="n">Point</span><span class="x">(</span><span class="o">-</span><span class="n">radius</span><span class="o">/</span><span class="mi">2</span><span class="x">,</span> <span class="mi">0</span><span class="x">)</span>
    <span class="n">top</span>    <span class="o">=</span> <span class="n">Point</span><span class="x">(</span><span class="mi">0</span><span class="x">,</span>        <span class="o">-</span><span class="n">radius</span><span class="o">/</span><span class="mi">2</span><span class="x">)</span>
    <span class="n">right</span>  <span class="o">=</span> <span class="n">Point</span><span class="x">(</span><span class="n">radius</span><span class="o">/</span><span class="mi">2</span><span class="x">,</span>  <span class="mi">0</span><span class="x">)</span>
    <span class="n">bottom</span> <span class="o">=</span> <span class="n">Point</span><span class="x">(</span><span class="mi">0</span><span class="x">,</span>         <span class="n">radius</span><span class="o">/</span><span class="mi">2</span><span class="x">)</span>

    <span class="n">line</span><span class="x">(</span><span class="n">left</span><span class="x">,</span> <span class="n">left</span> <span class="o">+</span> <span class="x">(</span><span class="mi">0</span><span class="x">,</span> <span class="o">-</span><span class="n">handlelength</span><span class="x">),</span> <span class="x">:</span><span class="n">stroke</span><span class="x">)</span>
    <span class="n">line</span><span class="x">(</span><span class="n">top</span> <span class="o">+</span> <span class="x">(</span><span class="o">-</span><span class="n">handlelength</span><span class="x">,</span> <span class="mi">0</span><span class="x">),</span> <span class="n">top</span><span class="x">,</span> <span class="x">:</span><span class="n">stroke</span><span class="x">)</span>
    <span class="n">circle</span><span class="o">.</span><span class="x">([</span><span class="n">left</span><span class="x">,</span> <span class="n">top</span><span class="x">,</span> <span class="n">right</span><span class="x">,</span> <span class="n">bottom</span><span class="x">],</span> <span class="mi">2</span><span class="x">,</span> <span class="x">:</span><span class="n">fill</span><span class="x">)</span>
    <span class="n">circle</span><span class="o">.</span><span class="x">([</span><span class="n">left</span> <span class="o">+</span> <span class="x">(</span><span class="mi">0</span><span class="x">,</span> <span class="o">-</span><span class="n">handlelength</span><span class="x">),</span> <span class="n">top</span> <span class="o">+</span> <span class="x">(</span><span class="o">-</span><span class="n">handlelength</span><span class="x">,</span> <span class="mi">0</span><span class="x">)],</span> <span class="mi">2</span><span class="x">,</span> <span class="x">:</span><span class="n">fill</span><span class="x">)</span>

    <span class="n">line</span><span class="x">(</span><span class="n">left</span><span class="x">,</span> <span class="n">left</span> <span class="o">+</span> <span class="x">(</span><span class="mi">0</span><span class="x">,</span> <span class="o">-</span><span class="n">handlelength</span><span class="x">),</span> <span class="x">:</span><span class="n">stroke</span><span class="x">)</span>
    <span class="n">line</span><span class="x">(</span><span class="n">top</span> <span class="o">+</span> <span class="x">(</span><span class="o">-</span><span class="n">handlelength</span><span class="x">,</span> <span class="mi">0</span><span class="x">),</span> <span class="n">top</span><span class="x">,</span> <span class="x">:</span><span class="n">stroke</span><span class="x">)</span>
    <span class="n">circle</span><span class="o">.</span><span class="x">([</span><span class="n">left</span><span class="x">,</span> <span class="n">top</span><span class="x">,</span> <span class="n">right</span><span class="x">,</span> <span class="n">bottom</span><span class="x">],</span> <span class="mi">2</span><span class="x">,</span> <span class="x">:</span><span class="n">fill</span><span class="x">)</span>
    <span class="n">circle</span><span class="o">.</span><span class="x">([</span><span class="n">left</span> <span class="o">+</span> <span class="x">(</span><span class="mi">0</span><span class="x">,</span> <span class="o">-</span><span class="n">handlelength</span><span class="x">),</span> <span class="n">top</span> <span class="o">+</span> <span class="x">(</span><span class="o">-</span><span class="n">handlelength</span><span class="x">,</span> <span class="mi">0</span><span class="x">)],</span> <span class="mi">2</span><span class="x">,</span> <span class="x">:</span><span class="n">fill</span><span class="x">)</span>

    <span class="n">move</span><span class="x">(</span><span class="n">left</span><span class="x">)</span>
    <span class="n">curve</span><span class="x">(</span><span class="n">left</span>   <span class="o">+</span> <span class="x">(</span><span class="mi">0</span><span class="x">,</span> <span class="o">-</span><span class="n">handlelength</span><span class="x">),</span>
          <span class="n">top</span>    <span class="o">+</span> <span class="x">(</span><span class="o">-</span><span class="n">handlelength</span><span class="x">,</span> <span class="mi">0</span><span class="x">),</span>
          <span class="n">top</span><span class="x">)</span>
    <span class="n">curve</span><span class="x">(</span><span class="n">top</span>    <span class="o">+</span> <span class="x">(</span><span class="n">handlelength</span><span class="x">,</span> <span class="mi">0</span><span class="x">),</span>
          <span class="n">right</span>  <span class="o">+</span> <span class="x">(</span><span class="mi">0</span><span class="x">,</span> <span class="o">-</span><span class="n">handlelength</span><span class="x">),</span>
          <span class="n">right</span><span class="x">)</span>
    <span class="n">curve</span><span class="x">(</span><span class="n">right</span>  <span class="o">+</span> <span class="x">(</span><span class="mi">0</span><span class="x">,</span> <span class="n">handlelength</span><span class="x">),</span>
          <span class="n">bottom</span> <span class="o">+</span> <span class="x">(</span><span class="n">handlelength</span><span class="x">,</span> <span class="mi">0</span><span class="x">),</span>
          <span class="n">bottom</span><span class="x">)</span>
    <span class="n">curve</span><span class="x">(</span><span class="n">bottom</span> <span class="o">+</span> <span class="x">(</span><span class="o">-</span><span class="n">handlelength</span><span class="x">,</span> <span class="mi">0</span><span class="x">),</span>
          <span class="n">left</span>   <span class="o">+</span> <span class="x">(</span><span class="mi">0</span><span class="x">,</span> <span class="n">handlelength</span><span class="x">),</span>
          <span class="n">left</span><span class="x">)</span>

    <span class="k">if</span> <span class="n">isapprox</span><span class="x">(</span><span class="n">kappa</span><span class="x">,</span> <span class="mf">0.55228</span><span class="x">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">0.001</span><span class="x">)</span>
        <span class="n">sethue</span><span class="x">(</span><span class="s">"red"</span><span class="x">)</span>
        <span class="n">fillpath</span><span class="x">()</span>
        <span class="n">sethue</span><span class="x">(</span><span class="s">"black"</span><span class="x">)</span>
    <span class="k">else</span>
        <span class="n">strokepath</span><span class="x">()</span>
    <span class="k">end</span>
    <span class="n">fontface</span><span class="x">(</span><span class="s">"Menlo"</span><span class="x">)</span>
    <span class="n">fontsize</span><span class="x">(</span><span class="mi">20</span><span class="x">)</span>
    <span class="n">text</span><span class="x">(</span><span class="n">string</span><span class="x">(</span><span class="n">round</span><span class="x">(</span><span class="n">kappa</span><span class="x">,</span> <span class="mi">4</span><span class="x">)),</span> <span class="n">halign</span><span class="o">=</span><span class="x">:</span><span class="n">center</span><span class="x">)</span>
<span class="k">end</span>
<span class="n">width</span><span class="x">,</span> <span class="n">height</span> <span class="o">=</span> <span class="x">(</span><span class="mi">400</span><span class="x">,</span> <span class="mi">400</span><span class="x">)</span>
<span class="n">circlefrombezier</span> <span class="o">=</span> <span class="n">Movie</span><span class="x">(</span><span class="n">width</span><span class="x">,</span> <span class="n">height</span><span class="x">,</span> <span class="s">"circlefrombezier"</span><span class="x">)</span>
<span class="n">animate</span><span class="x">(</span><span class="n">circlefrombezier</span><span class="x">,</span> <span class="x">[</span><span class="n">Scene</span><span class="x">(</span><span class="n">circlefrombezier</span><span class="x">,</span> <span class="n">frame</span><span class="x">,</span> <span class="mi">1</span><span class="x">:</span><span class="mi">150</span><span class="x">,</span> <span class="n">easingfunction</span><span class="o">=</span><span class="n">easeoutquad</span><span class="x">)],</span> <span class="n">creategif</span><span class="o">=</span><span class="n">true</span><span class="x">,</span> <span class="n">framerate</span><span class="o">=</span><span class="mi">30</span><span class="x">,</span> <span class="n">pathname</span><span class="o">=</span><span class="s">"images/bezier/circlefrombezier.gif"</span><span class="x">)</span></code></pre></figure>

<h1 id="-3"><img src="/images/bezier/circlefrombezier.gif" alt="kappa value animation" /></h1>

<p>Luxor already provides a <code class="highlighter-rouge">Luxor.circlepath()</code> function that uses four Bézier curve segments to build a path that draws a circle. The main advantage of using this instead of the default <code class="highlighter-rouge">arc</code>-based circle is that it’s easier to build circles with holes:</p>

<figure class="highlight"><pre><code class="language-julia" data-lang="julia"><span class="nd">@png</span> <span class="n">begin</span>
    <span class="n">background</span><span class="x">(</span><span class="s">"moccasin"</span><span class="x">)</span>
    <span class="n">sethue</span><span class="x">(</span><span class="s">"darkorange"</span><span class="x">)</span>
    <span class="n">circlepath</span><span class="x">(</span><span class="n">O</span><span class="x">,</span> <span class="mi">200</span><span class="x">,</span> <span class="x">:</span><span class="n">path</span><span class="x">)</span>

    <span class="n">newsubpath</span><span class="x">()</span>
    <span class="n">circlepath</span><span class="x">(</span><span class="n">O</span> <span class="o">+</span> <span class="x">(</span><span class="mi">100</span><span class="x">,</span> <span class="o">-</span><span class="mi">40</span><span class="x">),</span> <span class="mi">70</span><span class="x">,</span> <span class="x">:</span><span class="n">path</span><span class="x">,</span> <span class="n">reversepath</span><span class="o">=</span><span class="n">true</span><span class="x">)</span>

    <span class="n">newsubpath</span><span class="x">()</span>
    <span class="n">circlepath</span><span class="x">(</span><span class="n">O</span> <span class="o">-</span> <span class="x">(</span><span class="mi">100</span><span class="x">,</span> <span class="mi">40</span><span class="x">),</span> <span class="mi">70</span><span class="x">,</span> <span class="x">:</span><span class="n">path</span><span class="x">,</span> <span class="n">reversepath</span><span class="o">=</span><span class="n">true</span><span class="x">)</span>

    <span class="n">fillpreserve</span><span class="x">()</span>
    <span class="n">setline</span><span class="x">(</span><span class="mi">8</span><span class="x">)</span>
    <span class="n">sethue</span><span class="x">(</span><span class="s">"skyblue"</span><span class="x">)</span>
    <span class="n">strokepath</span><span class="x">()</span>
<span class="k">end</span> <span class="mi">800</span> <span class="mi">500</span> <span class="s">"images/bezier/circularpaths.png"</span></code></pre></figure>

<p><img src="/images/bezier/circularpaths.png" alt="circular paths" /></p>

<h2 id="detour-into-typomania">Detour into Typomania</h2>

<p>In practice, not being able to draw perfect circles with Bezier curves isn’t a big problem. Font designers (you knew this was going to go ‘all typographical’ sooner or later) are big users of Bézier curves, and typically they don’t like drawing perfect circles anyway, because of the optical corrections required to make things ‘look right’.</p>

<p>There are a number of optical illusions that demonstrate that the human eye and the brain don’t always see reality accurately. The following is one of the simplest, but most people would be prepared to bet that the horizontal bar is thicker and shorter than the vertical bar. I had to draw a grid to double-check…</p>

<figure class="highlight"><pre><code class="language-julia" data-lang="julia"><span class="nd">@png</span> <span class="n">begin</span>
    <span class="n">background</span><span class="x">(</span><span class="s">"white"</span><span class="x">)</span>

    <span class="n">sethue</span><span class="x">(</span><span class="s">"gray90"</span><span class="x">)</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">GridRect</span><span class="x">(</span><span class="n">BoundingBox</span><span class="x">()[</span><span class="mi">1</span><span class="x">],</span> <span class="mi">15</span><span class="x">,</span> <span class="mi">15</span><span class="x">,</span> <span class="mi">30</span> <span class="o">*</span> <span class="mi">20</span><span class="x">,</span> <span class="mi">30</span> <span class="o">*</span> <span class="mi">20</span><span class="x">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="mi">1</span><span class="x">:</span><span class="mi">1600</span>
        <span class="n">circle</span><span class="x">(</span><span class="n">nextgridpoint</span><span class="x">(</span><span class="n">g</span><span class="x">),</span> <span class="mf">0.5</span><span class="x">,</span> <span class="x">:</span><span class="n">fill</span><span class="x">)</span>
    <span class="k">end</span>

    <span class="n">b</span> <span class="o">=</span> <span class="n">box</span><span class="x">(</span><span class="n">O</span> <span class="o">-</span> <span class="x">(</span><span class="mi">15</span><span class="x">,</span> <span class="o">-</span><span class="mi">60</span><span class="x">),</span> <span class="n">O</span> <span class="o">+</span> <span class="x">(</span><span class="mi">15</span><span class="x">,</span> <span class="o">-</span><span class="mi">60</span><span class="x">),</span> <span class="n">vertices</span><span class="o">=</span><span class="n">true</span><span class="x">)</span>

    <span class="n">sethue</span><span class="x">(</span><span class="s">"black"</span><span class="x">)</span>
    <span class="n">poly</span><span class="x">(</span><span class="n">b</span><span class="x">,</span> <span class="x">:</span><span class="n">fill</span><span class="x">)</span>
    <span class="n">translate</span><span class="x">(</span><span class="mi">0</span><span class="x">,</span> <span class="o">-</span><span class="mi">90</span><span class="x">)</span>
    <span class="n">rotate</span><span class="x">(</span><span class="nb">pi</span><span class="o">/</span><span class="mi">2</span><span class="x">)</span>
    <span class="n">poly</span><span class="x">(</span><span class="n">b</span><span class="x">,</span> <span class="x">:</span><span class="n">fill</span><span class="x">)</span>

<span class="k">end</span> <span class="mi">300</span> <span class="mi">300</span> <span class="s">"images/bezier/opticalillusion.png"</span></code></pre></figure>

<p><img src="/images/bezier/opticalillusion.png" alt="simple illusion" /></p>

<p>It’s something to do with how our eyes, set side by side and trained to move side to side horizontally with great speed and precision, underestimate width. Type designers spend much of their time adjusting the relative widths and thicknesses of letter shapes so that illusions like this are compensated for in advance. What happens if you turn your display on its side (apart from possibly spilling your coffee)?</p>

<p>Here’s a short script to examine the bounding boxes of the inner and outer loops of the letter ‘o’ in various fonts.</p>

<figure class="highlight"><pre><code class="language-julia" data-lang="julia"><span class="k">function</span><span class="nf"> drawletteraspect</span><span class="x">(</span><span class="n">pos</span><span class="x">,</span> <span class="n">font</span><span class="x">,</span> <span class="n">thefontsize</span><span class="x">,</span> <span class="n">str</span><span class="x">)</span>
    <span class="nd">@layer</span> <span class="n">begin</span>
        <span class="n">translate</span><span class="x">(</span><span class="n">pos</span><span class="x">)</span>
        <span class="n">translate</span><span class="x">(</span><span class="o">-</span><span class="n">thefontsize</span><span class="o">/</span><span class="mi">3</span><span class="x">,</span> <span class="mi">0</span><span class="x">)</span>
        <span class="n">fontsize</span><span class="x">(</span><span class="n">thefontsize</span><span class="x">)</span>
        <span class="n">fontface</span><span class="x">(</span><span class="n">font</span><span class="x">)</span>
        <span class="n">sethue</span><span class="x">(</span><span class="s">"gray40"</span><span class="x">)</span>
        <span class="n">setline</span><span class="x">(</span><span class="mf">0.5</span><span class="x">)</span>
        <span class="n">text</span><span class="x">(</span><span class="n">str</span><span class="x">)</span>
        <span class="n">newpath</span><span class="x">()</span>
        <span class="n">textpath</span><span class="x">(</span><span class="n">str</span><span class="x">)</span>
        <span class="n">o</span> <span class="o">=</span> <span class="n">pathtopoly</span><span class="x">()</span>
        <span class="nd">@layer</span> <span class="n">begin</span>
            <span class="n">fontsize</span><span class="x">(</span><span class="n">thefontsize</span><span class="o">/</span><span class="mi">20</span><span class="x">)</span>
            <span class="n">text</span><span class="x">(</span><span class="n">font</span><span class="x">,</span> <span class="n">Point</span><span class="x">(</span><span class="mi">0</span><span class="x">,</span> <span class="n">thefontsize</span><span class="o">/</span><span class="mi">15</span><span class="x">))</span>
            <span class="n">sethue</span><span class="x">(</span><span class="s">"magenta"</span><span class="x">)</span>
            <span class="n">fontface</span><span class="x">(</span><span class="s">"Cousine-Bold"</span><span class="x">)</span>
            <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="n">o</span>
                <span class="n">b</span> <span class="o">=</span> <span class="n">BoundingBox</span><span class="x">(</span><span class="n">i</span><span class="x">)</span>
                <span class="n">text</span><span class="x">(</span><span class="n">string</span><span class="x">(</span><span class="n">round</span><span class="x">(</span><span class="n">boxaspectratio</span><span class="x">(</span><span class="n">b</span><span class="x">),</span> <span class="mi">4</span><span class="x">)),</span> <span class="n">midpoint</span><span class="x">(</span><span class="n">b</span><span class="o">...</span><span class="x">)</span> <span class="o">+</span> <span class="x">(</span><span class="mi">0</span><span class="x">,</span> <span class="n">n</span><span class="x">),</span> <span class="n">halign</span><span class="o">=</span><span class="x">:</span><span class="n">center</span><span class="x">)</span>
                <span class="n">n</span> <span class="o">+=</span> <span class="n">thefontsize</span><span class="o">/</span><span class="mi">20</span>
                <span class="n">box</span><span class="x">(</span><span class="n">b</span><span class="x">,</span> <span class="x">:</span><span class="n">stroke</span><span class="x">)</span>
            <span class="k">end</span>
        <span class="k">end</span>
    <span class="k">end</span>
<span class="k">end</span>

<span class="nd">@png</span> <span class="n">begin</span>
    <span class="n">fonts</span> <span class="o">=</span> <span class="x">[</span>
        <span class="s">"ArialUnicodeMS"</span><span class="x">,</span>
        <span class="s">"AvantGarde-Book"</span><span class="x">,</span>
        <span class="s">"BauhausLT-Light"</span><span class="x">,</span>
        <span class="s">"CircularStd-Book"</span><span class="x">,</span>
        <span class="s">"Cousine"</span><span class="x">,</span>
        <span class="s">"FuturaLT-Book"</span><span class="x">,</span>
        <span class="s">"GillSansMTPro-Book"</span><span class="x">,</span>
        <span class="s">"GothamBlack"</span><span class="x">,</span>
        <span class="s">"Helvetica"</span><span class="x">,</span>
        <span class="s">"KabelLTStd-Light"</span><span class="x">,</span>
        <span class="s">"ProximaNova-Bold"</span><span class="x">,</span>
        <span class="s">"Times-Roman"</span><span class="x">,</span>
    <span class="x">]</span>
    <span class="n">tiles</span> <span class="o">=</span> <span class="n">Tiler</span><span class="x">(</span><span class="mi">800</span><span class="x">,</span> <span class="mi">400</span><span class="x">,</span> <span class="mi">3</span><span class="x">,</span> <span class="mi">4</span><span class="x">,</span> <span class="n">margin</span><span class="o">=</span><span class="mi">40</span><span class="x">)</span>
    <span class="k">for</span> <span class="x">(</span><span class="n">pos</span><span class="x">,</span> <span class="n">n</span><span class="x">)</span> <span class="k">in</span> <span class="n">tiles</span>
        <span class="n">drawletteraspect</span><span class="x">(</span><span class="n">pos</span><span class="x">,</span> <span class="n">fonts</span><span class="x">[</span><span class="n">mod1</span><span class="x">(</span><span class="n">n</span><span class="x">,</span> <span class="n">length</span><span class="x">(</span><span class="n">fonts</span><span class="x">))],</span> <span class="mi">150</span><span class="x">,</span> <span class="s">"o"</span><span class="x">)</span>
    <span class="k">end</span>
<span class="k">end</span> <span class="mi">800</span> <span class="mi">400</span> <span class="s">"images/bezier/drawletteraspect.png"</span></code></pre></figure>

<p><img src="/images/bezier/drawletteraspect.png" alt="aspect ratios of letter O" /></p>

<p>The fonts on your system will be different, of course.</p>

<h2 id="the-story-of-o">The story of “o”</h2>

<p>I wondered which fonts used the most circular circles for the letter “o”. This script wanders through all the fonts registered with Fontconfig and stores the bounding boxes of the letter “o”, then finds “the most circular”.</p>

<figure class="highlight"><pre><code class="language-julia" data-lang="julia"><span class="n">using</span> <span class="n">Fontconfig</span><span class="x">,</span> <span class="n">Luxor</span><span class="x">,</span> <span class="n">DataFrames</span>

<span class="k">function</span><span class="nf"> buildfontlist</span><span class="x">()</span>
    <span class="n">fonts</span> <span class="o">=</span> <span class="x">[]</span>
    <span class="k">for</span> <span class="n">font</span> <span class="k">in</span> <span class="n">Fontconfig</span><span class="o">.</span><span class="n">list</span><span class="x">()</span>
        <span class="n">families</span> <span class="o">=</span> <span class="n">Fontconfig</span><span class="o">.</span><span class="n">format</span><span class="x">(</span><span class="n">font</span><span class="x">,</span> <span class="s">"%{family}"</span><span class="x">)</span>
        <span class="k">for</span> <span class="n">family</span> <span class="k">in</span> <span class="n">split</span><span class="x">(</span><span class="n">families</span><span class="x">,</span> <span class="s">","</span><span class="x">)</span>
            <span class="n">push!</span><span class="x">(</span><span class="n">fonts</span><span class="x">,</span> <span class="n">family</span><span class="x">)</span>
        <span class="k">end</span>
    <span class="k">end</span>
    <span class="n">filter!</span><span class="x">(</span><span class="n">font</span> <span class="o">-&gt;</span> <span class="o">!</span><span class="n">startswith</span><span class="x">(</span><span class="n">font</span><span class="x">,</span> <span class="s">"."</span><span class="x">),</span> <span class="n">fonts</span><span class="x">)</span>
    <span class="n">filter!</span><span class="x">(</span><span class="n">font</span> <span class="o">-&gt;</span> <span class="o">!</span><span class="n">contains</span><span class="x">(</span><span class="n">font</span><span class="x">,</span> <span class="n">r</span><span class="s">"Wing.*"</span><span class="x">),</span> <span class="n">fonts</span><span class="x">)</span>
    <span class="n">filter!</span><span class="x">(</span><span class="n">font</span> <span class="o">-&gt;</span> <span class="o">!</span><span class="n">contains</span><span class="x">(</span><span class="n">font</span><span class="x">,</span> <span class="n">r</span><span class="s">".*Extra"</span><span class="x">),</span> <span class="n">fonts</span><span class="x">)</span>
    <span class="n">filter!</span><span class="x">(</span><span class="n">font</span> <span class="o">-&gt;</span> <span class="o">!</span><span class="n">contains</span><span class="x">(</span><span class="n">font</span><span class="x">,</span> <span class="n">r</span><span class="s">".*Expert"</span><span class="x">),</span> <span class="n">fonts</span><span class="x">)</span>
    <span class="k">return</span> <span class="n">sort</span><span class="x">(</span><span class="n">unique</span><span class="x">(</span><span class="n">fonts</span><span class="x">))</span>
<span class="k">end</span>

<span class="n">mutable</span> <span class="n">struct</span> <span class="n">Score</span>
    <span class="n">fontname</span><span class="o">::</span><span class="kt">String</span>
    <span class="n">bbox1</span><span class="o">::</span><span class="n">BoundingBox</span>
    <span class="n">bbox2</span><span class="o">::</span><span class="n">BoundingBox</span>
<span class="k">end</span>

<span class="n">scores</span> <span class="o">=</span> <span class="n">Score</span><span class="x">[]</span>

<span class="c"># we have to have a drawing open, otherwise textpath() doesn't know where to turn</span>

<span class="n">Drawing</span><span class="x">(</span><span class="mi">100</span><span class="x">,</span> <span class="mi">100</span><span class="x">,</span> <span class="s">"/tmp/emptydrawing.png"</span><span class="x">)</span>
<span class="n">fontlist</span> <span class="o">=</span> <span class="n">unique</span><span class="x">(</span><span class="n">buildfontlist</span><span class="x">())</span>
<span class="n">fontsize</span><span class="x">(</span><span class="mi">20</span><span class="x">)</span>

<span class="k">for</span> <span class="n">font</span> <span class="k">in</span> <span class="n">fontlist</span>
    <span class="n">fontface</span><span class="x">(</span><span class="n">font</span><span class="x">)</span>
    <span class="n">newpath</span><span class="x">()</span> <span class="c"># !!!!</span>
    <span class="n">textpath</span><span class="x">(</span><span class="s">"o"</span><span class="x">)</span>
    <span class="n">o</span> <span class="o">=</span> <span class="n">pathtopoly</span><span class="x">()</span>
    <span class="n">bboxes</span> <span class="o">=</span> <span class="n">BoundingBox</span><span class="x">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="n">o</span>
        <span class="n">push!</span><span class="x">(</span><span class="n">bboxes</span><span class="x">,</span> <span class="n">BoundingBox</span><span class="x">(</span><span class="n">i</span><span class="x">))</span>
    <span class="k">end</span>
    <span class="k">if</span> <span class="n">length</span><span class="x">(</span><span class="n">bboxes</span><span class="x">)</span> <span class="o">==</span> <span class="mi">2</span>
        <span class="n">push!</span><span class="x">(</span><span class="n">scores</span><span class="x">,</span> <span class="n">Score</span><span class="x">(</span><span class="n">font</span><span class="x">,</span> <span class="n">bboxes</span><span class="x">[</span><span class="mi">1</span><span class="x">],</span> <span class="n">bboxes</span><span class="x">[</span><span class="mi">2</span><span class="x">]))</span>
    <span class="k">end</span>
<span class="k">end</span>
<span class="n">finish</span><span class="x">()</span> <span class="c"># unused drawing</span></code></pre></figure>

<p>To analyse the results, we’ll put everything into a DataFrame.</p>

<figure class="highlight"><pre><code class="language-julia" data-lang="julia"><span class="n">df</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="x">(</span>
    <span class="n">Fontname</span> <span class="o">=</span> <span class="kt">String</span><span class="x">[],</span>  <span class="c"># font name</span>
    <span class="n">Outer</span>    <span class="o">=</span> <span class="kt">Float64</span><span class="x">[],</span> <span class="c"># outer aspect ratio</span>
    <span class="n">Inner</span>    <span class="o">=</span> <span class="kt">Float64</span><span class="x">[],</span> <span class="c"># inner loop aspect ratio</span>
    <span class="n">Total</span>    <span class="o">=</span> <span class="kt">Float64</span><span class="x">[],</span>
    <span class="n">Mean</span>     <span class="o">=</span> <span class="kt">Float64</span><span class="x">[]</span>
    <span class="x">)</span>

<span class="k">for</span> <span class="n">f</span> <span class="k">in</span> <span class="n">scores</span>
    <span class="n">push!</span><span class="x">(</span><span class="n">df</span><span class="x">,</span> <span class="x">[</span><span class="n">f</span><span class="o">.</span><span class="n">fontname</span><span class="x">,</span>
               <span class="n">boxaspectratio</span><span class="x">(</span><span class="n">f</span><span class="o">.</span><span class="n">bbox1</span><span class="x">),</span>
               <span class="n">boxaspectratio</span><span class="x">(</span><span class="n">f</span><span class="o">.</span><span class="n">bbox2</span><span class="x">),</span>
               <span class="mi">1</span> <span class="o">-</span> <span class="x">(</span><span class="n">boxaspectratio</span><span class="x">(</span><span class="n">f</span><span class="o">.</span><span class="n">bbox1</span><span class="x">)</span> <span class="o">+</span> <span class="n">boxaspectratio</span><span class="x">(</span><span class="n">f</span><span class="o">.</span><span class="n">bbox2</span><span class="x">))</span><span class="o">/</span><span class="mi">2</span><span class="x">,</span>
               <span class="n">mean</span><span class="x">([</span><span class="n">boxaspectratio</span><span class="x">(</span><span class="n">f</span><span class="o">.</span><span class="n">bbox1</span><span class="x">),</span>
                     <span class="n">boxaspectratio</span><span class="x">(</span><span class="n">f</span><span class="o">.</span><span class="n">bbox2</span><span class="x">)])</span>
              <span class="x">])</span>
<span class="k">end</span>

<span class="n">sort!</span><span class="x">(</span><span class="n">df</span><span class="x">,</span> <span class="x">:</span><span class="n">Total</span><span class="x">,</span> <span class="n">lt</span> <span class="o">=</span> <span class="x">(</span><span class="n">a</span><span class="x">,</span> <span class="n">b</span><span class="x">)</span> <span class="o">-&gt;</span> <span class="n">abs</span><span class="x">(</span><span class="n">a</span><span class="x">)</span> <span class="o">&lt;</span> <span class="n">abs</span><span class="x">(</span><span class="n">b</span><span class="x">))</span>

<span class="mi">1018</span><span class="n">×5</span> <span class="n">DataFrames</span><span class="o">.</span><span class="n">DataFrame</span>
<span class="n">│</span> <span class="n">Row</span>  <span class="n">│</span> <span class="n">Fontname</span>                        <span class="n">│</span> <span class="n">Outer</span>    <span class="n">│</span> <span class="n">Inner</span>   <span class="n">│</span> <span class="n">Total</span>        <span class="n">│</span> <span class="n">Mean</span>     <span class="n">│</span>
<span class="n">├──────┼─────────────────────────────────┼──────────┼─────────┼──────────────┼──────────┤</span>
<span class="n">│</span> <span class="mi">1</span>    <span class="n">│</span> <span class="n">Kabel</span> <span class="n">LT</span> <span class="n">Std</span> <span class="n">Light</span>              <span class="n">│</span> <span class="mf">1.0</span>      <span class="n">│</span> <span class="mf">1.0</span>     <span class="n">│</span> <span class="mf">0.0</span>          <span class="n">│</span> <span class="mf">1.0</span>      <span class="n">│</span>
<span class="n">│</span> <span class="mi">2</span>    <span class="n">│</span> <span class="n">ITC</span> <span class="n">Avant</span> <span class="n">Garde</span> <span class="n">Std</span> <span class="n">XLt</span>         <span class="n">│</span> <span class="mf">0.9965</span>   <span class="n">│</span> <span class="mf">1.0035</span>  <span class="n">│</span> <span class="o">-</span><span class="mf">2.04211e-7</span>  <span class="n">│</span> <span class="mf">1.0</span>      <span class="n">│</span>
<span class="n">│</span> <span class="mi">3</span>    <span class="n">│</span> <span class="n">Kabel</span> <span class="n">LT</span> <span class="n">Std</span> <span class="n">Black</span>              <span class="n">│</span> <span class="mf">1.0</span>      <span class="n">│</span> <span class="mf">1.00101</span> <span class="n">│</span> <span class="o">-</span><span class="mf">0.000503525</span> <span class="n">│</span> <span class="mf">1.0005</span>   <span class="n">│</span>
<span class="n">│</span> <span class="mi">4</span>    <span class="n">│</span> <span class="n">Gill</span> <span class="n">Sans</span>                       <span class="n">│</span> <span class="mf">0.972742</span> <span class="n">│</span> <span class="mf">1.02949</span> <span class="n">│</span> <span class="o">-</span><span class="mf">0.00111546</span>  <span class="n">│</span> <span class="mf">1.00112</span>  <span class="n">│</span>
<span class="n">│</span> <span class="mi">5</span>    <span class="n">│</span> <span class="n">Gill</span> <span class="n">Sans</span> <span class="n">MT</span> <span class="n">Pro</span> <span class="n">Medium</span>         <span class="n">│</span> <span class="mf">0.972742</span> <span class="n">│</span> <span class="mf">1.02949</span> <span class="n">│</span> <span class="o">-</span><span class="mf">0.00111546</span>  <span class="n">│</span> <span class="mf">1.00112</span>  <span class="n">│</span>
<span class="n">│</span> <span class="mi">6</span>    <span class="n">│</span> <span class="n">ITC</span> <span class="n">Avant</span> <span class="n">Garde</span> <span class="n">Gothic</span> <span class="n">Std</span>      <span class="n">│</span> <span class="mf">0.993158</span> <span class="n">│</span> <span class="mf">1.01428</span> <span class="n">│</span> <span class="o">-</span><span class="mf">0.00371842</span>  <span class="n">│</span> <span class="mf">1.00372</span>  <span class="n">│</span>
<span class="n">│</span> <span class="mi">7</span>    <span class="n">│</span> <span class="n">ITC</span> <span class="n">Avant</span> <span class="n">Garde</span> <span class="n">Std</span> <span class="n">Bk</span>          <span class="n">│</span> <span class="mf">0.993158</span> <span class="n">│</span> <span class="mf">1.01428</span> <span class="n">│</span> <span class="o">-</span><span class="mf">0.00371842</span>  <span class="n">│</span> <span class="mf">1.00372</span>  <span class="n">│</span>
<span class="n">│</span> <span class="mi">8</span>    <span class="n">│</span> <span class="n">ITC</span> <span class="n">Avant</span> <span class="n">Garde</span> <span class="n">Std</span> <span class="n">Md</span>          <span class="n">│</span> <span class="mf">0.991246</span> <span class="n">│</span> <span class="mf">1.021</span>   <span class="n">│</span> <span class="o">-</span><span class="mf">0.00612158</span>  <span class="n">│</span> <span class="mf">1.00612</span>  <span class="n">│</span>
<span class="n">│</span> <span class="mi">9</span>    <span class="n">│</span> <span class="n">Avenir</span> <span class="n">Heavy</span>                    <span class="n">│</span> <span class="mf">0.965208</span> <span class="n">│</span> <span class="mf">1.02078</span> <span class="n">│</span> <span class="mf">0.00700837</span>   <span class="n">│</span> <span class="mf">0.992992</span> <span class="n">│</span>
<span class="n">⋮</span>
<span class="n">│</span> <span class="mi">1009</span> <span class="n">│</span> <span class="n">Akzidenz</span><span class="o">-</span><span class="n">Grotesk</span> <span class="n">BQ</span> <span class="n">Condensed</span> <span class="n">A</span> <span class="n">│</span> <span class="mf">2.30537</span>  <span class="n">│</span> <span class="mf">5.19277</span> <span class="n">│</span> <span class="o">-</span><span class="mf">2.74907</span>     <span class="n">│</span> <span class="mf">3.74907</span>  <span class="n">│</span>
<span class="n">│</span> <span class="mi">1010</span> <span class="n">│</span> <span class="n">AmplitudeComp</span><span class="o">-</span><span class="n">Ultra</span>             <span class="n">│</span> <span class="mf">1.52721</span>  <span class="n">│</span> <span class="mf">6.41949</span> <span class="n">│</span> <span class="o">-</span><span class="mf">2.97335</span>     <span class="n">│</span> <span class="mf">3.97335</span>  <span class="n">│</span>
<span class="n">│</span> <span class="mi">1011</span> <span class="n">│</span> <span class="n">Industria</span> <span class="n">LT</span> <span class="n">Std</span> <span class="n">Solid</span>          <span class="n">│</span> <span class="mf">2.62973</span>  <span class="n">│</span> <span class="mf">5.72823</span> <span class="n">│</span> <span class="o">-</span><span class="mf">3.17898</span>     <span class="n">│</span> <span class="mf">4.17898</span>  <span class="n">│</span>
<span class="n">│</span> <span class="mi">1012</span> <span class="n">│</span> <span class="n">Bernard</span> <span class="n">MT</span> <span class="n">Condensed</span>            <span class="n">│</span> <span class="mf">1.5877</span>   <span class="n">│</span> <span class="mf">7.55733</span> <span class="n">│</span> <span class="o">-</span><span class="mf">3.57252</span>     <span class="n">│</span> <span class="mf">4.57252</span>  <span class="n">│</span>
<span class="n">│</span> <span class="mi">1013</span> <span class="n">│</span> <span class="n">Impact</span>                          <span class="n">│</span> <span class="mf">1.4851</span>   <span class="n">│</span> <span class="mf">7.6678</span>  <span class="n">│</span> <span class="o">-</span><span class="mf">3.57645</span>     <span class="n">│</span> <span class="mf">4.57645</span>  <span class="n">│</span>
<span class="n">│</span> <span class="mi">1014</span> <span class="n">│</span> <span class="n">HeadLineA</span>                       <span class="n">│</span> <span class="mf">1.6</span>      <span class="n">│</span> <span class="mf">8.34783</span> <span class="n">│</span> <span class="o">-</span><span class="mf">3.97391</span>     <span class="n">│</span> <span class="mf">4.97391</span>  <span class="n">│</span>
<span class="n">│</span> <span class="mi">1015</span> <span class="n">│</span> <span class="n">Univers</span> <span class="n">LT</span> <span class="n">Std</span> <span class="mi">39</span> <span class="n">Thin</span> <span class="n">UltraCn</span>  <span class="n">│</span> <span class="mf">3.69307</span>  <span class="n">│</span> <span class="mf">6.81657</span> <span class="n">│</span> <span class="o">-</span><span class="mf">4.25482</span>     <span class="n">│</span> <span class="mf">5.25482</span>  <span class="n">│</span>
<span class="n">│</span> <span class="mi">1016</span> <span class="n">│</span> <span class="n">Helvetica</span> <span class="n">LT</span> <span class="n">Std</span> <span class="n">ExtCompressed</span>  <span class="n">│</span> <span class="mf">1.9595</span>   <span class="n">│</span> <span class="mf">8.82251</span> <span class="n">│</span> <span class="o">-</span><span class="mf">4.39101</span>     <span class="n">│</span> <span class="mf">5.39101</span>  <span class="n">│</span>
<span class="n">│</span> <span class="mi">1017</span> <span class="n">│</span> <span class="n">Gill</span> <span class="n">Sans</span> <span class="n">MT</span> <span class="n">Pro</span> <span class="n">Bold</span> <span class="n">ExtCond</span>   <span class="n">│</span> <span class="mf">2.70499</span>  <span class="n">│</span> <span class="mf">9.1913</span>  <span class="n">│</span> <span class="o">-</span><span class="mf">4.94815</span>     <span class="n">│</span> <span class="mf">5.94815</span>  <span class="n">│</span>
<span class="n">│</span> <span class="mi">1018</span> <span class="n">│</span> <span class="n">Helvetica</span> <span class="n">LT</span> <span class="n">Std</span> <span class="n">UltCompressed</span>  <span class="n">│</span> <span class="mf">2.46103</span>  <span class="n">│</span> <span class="mf">9.71489</span> <span class="n">│</span> <span class="o">-</span><span class="mf">5.08796</span>     <span class="n">│</span> <span class="mf">6.08796</span>  <span class="n">│</span></code></pre></figure>

<p>Few typefaces are perfectly circular. Even <a href="http://typographica.org/typeface-reviews/ll-circular/">Circular</a>, LineTo’s trendy geometric sans typeface, isn’t perfectly circular.</p>

<p>Most of the least circular ones, according to this rough examination, are in the Condensed and Compressed sections of the font libraries. No surprise, Sherlock.</p>

<figure class="highlight"><pre><code class="language-julia" data-lang="julia"><span class="n">display</span><span class="x">(</span><span class="n">df</span><span class="x">[</span><span class="k">end</span><span class="o">-</span><span class="mi">10</span><span class="x">:</span><span class="k">end</span><span class="x">,</span> <span class="x">:])</span>

<span class="mi">11</span><span class="n">×5</span> <span class="n">DataFrames</span><span class="o">.</span><span class="n">DataFrame</span>
<span class="n">│</span> <span class="n">Row</span> <span class="n">│</span> <span class="n">Fontname</span>                        <span class="n">│</span> <span class="n">Outer</span>   <span class="n">│</span> <span class="n">Inner</span>   <span class="n">│</span> <span class="n">Total</span>    <span class="n">│</span> <span class="n">Mean</span>    <span class="n">│</span>
<span class="n">├─────┼─────────────────────────────────┼─────────┼─────────┼──────────┼─────────┤</span>
<span class="n">│</span> <span class="mi">1</span>   <span class="n">│</span> <span class="n">Helvetica</span> <span class="n">LT</span> <span class="n">Std</span> <span class="n">Compressed</span>     <span class="n">│</span> <span class="mf">5.72485</span> <span class="n">│</span> <span class="mf">1.53453</span> <span class="n">│</span> <span class="o">-</span><span class="mf">2.62969</span> <span class="n">│</span> <span class="mf">3.62969</span> <span class="n">│</span>
<span class="n">│</span> <span class="mi">2</span>   <span class="n">│</span> <span class="n">Akzidenz</span><span class="o">-</span><span class="n">Grotesk</span> <span class="n">BQ</span> <span class="n">Condensed</span> <span class="n">A</span> <span class="n">│</span> <span class="mf">2.30537</span> <span class="n">│</span> <span class="mf">5.19277</span> <span class="n">│</span> <span class="o">-</span><span class="mf">2.74907</span> <span class="n">│</span> <span class="mf">3.74907</span> <span class="n">│</span>
<span class="n">│</span> <span class="mi">3</span>   <span class="n">│</span> <span class="n">AmplitudeComp</span><span class="o">-</span><span class="n">Ultra</span>             <span class="n">│</span> <span class="mf">1.52721</span> <span class="n">│</span> <span class="mf">6.41949</span> <span class="n">│</span> <span class="o">-</span><span class="mf">2.97335</span> <span class="n">│</span> <span class="mf">3.97335</span> <span class="n">│</span>
<span class="n">│</span> <span class="mi">4</span>   <span class="n">│</span> <span class="n">Industria</span> <span class="n">LT</span> <span class="n">Std</span> <span class="n">Solid</span>          <span class="n">│</span> <span class="mf">2.62973</span> <span class="n">│</span> <span class="mf">5.72823</span> <span class="n">│</span> <span class="o">-</span><span class="mf">3.17898</span> <span class="n">│</span> <span class="mf">4.17898</span> <span class="n">│</span>
<span class="n">│</span> <span class="mi">5</span>   <span class="n">│</span> <span class="n">Bernard</span> <span class="n">MT</span> <span class="n">Condensed</span>            <span class="n">│</span> <span class="mf">1.5877</span>  <span class="n">│</span> <span class="mf">7.55733</span> <span class="n">│</span> <span class="o">-</span><span class="mf">3.57252</span> <span class="n">│</span> <span class="mf">4.57252</span> <span class="n">│</span>
<span class="n">│</span> <span class="mi">6</span>   <span class="n">│</span> <span class="n">Impact</span>                          <span class="n">│</span> <span class="mf">1.4851</span>  <span class="n">│</span> <span class="mf">7.6678</span>  <span class="n">│</span> <span class="o">-</span><span class="mf">3.57645</span> <span class="n">│</span> <span class="mf">4.57645</span> <span class="n">│</span>
<span class="n">│</span> <span class="mi">7</span>   <span class="n">│</span> <span class="n">HeadLineA</span>                       <span class="n">│</span> <span class="mf">1.6</span>     <span class="n">│</span> <span class="mf">8.34783</span> <span class="n">│</span> <span class="o">-</span><span class="mf">3.97391</span> <span class="n">│</span> <span class="mf">4.97391</span> <span class="n">│</span>
<span class="n">│</span> <span class="mi">8</span>   <span class="n">│</span> <span class="n">Univers</span> <span class="n">LT</span> <span class="n">Std</span> <span class="mi">39</span> <span class="n">Thin</span> <span class="n">UltraCn</span>  <span class="n">│</span> <span class="mf">3.69307</span> <span class="n">│</span> <span class="mf">6.81657</span> <span class="n">│</span> <span class="o">-</span><span class="mf">4.25482</span> <span class="n">│</span> <span class="mf">5.25482</span> <span class="n">│</span>
<span class="n">│</span> <span class="mi">9</span>   <span class="n">│</span> <span class="n">Helvetica</span> <span class="n">LT</span> <span class="n">Std</span> <span class="n">ExtCompressed</span>  <span class="n">│</span> <span class="mf">1.9595</span>  <span class="n">│</span> <span class="mf">8.82251</span> <span class="n">│</span> <span class="o">-</span><span class="mf">4.39101</span> <span class="n">│</span> <span class="mf">5.39101</span> <span class="n">│</span>
<span class="n">│</span> <span class="mi">10</span>  <span class="n">│</span> <span class="n">Gill</span> <span class="n">Sans</span> <span class="n">MT</span> <span class="n">Pro</span> <span class="n">Bold</span> <span class="n">ExtCond</span>   <span class="n">│</span> <span class="mf">2.70499</span> <span class="n">│</span> <span class="mf">9.1913</span>  <span class="n">│</span> <span class="o">-</span><span class="mf">4.94815</span> <span class="n">│</span> <span class="mf">5.94815</span> <span class="n">│</span>
<span class="n">│</span> <span class="mi">11</span>  <span class="n">│</span> <span class="n">Helvetica</span> <span class="n">LT</span> <span class="n">Std</span> <span class="n">UltCompressed</span>  <span class="n">│</span> <span class="mf">2.46103</span> <span class="n">│</span> <span class="mf">9.71489</span> <span class="n">│</span> <span class="o">-</span><span class="mf">5.08796</span> <span class="n">│</span> <span class="mf">6.08796</span> <span class="n">│</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">Table</span><span class="x">(</span><span class="mi">2</span><span class="x">,</span> <span class="mi">5</span><span class="x">,</span> <span class="mi">170</span><span class="x">,</span> <span class="mi">140</span><span class="x">)</span>
<span class="nd">@png</span> <span class="n">begin</span>
    <span class="k">for</span> <span class="x">(</span><span class="n">n</span><span class="x">,</span> <span class="n">f</span><span class="x">)</span> <span class="k">in</span> <span class="n">enumerate</span><span class="x">(</span><span class="n">df</span><span class="x">[</span><span class="k">end</span><span class="o">-</span><span class="mi">9</span><span class="x">:</span><span class="k">end</span><span class="x">,</span> <span class="mi">1</span><span class="x">])</span>
        <span class="n">fontsize</span><span class="x">(</span><span class="mi">60</span><span class="x">)</span>
        <span class="n">fontface</span><span class="x">(</span><span class="n">f</span><span class="x">)</span>
        <span class="n">text</span><span class="x">(</span><span class="s">"O"</span><span class="x">,</span> <span class="n">t</span><span class="x">[</span><span class="n">n</span><span class="x">],</span> <span class="n">halign</span><span class="o">=</span><span class="x">:</span><span class="n">center</span><span class="x">)</span>
        <span class="n">fontsize</span><span class="x">(</span><span class="mi">14</span><span class="x">)</span>
        <span class="n">text</span><span class="x">(</span><span class="n">f</span><span class="x">,</span> <span class="n">t</span><span class="x">[</span><span class="n">n</span><span class="x">]</span> <span class="o">+</span> <span class="x">(</span><span class="mi">0</span><span class="x">,</span> <span class="mi">40</span><span class="x">),</span> <span class="n">halign</span><span class="o">=</span><span class="x">:</span><span class="n">center</span><span class="x">)</span>
    <span class="k">end</span>
<span class="k">end</span> <span class="mi">800</span> <span class="mi">250</span> <span class="s">"images/bezier/leastcircularfonts.png"</span></code></pre></figure>

<p><img src="/images/bezier/leastcircularfonts.png" alt="some of the least circular fonts" /></p>

<p>The most circular ones on my computer are the classic geometric sans serif fonts.</p>

<figure class="highlight"><pre><code class="language-julia" data-lang="julia"><span class="n">display</span><span class="x">(</span><span class="n">df</span><span class="x">[</span><span class="mi">1</span><span class="x">:</span><span class="mi">10</span><span class="x">,</span> <span class="x">:])</span>

<span class="mi">10</span><span class="n">×5</span> <span class="n">DataFrames</span><span class="o">.</span><span class="n">DataFrame</span>
<span class="n">│</span> <span class="n">Row</span> <span class="n">│</span> <span class="n">Fontname</span>                   <span class="n">│</span> <span class="n">Outer</span>    <span class="n">│</span> <span class="n">Inner</span>   <span class="n">│</span> <span class="n">Total</span>        <span class="n">│</span> <span class="n">Mean</span>     <span class="n">│</span>
<span class="n">├─────┼────────────────────────────┼──────────┼─────────┼──────────────┼──────────┤</span>
<span class="n">│</span> <span class="mi">1</span>   <span class="n">│</span> <span class="n">Kabel</span> <span class="n">LT</span> <span class="n">Std</span> <span class="n">Light</span>         <span class="n">│</span> <span class="mf">1.0</span>      <span class="n">│</span> <span class="mf">1.0</span>     <span class="n">│</span> <span class="mf">0.0</span>          <span class="n">│</span> <span class="mf">1.0</span>      <span class="n">│</span>
<span class="n">│</span> <span class="mi">2</span>   <span class="n">│</span> <span class="n">ITC</span> <span class="n">Avant</span> <span class="n">Garde</span> <span class="n">Std</span> <span class="n">XLt</span>    <span class="n">│</span> <span class="mf">0.9965</span>   <span class="n">│</span> <span class="mf">1.0035</span>  <span class="n">│</span> <span class="o">-</span><span class="mf">2.04211e-7</span>  <span class="n">│</span> <span class="mf">1.0</span>      <span class="n">│</span>
<span class="n">│</span> <span class="mi">3</span>   <span class="n">│</span> <span class="n">Kabel</span> <span class="n">LT</span> <span class="n">Std</span> <span class="n">Black</span>         <span class="n">│</span> <span class="mf">1.0</span>      <span class="n">│</span> <span class="mf">1.00101</span> <span class="n">│</span> <span class="o">-</span><span class="mf">0.000503525</span> <span class="n">│</span> <span class="mf">1.0005</span>   <span class="n">│</span>
<span class="n">│</span> <span class="mi">4</span>   <span class="n">│</span> <span class="n">Gill</span> <span class="n">Sans</span>                  <span class="n">│</span> <span class="mf">0.972742</span> <span class="n">│</span> <span class="mf">1.02949</span> <span class="n">│</span> <span class="o">-</span><span class="mf">0.00111546</span>  <span class="n">│</span> <span class="mf">1.00112</span>  <span class="n">│</span>
<span class="n">│</span> <span class="mi">5</span>   <span class="n">│</span> <span class="n">Gill</span> <span class="n">Sans</span> <span class="n">MT</span> <span class="n">Pro</span> <span class="n">Medium</span>    <span class="n">│</span> <span class="mf">0.972742</span> <span class="n">│</span> <span class="mf">1.02949</span> <span class="n">│</span> <span class="o">-</span><span class="mf">0.00111546</span>  <span class="n">│</span> <span class="mf">1.00112</span>  <span class="n">│</span>
<span class="n">│</span> <span class="mi">6</span>   <span class="n">│</span> <span class="n">ITC</span> <span class="n">Avant</span> <span class="n">Garde</span> <span class="n">Gothic</span> <span class="n">Std</span> <span class="n">│</span> <span class="mf">0.993158</span> <span class="n">│</span> <span class="mf">1.01428</span> <span class="n">│</span> <span class="o">-</span><span class="mf">0.00371842</span>  <span class="n">│</span> <span class="mf">1.00372</span>  <span class="n">│</span>
<span class="n">│</span> <span class="mi">7</span>   <span class="n">│</span> <span class="n">ITC</span> <span class="n">Avant</span> <span class="n">Garde</span> <span class="n">Std</span> <span class="n">Bk</span>     <span class="n">│</span> <span class="mf">0.993158</span> <span class="n">│</span> <span class="mf">1.01428</span> <span class="n">│</span> <span class="o">-</span><span class="mf">0.00371842</span>  <span class="n">│</span> <span class="mf">1.00372</span>  <span class="n">│</span>
<span class="n">│</span> <span class="mi">8</span>   <span class="n">│</span> <span class="n">ITC</span> <span class="n">Avant</span> <span class="n">Garde</span> <span class="n">Std</span> <span class="n">Md</span>     <span class="n">│</span> <span class="mf">0.991246</span> <span class="n">│</span> <span class="mf">1.021</span>   <span class="n">│</span> <span class="o">-</span><span class="mf">0.00612158</span>  <span class="n">│</span> <span class="mf">1.00612</span>  <span class="n">│</span>
<span class="n">│</span> <span class="mi">9</span>   <span class="n">│</span> <span class="n">Avenir</span> <span class="n">Heavy</span>               <span class="n">│</span> <span class="mf">0.965208</span> <span class="n">│</span> <span class="mf">1.02078</span> <span class="n">│</span> <span class="mf">0.00700837</span>   <span class="n">│</span> <span class="mf">0.992992</span> <span class="n">│</span>
<span class="n">│</span> <span class="mi">10</span>  <span class="n">│</span> <span class="n">DIN</span> <span class="mi">30640</span> <span class="n">Std</span>              <span class="n">│</span> <span class="mf">0.966066</span> <span class="n">│</span> <span class="mf">1.01366</span> <span class="n">│</span> <span class="mf">0.010139</span>     <span class="n">│</span> <span class="mf">0.989861</span> <span class="n">│</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">Table</span><span class="x">(</span><span class="mi">2</span><span class="x">,</span> <span class="mi">5</span><span class="x">,</span> <span class="mi">160</span><span class="x">,</span> <span class="mi">140</span><span class="x">)</span>
<span class="nd">@png</span> <span class="n">begin</span>
    <span class="k">for</span> <span class="x">(</span><span class="n">n</span><span class="x">,</span> <span class="n">f</span><span class="x">)</span> <span class="k">in</span> <span class="n">enumerate</span><span class="x">(</span><span class="n">df</span><span class="x">[</span><span class="mi">1</span><span class="x">:</span><span class="mi">10</span><span class="x">,</span> <span class="mi">1</span><span class="x">])</span>
        <span class="n">fontsize</span><span class="x">(</span><span class="mi">50</span><span class="x">)</span>
        <span class="n">fontface</span><span class="x">(</span><span class="n">f</span><span class="x">)</span>
        <span class="n">text</span><span class="x">(</span><span class="s">"O"</span><span class="x">,</span> <span class="n">t</span><span class="x">[</span><span class="n">n</span><span class="x">],</span> <span class="n">halign</span><span class="o">=</span><span class="x">:</span><span class="n">center</span><span class="x">)</span>
        <span class="n">fontsize</span><span class="x">(</span><span class="mi">11</span><span class="x">)</span>
        <span class="n">text</span><span class="x">(</span><span class="n">f</span><span class="x">,</span> <span class="n">t</span><span class="x">[</span><span class="n">n</span><span class="x">]</span> <span class="o">+</span> <span class="x">(</span><span class="mi">0</span><span class="x">,</span> <span class="mi">50</span><span class="x">),</span> <span class="n">halign</span><span class="o">=</span><span class="x">:</span><span class="n">center</span><span class="x">)</span>
    <span class="k">end</span>
<span class="k">end</span> <span class="mi">800</span> <span class="mi">300</span> <span class="s">"images/bezier/mostcircularfonts.png"</span></code></pre></figure>

<p><img src="/images/bezier/mostcircularfonts.png" alt="the most circular fonts" /></p>

<p>In the ‘most circular o’ fonts, there are a few examples from Rudolf Koch’s Kabel family.</p>

<figure class="highlight"><pre><code class="language-julia" data-lang="julia"><span class="n">kabel</span> <span class="o">=</span> <span class="n">df</span><span class="x">[[</span><span class="n">contains</span><span class="x">(</span><span class="n">fontname</span><span class="x">,</span> <span class="n">r</span><span class="s">".*Kabel.*"</span><span class="x">)</span> <span class="k">for</span> <span class="n">fontname</span> <span class="k">in</span> <span class="n">df</span><span class="x">[:</span><span class="n">Fontname</span><span class="x">]],</span> <span class="x">:]</span>

<span class="mi">9</span><span class="n">×5</span> <span class="n">DataFrames</span><span class="o">.</span><span class="n">DataFrame</span>
<span class="n">│</span> <span class="n">Row</span> <span class="n">│</span> <span class="n">Fontname</span>             <span class="n">│</span> <span class="n">Outer</span>    <span class="n">│</span> <span class="n">Inner</span>   <span class="n">│</span> <span class="n">Total</span>        <span class="n">│</span> <span class="n">Mean</span>     <span class="n">│</span>
<span class="n">├─────┼──────────────────────┼──────────┼─────────┼──────────────┼──────────┤</span>
<span class="n">│</span> <span class="mi">1</span>   <span class="n">│</span> <span class="n">Kabel</span> <span class="n">LT</span> <span class="n">Std</span> <span class="n">Light</span>   <span class="n">│</span> <span class="mf">1.0</span>      <span class="n">│</span> <span class="mf">1.0</span>     <span class="n">│</span> <span class="mf">0.0</span>          <span class="n">│</span> <span class="mf">1.0</span>      <span class="n">│</span>
<span class="n">│</span> <span class="mi">2</span>   <span class="n">│</span> <span class="n">Kabel</span> <span class="n">LT</span> <span class="n">Std</span> <span class="n">Black</span>   <span class="n">│</span> <span class="mf">1.0</span>      <span class="n">│</span> <span class="mf">1.00101</span> <span class="n">│</span> <span class="o">-</span><span class="mf">0.000503525</span> <span class="n">│</span> <span class="mf">1.0005</span>   <span class="n">│</span>
<span class="n">│</span> <span class="mi">3</span>   <span class="n">│</span> <span class="n">ITC</span> <span class="n">Kabel</span> <span class="n">Std</span> <span class="n">Medium</span> <span class="n">│</span> <span class="mf">0.976604</span> <span class="n">│</span> <span class="mf">0.99728</span> <span class="n">│</span> <span class="mf">0.0130582</span>    <span class="n">│</span> <span class="mf">0.986942</span> <span class="n">│</span>
<span class="n">│</span> <span class="mi">4</span>   <span class="n">│</span> <span class="n">Kabel</span> <span class="n">LT</span> <span class="n">Std</span>         <span class="n">│</span> <span class="mf">1.02945</span>  <span class="n">│</span> <span class="mf">1.0</span>     <span class="n">│</span> <span class="o">-</span><span class="mf">0.014727</span>    <span class="n">│</span> <span class="mf">1.01473</span>  <span class="n">│</span>
<span class="n">│</span> <span class="mi">5</span>   <span class="n">│</span> <span class="n">Kabel</span> <span class="n">LT</span> <span class="n">Std</span> <span class="n">Book</span>    <span class="n">│</span> <span class="mf">1.02945</span>  <span class="n">│</span> <span class="mf">1.0</span>     <span class="n">│</span> <span class="o">-</span><span class="mf">0.014727</span>    <span class="n">│</span> <span class="mf">1.01473</span>  <span class="n">│</span>
<span class="n">│</span> <span class="mi">6</span>   <span class="n">│</span> <span class="n">ITC</span> <span class="n">Kabel</span> <span class="n">Std</span> <span class="n">Ultra</span>  <span class="n">│</span> <span class="mf">0.961288</span> <span class="n">│</span> <span class="mf">1.07731</span> <span class="n">│</span> <span class="o">-</span><span class="mf">0.0193006</span>   <span class="n">│</span> <span class="mf">1.0193</span>   <span class="n">│</span>
<span class="n">│</span> <span class="mi">7</span>   <span class="n">│</span> <span class="n">ITC</span> <span class="n">Kabel</span> <span class="n">Std</span>        <span class="n">│</span> <span class="mf">1.02357</span>  <span class="n">│</span> <span class="mf">1.02993</span> <span class="n">│</span> <span class="o">-</span><span class="mf">0.0267482</span>   <span class="n">│</span> <span class="mf">1.02675</span>  <span class="n">│</span>
<span class="n">│</span> <span class="mi">8</span>   <span class="n">│</span> <span class="n">ITC</span> <span class="n">Kabel</span> <span class="n">Std</span> <span class="n">Book</span>   <span class="n">│</span> <span class="mf">1.02357</span>  <span class="n">│</span> <span class="mf">1.02993</span> <span class="n">│</span> <span class="o">-</span><span class="mf">0.0267482</span>   <span class="n">│</span> <span class="mf">1.02675</span>  <span class="n">│</span>
<span class="n">│</span> <span class="mi">9</span>   <span class="n">│</span> <span class="n">ITCKabel</span>             <span class="n">│</span> <span class="mf">1.02357</span>  <span class="n">│</span> <span class="mf">1.02993</span> <span class="n">│</span> <span class="o">-</span><span class="mf">0.0267482</span>   <span class="n">│</span> <span class="mf">1.02675</span>  <span class="n">│</span>

<span class="c"># that's v0.6 syntax... v0.7 is df[[occursin(r".*Kabel.*", fname) for fname  in df[:Name]], :]</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">Table</span><span class="x">(</span><span class="mi">2</span><span class="x">,</span> <span class="mi">5</span><span class="x">,</span> <span class="mi">160</span><span class="x">,</span> <span class="mi">140</span><span class="x">)</span>
<span class="nd">@png</span> <span class="n">begin</span>
    <span class="k">for</span> <span class="x">(</span><span class="n">n</span><span class="x">,</span> <span class="n">f</span><span class="x">)</span> <span class="k">in</span> <span class="n">enumerate</span><span class="x">(</span><span class="n">kabel</span><span class="x">[:,</span> <span class="mi">1</span><span class="x">])</span>
        <span class="n">fontsize</span><span class="x">(</span><span class="mi">50</span><span class="x">)</span>
        <span class="n">fontface</span><span class="x">(</span><span class="n">f</span><span class="x">)</span>
        <span class="n">text</span><span class="x">(</span><span class="s">"O"</span><span class="x">,</span> <span class="n">t</span><span class="x">[</span><span class="n">n</span><span class="x">],</span> <span class="n">halign</span><span class="o">=</span><span class="x">:</span><span class="n">center</span><span class="x">)</span>
        <span class="n">fontsize</span><span class="x">(</span><span class="mi">11</span><span class="x">)</span>
        <span class="n">text</span><span class="x">(</span><span class="n">f</span><span class="x">,</span> <span class="n">t</span><span class="x">[</span><span class="n">n</span><span class="x">]</span> <span class="o">+</span> <span class="x">(</span><span class="mi">0</span><span class="x">,</span> <span class="mi">50</span><span class="x">),</span> <span class="n">halign</span><span class="o">=</span><span class="x">:</span><span class="n">center</span><span class="x">)</span>
    <span class="k">end</span>
<span class="k">end</span> <span class="mi">800</span> <span class="mi">300</span> <span class="s">"images/bezier/kabelfonts.png"</span></code></pre></figure>

<p><img src="/images/bezier/kabelfonts.png" alt="Kabel fonts" /></p>

<p>Here’s Wikipedia:</p>

<blockquote>
  <p>Kabel belongs to the “geometric” style of sans-serifs, which was becoming popular in Germany at the time of Kabel’s creation [1920s]. Based loosely on the structure of the circle and straight lines, it nonetheless applies a number of unusual design decisions, such as a delicately low x-height (although larger in the bold weight), a quirky tilted ‘e’ and irregularly angled terminals, to add delicacy and an irregularity suggesting stylish calligraphy, of which Koch was an expert.</p>
</blockquote>

<p>Eye magazine <a href="http://eyemagazine.com/feature/article/expressive-geometry">isn’t convinced</a> by the apparent geometrical precision of Kabel:</p>

<blockquote>
  <p>its eccentricities reveal Koch’s unwavering expressionistic and humanist instincts</p>
</blockquote>

<p>But at least the ‘o’s are circular…</p>

<h2 id="curvy">Curvy</h2>

<p>Moving back to Bézier curves, you can summarize the behaviour of a Bézier curve at a point by finding the curvature. The Luxor function <code class="highlighter-rouge">beziercurvature()</code> returns a number, called <code class="highlighter-rouge">kappa</code>, that varies and flips from positive to negative as the Bézier path varies in ‘curviness’. We’re using the first and second derivatives to find the kappa value:</p>

<script type="math/tex; mode=display">\begin{equation}
 \kappa = \frac{\mid \dot{x}\ddot{y}-\dot{y}\ddot{x}\mid}
    {(\dot{x}^2 + \dot{y}^2)^{\frac{3}{2}}}
 \end{equation}</script>

<p>The following <code class="highlighter-rouge">drawcurvature()</code> function uses the kappa value to work out the slope, and draw a perpendicular to the curve, with lengths varying according to the value of kappa, indicating the way the curvature changes.</p>

<p>(This is another <em>kappa</em>, by the way, no relation to the Bézier circularity kappa. Or indeed to the Lancia Kappa…</p>

<h1 id="-4"><img src="/images/bezier/2880px-Lancia_Kappa_front_20110130.jpg" alt="Lancia Kappa from Wikimedia Commons" /></h1>

<p><a href="https://commons.wikimedia.org/wiki/File:Lancia_Kappa_front_20110130.jpg">Photograph by Rudolf Stricker</a></p>

<p>…or to many of the other things called kappa, such as the curvature of the universe, the torsional constant of an oscillator, Einstein’s constant of gravitation, the coupling coefficient in magnetostatics—and that’s just in physics.)</p>

<figure class="highlight"><pre><code class="language-julia" data-lang="julia"><span class="k">function</span><span class="nf"> drawcurvature</span><span class="x">(</span><span class="n">bezpathsegment</span><span class="o">::</span><span class="n">BezierPathSegment</span><span class="x">;</span>
        <span class="n">scale</span><span class="o">=</span><span class="mi">500</span><span class="x">,</span>
        <span class="n">stepby</span><span class="o">=</span><span class="mf">0.01</span><span class="x">,</span>
        <span class="n">colors</span><span class="o">=</span><span class="x">[</span><span class="s">"purple"</span><span class="x">,</span> <span class="s">"green"</span><span class="x">])</span>
    <span class="n">p1</span><span class="x">,</span> <span class="n">cp1</span><span class="x">,</span> <span class="n">cp2</span><span class="x">,</span> <span class="n">p2</span> <span class="o">=</span> <span class="n">bezpathsegment</span>
    <span class="k">for</span> <span class="n">u</span> <span class="k">in</span> <span class="mi">0</span><span class="x">:</span><span class="n">stepby</span><span class="x">:</span><span class="mi">1</span>
        <span class="n">pt</span> <span class="o">=</span> <span class="n">bezier</span><span class="x">(</span><span class="n">u</span><span class="x">,</span> <span class="n">p1</span><span class="x">,</span> <span class="n">cp1</span><span class="x">,</span> <span class="n">cp2</span><span class="x">,</span> <span class="n">p2</span><span class="x">)</span>
        <span class="n">kappa</span> <span class="o">=</span> <span class="n">beziercurvature</span><span class="x">(</span><span class="n">u</span><span class="x">,</span> <span class="n">p1</span><span class="x">,</span> <span class="n">cp1</span><span class="x">,</span> <span class="n">cp2</span><span class="x">,</span> <span class="n">p2</span><span class="x">)</span>
        <span class="c"># comb lines are perpendiculars</span>
        <span class="nd">@layer</span> <span class="n">begin</span>
            <span class="n">pt1</span> <span class="o">=</span> <span class="n">bezier′</span><span class="x">(</span><span class="n">u</span><span class="x">,</span> <span class="n">p1</span><span class="x">,</span> <span class="n">cp1</span><span class="x">,</span> <span class="n">cp2</span><span class="x">,</span> <span class="n">p2</span><span class="x">)</span>
            <span class="c"># slope of curve at t = y′(t)/x′(t)</span>
            <span class="c"># normal is 1/slope</span>
            <span class="n">s</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="x">(</span><span class="n">pt1</span><span class="o">.</span><span class="n">y</span><span class="o">/</span><span class="n">pt1</span><span class="o">.</span><span class="n">x</span><span class="x">)</span>
            <span class="n">sign</span><span class="x">(</span><span class="n">kappa</span><span class="x">)</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">?</span> <span class="n">sethue</span><span class="x">(</span><span class="n">colors</span><span class="x">[</span><span class="mi">1</span><span class="x">])</span> <span class="x">:</span> <span class="n">sethue</span><span class="x">(</span><span class="n">colors</span><span class="x">[</span><span class="mi">2</span><span class="x">])</span>
            <span class="n">len</span> <span class="o">=</span> <span class="n">scale</span> <span class="o">*</span> <span class="n">abs</span><span class="x">(</span><span class="n">kappa</span><span class="x">)</span>
            <span class="n">line</span><span class="x">(</span><span class="n">pt</span> <span class="o">-</span> <span class="n">polar</span><span class="x">(</span><span class="n">len</span><span class="x">,</span> <span class="n">atan</span><span class="x">(</span><span class="n">s</span><span class="x">)),</span> <span class="n">pt</span> <span class="o">+</span> <span class="n">polar</span><span class="x">(</span><span class="n">len</span><span class="x">,</span> <span class="n">atan</span><span class="x">(</span><span class="n">s</span><span class="x">)),</span> <span class="x">:</span><span class="n">stroke</span><span class="x">)</span>
        <span class="k">end</span>
    <span class="k">end</span>
<span class="k">end</span></code></pre></figure>

<p>Here it is in action:</p>

<figure class="highlight"><pre><code class="language-julia" data-lang="julia"><span class="nd">@png</span> <span class="n">begin</span>
    <span class="n">p1</span>  <span class="o">=</span> <span class="n">Point</span><span class="x">(</span><span class="o">-</span><span class="mi">150</span><span class="x">,</span> <span class="mi">0</span><span class="x">)</span>
    <span class="n">cp1</span> <span class="o">=</span> <span class="n">Point</span><span class="x">(</span><span class="o">-</span><span class="mi">50</span><span class="x">,</span> <span class="o">-</span><span class="mi">200</span><span class="x">)</span>
    <span class="n">cp2</span> <span class="o">=</span> <span class="n">Point</span><span class="x">(</span><span class="mi">150</span><span class="x">,</span> <span class="mi">200</span><span class="x">)</span>
    <span class="n">p2</span>  <span class="o">=</span> <span class="n">Point</span><span class="x">(</span><span class="mi">250</span><span class="x">,</span> <span class="o">-</span><span class="mi">150</span><span class="x">)</span>
    <span class="n">setline</span><span class="x">(</span><span class="mf">0.1</span><span class="x">)</span>
    <span class="k">for</span> <span class="n">u</span> <span class="k">in</span> <span class="mi">0</span><span class="x">:</span><span class="mf">0.025</span><span class="x">:</span><span class="mi">1</span>
        <span class="n">pt</span> <span class="o">=</span> <span class="n">bezier</span><span class="x">(</span><span class="n">u</span><span class="x">,</span> <span class="n">p1</span><span class="x">,</span> <span class="n">cp1</span><span class="x">,</span> <span class="n">cp2</span><span class="x">,</span> <span class="n">p2</span><span class="x">)</span>
        <span class="n">circle</span><span class="x">(</span><span class="n">pt</span><span class="x">,</span> <span class="mi">2</span><span class="x">,</span> <span class="x">:</span><span class="n">fill</span><span class="x">)</span>
    <span class="k">end</span>
    <span class="n">sethue</span><span class="x">(</span><span class="s">"red"</span><span class="x">)</span>
    <span class="n">circle</span><span class="o">.</span><span class="x">([</span><span class="n">p1</span><span class="x">,</span> <span class="n">cp1</span><span class="x">,</span> <span class="n">cp2</span><span class="x">,</span> <span class="n">p2</span><span class="x">],</span> <span class="mi">3</span><span class="x">,</span> <span class="x">:</span><span class="n">fill</span><span class="x">)</span>
    <span class="n">setline</span><span class="x">(</span><span class="mi">1</span><span class="x">)</span>
    <span class="n">line</span><span class="x">(</span><span class="n">p1</span><span class="x">,</span> <span class="n">cp1</span><span class="x">,</span> <span class="x">:</span><span class="n">stroke</span><span class="x">)</span>
    <span class="n">line</span><span class="x">(</span><span class="n">p2</span><span class="x">,</span> <span class="n">cp2</span><span class="x">,</span> <span class="x">:</span><span class="n">stroke</span><span class="x">)</span>
    <span class="n">sethue</span><span class="x">(</span><span class="s">"black"</span><span class="x">)</span>
    <span class="n">fontsize</span><span class="x">(</span><span class="mi">6</span><span class="x">)</span>
    <span class="n">setline</span><span class="x">(</span><span class="mf">0.5</span><span class="x">)</span>
    <span class="n">drawcurvature</span><span class="x">(</span><span class="n">BezierPathSegment</span><span class="x">(</span><span class="n">p1</span><span class="x">,</span> <span class="n">cp1</span><span class="x">,</span> <span class="n">cp2</span><span class="x">,</span> <span class="n">p2</span><span class="x">),</span>
        <span class="n">scale</span><span class="o">=</span><span class="mi">1500</span><span class="x">,</span>
        <span class="n">stepby</span><span class="o">=</span><span class="mf">0.005</span><span class="x">)</span>
<span class="k">end</span> <span class="mi">600</span> <span class="mi">500</span> <span class="s">"images/bezier/drawcurvaturecomb.png"</span></code></pre></figure>

<p><img src="/images/bezier/drawcurvaturecomb.png" alt="drawing the curvature comb" /></p>

<p>Users of CAD systems (particularly industrial designers) like to display these <em>curvature combs</em> (in both 2D and 3D) to make sure that their shapes don’t introduce noticeably abrupt (and possible weak) transitions. Type designers use them too, but as usual they like to let their eyes have the final say.</p>

<figure class="highlight"><pre><code class="language-julia" data-lang="julia"><span class="nd">@png</span> <span class="n">begin</span>
    <span class="n">background</span><span class="x">(</span><span class="s">"gray30"</span><span class="x">)</span>
    <span class="n">fontface</span><span class="x">(</span><span class="s">"Times-BoldItalic"</span><span class="x">)</span>
    <span class="n">translate</span><span class="x">(</span><span class="o">-</span><span class="mi">250</span><span class="x">,</span> <span class="mi">80</span><span class="x">)</span>
    <span class="n">fontsize</span><span class="x">(</span><span class="mi">300</span><span class="x">)</span>
    <span class="n">textpath</span><span class="x">(</span><span class="s">"julia"</span><span class="x">)</span>
    <span class="n">bpaths</span> <span class="o">=</span> <span class="n">pathtobezierpaths</span><span class="x">()</span>
    <span class="n">sethue</span><span class="x">(</span><span class="s">"gray60"</span><span class="x">)</span>
    <span class="k">for</span> <span class="n">bpath</span> <span class="k">in</span> <span class="n">bpaths</span>
        <span class="k">for</span> <span class="n">bpseg</span> <span class="k">in</span> <span class="n">bpath</span>
            <span class="n">setline</span><span class="x">(</span><span class="mf">0.5</span><span class="x">)</span>
            <span class="n">drawbezierpath</span><span class="x">(</span><span class="n">bpseg</span><span class="x">,</span> <span class="x">:</span><span class="n">stroke</span><span class="x">)</span>
            <span class="n">setline</span><span class="x">(</span><span class="mf">0.25</span><span class="x">)</span>
            <span class="n">drawcurvature</span><span class="x">(</span><span class="n">bpseg</span><span class="x">,</span>
                <span class="n">scale</span><span class="o">=</span><span class="mi">180</span><span class="x">,</span>
                <span class="n">stepby</span><span class="o">=</span><span class="mf">0.05</span><span class="x">,</span>
                <span class="n">colors</span><span class="o">=</span><span class="x">[</span><span class="s">"gold"</span><span class="x">,</span> <span class="s">"cyan"</span><span class="x">])</span>
        <span class="k">end</span>
    <span class="k">end</span>
<span class="k">end</span> <span class="mi">800</span> <span class="mi">500</span> <span class="s">"images/bezier/typecomb.png"</span></code></pre></figure>

<p><img src="/images/bezier/typecomb.png" alt="curvature comb for the g" /></p>

<p>The dots over the ‘i’ and ‘j’ don’t look like perfect circles; these are defined by 8 points, not 4, for some reason.</p>

<h3 id="osculate-my-béziers">Osculate my Béziers</h3>

<p>The value of kappa is typically very small, so the <em>radius of curvature</em>, which is defined as <script type="math/tex">\frac{1}{kappa}</script>, can become very large. This radius value defines a circle that just touches the curve and follows the curvature at that point. Mathematicians, in typically romantic mood, call it the <em>osculating circle</em>, <em>osculate</em> being from the Latin noun <em>osculum</em>, meaning “kiss”.</p>

<p>Drawing osculating circles can be a challenge; they grow very large when the curve looks flat. To be honest it’s a tricky diagram to style up, and there’s a lot of information that it would be cool to keep and a shame to throw away. There’s quite a bit of osculation going on here…</p>

<figure class="highlight"><pre><code class="language-julia" data-lang="julia"><span class="nd">@png</span> <span class="n">begin</span>
    <span class="n">p1</span>  <span class="o">=</span> <span class="n">Point</span><span class="x">(</span><span class="o">-</span><span class="mi">400</span><span class="x">,</span> <span class="mi">60</span><span class="x">)</span>
    <span class="n">cp1</span> <span class="o">=</span> <span class="n">Point</span><span class="x">(</span><span class="o">-</span><span class="mi">300</span><span class="x">,</span> <span class="o">-</span><span class="mi">400</span><span class="x">)</span>
    <span class="n">cp2</span> <span class="o">=</span> <span class="n">Point</span><span class="x">(</span><span class="mi">250</span><span class="x">,</span> <span class="mi">300</span><span class="x">)</span>
    <span class="n">p2</span>  <span class="o">=</span> <span class="n">Point</span><span class="x">(</span><span class="mi">200</span><span class="x">,</span> <span class="o">-</span><span class="mi">100</span><span class="x">)</span>
    <span class="n">background</span><span class="x">(</span><span class="s">"pink"</span><span class="x">)</span>
    <span class="n">scale</span><span class="x">(</span><span class="mf">0.75</span><span class="x">)</span>
    <span class="k">for</span> <span class="n">u</span> <span class="k">in</span> <span class="mi">0</span><span class="x">:</span><span class="mf">0.001</span><span class="x">:</span><span class="mi">1</span>
        <span class="n">pt</span> <span class="o">=</span> <span class="n">bezier</span><span class="x">(</span><span class="n">u</span><span class="x">,</span> <span class="n">p1</span><span class="x">,</span> <span class="n">cp1</span><span class="x">,</span> <span class="n">cp2</span><span class="x">,</span> <span class="n">p2</span><span class="x">)</span>
        <span class="n">circle</span><span class="x">(</span><span class="n">pt</span><span class="x">,</span> <span class="mi">4</span><span class="x">,</span> <span class="x">:</span><span class="n">fill</span><span class="x">)</span>
    <span class="k">end</span>
    <span class="n">sethue</span><span class="x">(</span><span class="s">"red"</span><span class="x">)</span>
    <span class="n">circle</span><span class="o">.</span><span class="x">([</span><span class="n">p1</span><span class="x">,</span> <span class="n">cp1</span><span class="x">,</span> <span class="n">cp2</span><span class="x">,</span> <span class="n">p2</span><span class="x">],</span> <span class="mi">5</span><span class="x">,</span> <span class="x">:</span><span class="n">fill</span><span class="x">)</span>
    <span class="n">setline</span><span class="x">(</span><span class="mi">2</span><span class="x">)</span>
    <span class="n">line</span><span class="x">(</span><span class="n">p1</span><span class="x">,</span> <span class="n">cp1</span><span class="x">,</span> <span class="x">:</span><span class="n">stroke</span><span class="x">)</span>
    <span class="n">line</span><span class="x">(</span><span class="n">p2</span><span class="x">,</span> <span class="n">cp2</span><span class="x">,</span> <span class="x">:</span><span class="n">stroke</span><span class="x">)</span>
    <span class="n">setopacity</span><span class="x">(</span><span class="mf">0.1</span><span class="x">)</span> <span class="x">;</span> <span class="n">setline</span><span class="x">(</span><span class="mf">1.5</span><span class="x">)</span> <span class="x">;</span> <span class="n">fontsize</span><span class="x">(</span><span class="mi">5</span><span class="x">)</span>
    <span class="k">for</span> <span class="n">pointofcontact</span> <span class="k">in</span> <span class="mf">0.0</span><span class="x">:</span><span class="mf">0.015</span><span class="x">:</span><span class="mf">1.0</span>
        <span class="n">kappa</span> <span class="o">=</span> <span class="n">beziercurvature</span><span class="x">(</span><span class="n">pointofcontact</span><span class="x">,</span> <span class="n">p1</span><span class="x">,</span> <span class="n">cp1</span><span class="x">,</span> <span class="n">cp2</span><span class="x">,</span> <span class="n">p2</span><span class="x">)</span>
        <span class="n">pt</span> <span class="o">=</span> <span class="n">bezier</span><span class="x">(</span><span class="n">pointofcontact</span><span class="x">,</span> <span class="n">p1</span><span class="x">,</span> <span class="n">cp1</span><span class="x">,</span> <span class="n">cp2</span><span class="x">,</span> <span class="n">p2</span><span class="x">)</span>
        <span class="nd">@layer</span> <span class="n">begin</span>
            <span class="n">setopacity</span><span class="x">(</span><span class="mf">1.0</span><span class="x">)</span>
            <span class="n">sethue</span><span class="x">(</span><span class="s">"black"</span><span class="x">)</span>
            <span class="n">circle</span><span class="x">(</span><span class="n">pt</span><span class="x">,</span> <span class="mi">5</span><span class="x">,</span> <span class="x">:</span><span class="n">fill</span><span class="x">)</span>
        <span class="k">end</span>
        <span class="n">pt1</span> <span class="o">=</span> <span class="n">bezier′</span><span class="x">(</span><span class="n">pointofcontact</span><span class="x">,</span> <span class="n">p1</span><span class="x">,</span> <span class="n">cp1</span><span class="x">,</span> <span class="n">cp2</span><span class="x">,</span> <span class="n">p2</span><span class="x">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="x">(</span><span class="n">pt1</span><span class="o">.</span><span class="n">y</span><span class="o">/</span><span class="n">pt1</span><span class="o">.</span><span class="n">x</span><span class="x">)</span> <span class="c"># normal is 1/slope</span>
        <span class="n">radius</span> <span class="o">=</span> <span class="n">abs</span><span class="x">(</span><span class="mi">1</span><span class="o">/</span><span class="n">kappa</span><span class="x">)</span>
        <span class="n">centrepoint</span> <span class="o">=</span> <span class="n">pt</span> <span class="o">+</span> <span class="n">polar</span><span class="x">(</span><span class="n">radius</span><span class="x">,</span> <span class="n">atan</span><span class="x">(</span><span class="n">s</span><span class="x">))</span>
        <span class="k">if</span> <span class="n">radius</span> <span class="o">&lt;</span> <span class="mi">600</span>
            <span class="n">sign</span><span class="x">(</span><span class="n">kappa</span><span class="x">)</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">?</span> <span class="n">sethue</span><span class="x">(</span><span class="s">"plum1"</span><span class="x">)</span> <span class="x">:</span> <span class="n">sethue</span><span class="x">(</span><span class="s">"mediumpurple"</span><span class="x">)</span>
            <span class="n">circle</span><span class="x">(</span><span class="n">centrepoint</span><span class="x">,</span> <span class="n">radius</span><span class="x">,</span> <span class="x">:</span><span class="n">fill</span><span class="x">)</span>
            <span class="nd">@layer</span> <span class="n">begin</span>
                <span class="n">setopacity</span><span class="x">(</span><span class="mi">1</span><span class="x">)</span>
                <span class="n">setline</span><span class="x">(</span><span class="mf">0.25</span><span class="x">)</span>
                <span class="n">sethue</span><span class="x">(</span><span class="s">"black"</span><span class="x">)</span>
                <span class="n">fontsize</span><span class="x">(</span><span class="mi">12</span><span class="x">)</span>
                <span class="n">circle</span><span class="x">(</span><span class="n">centrepoint</span><span class="x">,</span> <span class="n">radius</span><span class="x">,</span> <span class="x">:</span><span class="n">stroke</span><span class="x">)</span>
                <span class="n">circle</span><span class="x">(</span><span class="n">centrepoint</span><span class="x">,</span> <span class="mi">2</span><span class="x">,</span> <span class="x">:</span><span class="n">fill</span><span class="x">)</span>
                <span class="n">line</span><span class="x">(</span><span class="n">centrepoint</span><span class="x">,</span> <span class="n">pt</span><span class="x">,</span> <span class="x">:</span><span class="n">stroke</span><span class="x">)</span>
                <span class="n">text</span><span class="x">(</span><span class="n">string</span><span class="x">(</span><span class="n">round</span><span class="x">(</span><span class="mi">1</span><span class="o">/</span><span class="n">kappa</span><span class="x">,</span> <span class="mi">2</span><span class="x">)),</span> <span class="n">centrepoint</span><span class="x">)</span>
            <span class="k">end</span>
        <span class="k">else</span>
            <span class="n">text</span><span class="x">(</span><span class="s">"too big"</span><span class="x">,</span> <span class="n">pt</span><span class="x">)</span>
        <span class="k">end</span>
    <span class="k">end</span>
<span class="k">end</span> <span class="mi">800</span> <span class="mi">800</span> <span class="s">"images/bezier/osculate.png"</span></code></pre></figure>

<p><img src="/images/bezier/osculate.png" alt="osculating" /></p>

<h2 id="a-blot-on-the-landscape">A blot on the landscape</h2>

<p>Bézier curves became popular because they allow us to specify gently curving shapes that would be impractical and cumbersome to specify with circular arcs. The Comprehensive Taxonomy of Irregular Amoeboid Shapes is perhaps still waiting to be written, but here’s my contribution to the ‘random ink blot’ chapter. Sometimes you’ll get lucky and get a nice one.</p>

<figure class="highlight"><pre><code class="language-julia" data-lang="julia"><span class="k">function</span><span class="nf"> blot</span><span class="x">(;</span><span class="n">pos</span><span class="o">=</span><span class="n">O</span><span class="x">,</span> <span class="n">radius</span><span class="o">=</span><span class="mi">50</span><span class="x">,</span> <span class="n">npoints</span><span class="o">=</span><span class="mi">10</span><span class="x">,</span> <span class="n">action</span><span class="o">=</span><span class="x">:</span><span class="n">fill</span><span class="x">)</span>
    <span class="n">center</span> <span class="o">=</span> <span class="n">pos</span>
    <span class="n">pts</span> <span class="o">=</span> <span class="n">ngon</span><span class="x">(</span><span class="n">pos</span><span class="x">,</span> <span class="n">radius</span><span class="x">,</span> <span class="n">npoints</span><span class="x">,</span> <span class="n">vertices</span><span class="o">=</span><span class="n">true</span><span class="x">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="mi">1</span><span class="x">:</span><span class="n">length</span><span class="x">(</span><span class="n">pts</span><span class="x">)</span>
        <span class="n">pts</span><span class="x">[</span><span class="n">i</span><span class="x">]</span> <span class="o">=</span> <span class="n">pts</span><span class="x">[</span><span class="n">i</span><span class="x">]</span> <span class="o">+</span> <span class="x">(</span><span class="n">rand</span><span class="x">(</span><span class="o">-</span><span class="n">radius</span><span class="o">/</span><span class="mi">3</span><span class="x">:</span><span class="n">radius</span><span class="o">/</span><span class="mi">3</span><span class="x">),</span> <span class="n">rand</span><span class="x">(</span><span class="o">-</span><span class="n">radius</span><span class="o">/</span><span class="mi">3</span><span class="x">:</span><span class="n">radius</span><span class="o">/</span><span class="mi">3</span><span class="x">))</span>
    <span class="k">end</span>
    <span class="n">bezpath</span> <span class="o">=</span> <span class="n">makebezierpath</span><span class="x">(</span><span class="n">pts</span><span class="x">)</span>
    <span class="k">for</span> <span class="n">n</span> <span class="k">in</span> <span class="mi">1</span><span class="x">:</span><span class="n">length</span><span class="x">(</span><span class="n">bezpath</span><span class="x">)</span>
        <span class="n">bezseg</span> <span class="o">=</span> <span class="n">bezpath</span><span class="x">[</span><span class="n">mod1</span><span class="x">(</span><span class="n">n</span><span class="x">,</span> <span class="n">length</span><span class="x">(</span><span class="n">bezpath</span><span class="x">))]</span>
        <span class="k">if</span> <span class="n">isodd</span><span class="x">(</span><span class="n">n</span><span class="x">)</span>
            <span class="n">j</span> <span class="o">=</span> <span class="n">rand</span><span class="x">(</span><span class="mf">1.4</span><span class="x">:</span><span class="mf">0.1</span><span class="x">:</span><span class="mi">7</span><span class="x">)</span>
            <span class="n">bezseg</span><span class="o">.</span><span class="n">cp1</span> <span class="o">=</span> <span class="n">between</span><span class="x">(</span><span class="n">center</span><span class="x">,</span> <span class="n">bezseg</span><span class="o">.</span><span class="n">p1</span><span class="x">,</span> <span class="n">j</span><span class="x">)</span>
            <span class="n">bezseg</span><span class="o">.</span><span class="n">cp2</span> <span class="o">=</span> <span class="n">between</span><span class="x">(</span><span class="n">center</span><span class="x">,</span> <span class="n">bezseg</span><span class="o">.</span><span class="n">p2</span><span class="x">,</span> <span class="n">j</span><span class="x">)</span>
        <span class="k">else</span>
            <span class="n">j</span> <span class="o">=</span> <span class="n">rand</span><span class="x">(</span><span class="mf">0.25</span><span class="x">:</span><span class="mf">0.1</span><span class="x">:</span><span class="mf">0.7</span><span class="x">)</span>
            <span class="n">bezseg</span><span class="o">.</span><span class="n">cp1</span> <span class="o">=</span> <span class="n">between</span><span class="x">(</span><span class="n">center</span><span class="x">,</span> <span class="n">bezseg</span><span class="o">.</span><span class="n">p1</span><span class="x">,</span> <span class="n">j</span><span class="x">)</span>
            <span class="n">bezseg</span><span class="o">.</span><span class="n">cp2</span> <span class="o">=</span> <span class="n">between</span><span class="x">(</span><span class="n">center</span><span class="x">,</span> <span class="n">bezseg</span><span class="o">.</span><span class="n">p2</span><span class="x">,</span> <span class="n">j</span><span class="x">)</span>
        <span class="k">end</span>
    <span class="k">end</span>
    <span class="n">drawbezierpath</span><span class="x">(</span><span class="n">bezpath</span><span class="x">,</span> <span class="n">action</span><span class="x">)</span>
    <span class="k">return</span> <span class="n">bezpath</span>
<span class="k">end</span>

<span class="nd">@png</span> <span class="n">begin</span>
    <span class="n">sethue</span><span class="x">(</span><span class="s">"midnightblue"</span><span class="x">)</span>
    <span class="n">blot</span><span class="x">(</span><span class="n">npoints</span><span class="o">=</span><span class="mi">10</span><span class="x">)</span>
    <span class="n">circle</span><span class="o">.</span><span class="x">([</span><span class="n">Point</span><span class="x">(</span><span class="n">rand</span><span class="x">(</span><span class="o">-</span><span class="mi">200</span><span class="x">:</span><span class="mi">200</span><span class="x">),</span> <span class="n">rand</span><span class="x">(</span><span class="o">-</span><span class="mi">200</span><span class="x">:</span><span class="mi">200</span><span class="x">))</span> <span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="mi">1</span><span class="x">:</span><span class="mi">15</span><span class="x">],</span> <span class="n">rand</span><span class="x">(</span><span class="mi">1</span><span class="x">:</span><span class="mf">0.1</span><span class="x">:</span><span class="mi">15</span><span class="x">,</span> <span class="mi">15</span><span class="x">),</span> <span class="x">:</span><span class="n">fill</span><span class="x">)</span>
<span class="k">end</span> <span class="mi">800</span> <span class="mi">500</span> <span class="s">"images/bezier/blot.png"</span></code></pre></figure>

<p><img src="/images/bezier/blot.png" alt="blot" /></p>

<p>The control handles of alternate points are positioned on a line from the center to the point.</p>

<p>You could analyse the curvature of these blobs, if you really wanted to, using the <code class="highlighter-rouge">drawcurvature()</code> function from earlier:</p>

<figure class="highlight"><pre><code class="language-julia" data-lang="julia"><span class="nd">@png</span> <span class="n">begin</span>
    <span class="n">pl</span> <span class="o">=</span> <span class="n">box</span><span class="x">(</span><span class="n">BoundingBox</span><span class="x">(),</span> <span class="n">vertices</span><span class="o">=</span><span class="n">true</span><span class="x">)</span>
    <span class="n">mesh1</span> <span class="o">=</span> <span class="n">mesh</span><span class="x">(</span><span class="n">pl</span><span class="x">,</span> <span class="x">[</span><span class="s">"purple"</span><span class="x">,</span> <span class="s">"blue"</span><span class="x">,</span> <span class="s">"yellow"</span><span class="x">,</span> <span class="s">"orange"</span><span class="x">])</span>
    <span class="n">setmesh</span><span class="x">(</span><span class="n">mesh1</span><span class="x">)</span>
    <span class="n">paint</span><span class="x">()</span>
    <span class="n">setopacity</span><span class="x">(</span><span class="mf">0.8</span><span class="x">)</span>
    <span class="n">sethue</span><span class="x">(</span><span class="s">"orange"</span><span class="x">)</span>
    <span class="n">setline</span><span class="x">(</span><span class="mi">5</span><span class="x">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">blot</span><span class="x">(</span><span class="n">radius</span><span class="o">=</span><span class="mi">80</span><span class="x">,</span> <span class="n">npoints</span><span class="o">=</span><span class="mi">8</span><span class="x">,</span> <span class="n">action</span><span class="o">=</span><span class="x">:</span><span class="n">stroke</span><span class="x">)</span>
    <span class="n">drawbezierpath</span><span class="x">(</span><span class="n">b</span><span class="x">,</span> <span class="x">:</span><span class="n">fill</span><span class="x">)</span>
    <span class="n">setline</span><span class="x">(</span><span class="o">.</span><span class="mi">25</span><span class="x">)</span>
    <span class="n">drawcurvature</span><span class="o">.</span><span class="x">(</span><span class="n">b</span><span class="x">,</span> <span class="n">colors</span><span class="o">=</span><span class="x">[</span><span class="s">"white"</span><span class="x">,</span> <span class="s">"black"</span><span class="x">])</span>
<span class="k">end</span> <span class="mi">800</span> <span class="mi">500</span> <span class="s">"images/bezier/blobcomb.png"</span></code></pre></figure>

<p><img src="/images/bezier/blobcomb.png" alt="blob comb" /></p>

<h2 id="a-brush-in-the-rough">A brush in the rough</h2>

<p>Not all lines generated by computers have to be rigidly straight and precise. What if we could easily make graphics that are a bit more relaxed in style, rather than the rigid CAD-like (and yes, awesome) precision graphics we’re used to?</p>

<figure class="highlight"><pre><code class="language-julia" data-lang="julia"><span class="nd">@png</span> <span class="n">begin</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">Table</span><span class="x">(</span><span class="mi">1</span><span class="x">,</span> <span class="mi">3</span><span class="x">)</span>
    <span class="n">box</span><span class="x">(</span><span class="n">t</span><span class="x">[</span><span class="mi">1</span><span class="x">],</span> <span class="mi">160</span><span class="x">,</span> <span class="mi">160</span><span class="x">,</span> <span class="x">:</span><span class="n">stroke</span><span class="x">)</span>
    <span class="n">boxv</span> <span class="o">=</span> <span class="n">box</span><span class="x">(</span><span class="n">t</span><span class="x">[</span><span class="mi">3</span><span class="x">],</span> <span class="mi">160</span><span class="x">,</span> <span class="mi">160</span><span class="x">,</span> <span class="n">vertices</span><span class="o">=</span><span class="n">true</span><span class="x">)</span>
    <span class="n">foreach</span><span class="x">((</span><span class="n">f</span><span class="x">,</span> <span class="n">t</span><span class="x">)</span> <span class="o">-&gt;</span>
        <span class="n">brush</span><span class="x">(</span><span class="n">f</span><span class="x">,</span> <span class="n">t</span><span class="x">,</span> <span class="mi">3</span><span class="x">),</span>
           <span class="n">boxv</span><span class="x">[</span><span class="mi">1</span><span class="x">:</span><span class="mi">4</span><span class="x">],</span>
           <span class="n">boxv</span><span class="x">[</span><span class="n">mod1</span><span class="o">.</span><span class="x">(</span><span class="mi">2</span><span class="x">:</span><span class="mi">5</span><span class="x">,</span> <span class="mi">4</span><span class="x">)])</span>
<span class="k">end</span> <span class="mi">800</span> <span class="mi">300</span> <span class="s">"images/bezier/lines.png"</span></code></pre></figure>

<p><img src="/images/bezier/lines.png" alt="rough lines" /></p>

<h2 id="a-line-is-a-breadthless-length-euclid">“A line is a breadthless length.” (Euclid)</h2>

<p>The idea here is that a single line between two points is replaced with some BezierPathSegments that together define a shape that can vary in thickness along its length. This shape can be then filled, and is independent of the set line thickness.</p>

<figure class="highlight"><pre><code class="language-julia" data-lang="julia"><span class="nd">@png</span> <span class="n">begin</span>
    <span class="n">setline</span><span class="x">(</span><span class="mi">60</span><span class="x">)</span> <span class="c"># &lt;— pointless</span>
    <span class="n">brush</span><span class="x">(</span><span class="n">O</span> <span class="o">-</span> <span class="x">(</span><span class="mi">250</span><span class="x">,</span> <span class="mi">0</span><span class="x">),</span> <span class="n">O</span> <span class="o">+</span> <span class="x">(</span><span class="mi">250</span><span class="x">,</span> <span class="mi">0</span><span class="x">),</span> <span class="mi">4</span><span class="x">,</span> <span class="n">strokes</span><span class="o">=</span><span class="mi">1</span><span class="x">)</span>
<span class="k">end</span> <span class="mi">800</span> <span class="mi">50</span>  <span class="s">"images/bezier/brushline1.png"</span></code></pre></figure>

<p><img src="/images/bezier/brushline1.png" alt="brush line" /></p>

<p>The experimental <code class="highlighter-rouge">brush()</code> function is bristling with built-in randomness, so you never know what you’re going to get. There are some control knobs available which you can play with.</p>

<figure class="highlight"><pre><code class="language-julia" data-lang="julia"><span class="nd">@png</span> <span class="n">begin</span>
    <span class="n">brush</span><span class="x">(</span><span class="n">O</span> <span class="o">-</span> <span class="x">(</span><span class="mi">250</span><span class="x">,</span> <span class="mi">0</span><span class="x">),</span> <span class="n">O</span> <span class="o">+</span> <span class="x">(</span><span class="mi">250</span><span class="x">,</span> <span class="mi">0</span><span class="x">),</span> <span class="mi">5</span><span class="x">,</span>
        <span class="n">strokes</span><span class="o">=</span><span class="mi">15</span><span class="x">,</span>
        <span class="n">twist</span><span class="o">=</span><span class="mi">4</span><span class="x">)</span>
<span class="k">end</span> <span class="mi">800</span> <span class="mi">50</span>  <span class="s">"images/bezier/brushline2.png"</span></code></pre></figure>

<p><img src="/images/bezier/brushline2.png" alt="brush line 2" /></p>

<p>To be honest, I think it’s a bit daft to abandon the machine-like precision that our graphics software usually gives us for this variable hand-made look.</p>

<figure class="highlight"><pre><code class="language-julia" data-lang="julia"><span class="n">using</span> <span class="n">Iterators</span>
<span class="nd">@png</span> <span class="n">begin</span>
    <span class="n">background</span><span class="x">(</span><span class="s">"gray20"</span><span class="x">)</span>
    <span class="n">sethue</span><span class="x">(</span><span class="s">"ivory"</span><span class="x">)</span>
    <span class="k">for</span> <span class="n">ss</span> <span class="k">in</span> <span class="n">subsets</span><span class="x">(</span><span class="n">ngon</span><span class="x">(</span><span class="n">O</span><span class="x">,</span> <span class="mi">250</span><span class="x">,</span> <span class="mi">13</span><span class="x">,</span> <span class="n">vertices</span><span class="o">=</span><span class="n">true</span><span class="x">),</span> <span class="mi">2</span><span class="x">)</span>
        <span class="c"># line(ss[1], ss[2], :stroke) # use this line for accurate graphics</span>
        <span class="n">brush</span><span class="x">(</span><span class="n">ss</span><span class="x">[</span><span class="mi">1</span><span class="x">],</span> <span class="n">ss</span><span class="x">[</span><span class="mi">2</span><span class="x">],</span> <span class="mi">4</span><span class="x">,</span>
            <span class="n">strokes</span><span class="o">=</span><span class="mi">1</span><span class="x">,</span>
            <span class="n">minwidth</span><span class="o">=</span><span class="mf">0.001</span><span class="x">,</span>
            <span class="n">maxwidth</span><span class="o">=</span><span class="mf">0.05</span><span class="x">,</span>
            <span class="n">lowhandle</span><span class="o">=</span><span class="mf">0.1</span><span class="x">,</span>
            <span class="n">highhandle</span><span class="o">=.</span><span class="mi">2</span><span class="x">,</span>
            <span class="n">randomopacity</span><span class="o">=</span><span class="n">true</span><span class="x">)</span>
    <span class="k">end</span>
<span class="k">end</span> <span class="mi">800</span> <span class="mi">600</span>  <span class="s">"images/bezier/linepartition.png"</span></code></pre></figure>

<p><img src="/images/bezier/linepartition.png" alt="line partition" /></p>

<p>Today, our relationship with mechanical production and product design is inconsistent; some of the things we desire we want to be hand-made, but others we’d prefer to be machine-made. Only the most expensive cars claim to be made ‘by hand’; the cheaper models flaunt their nanometre precision instead. Hipsters seek the authentic analogue roughness of the products of the Second Industrial age, but are secretly grateful for and rely on the smooth precisions afforded by the Third. Handmade shoes yes, handmode iPhones, no.</p>

<p>There are a number of plotting packages that offer a hand-drawn aesthetic—<a href="http://xkcdgraphs.com">this site</a> is web-based. So you can definitely announce your latest scientific discovery using XKCD-style presentation graphics. There are XKCD-styling kits for most of the software used by people who have heard of XKCD.</p>

<figure class="highlight"><pre><code class="language-julia" data-lang="julia"><span class="nd">@png</span> <span class="n">begin</span>
    <span class="n">background</span><span class="x">(</span><span class="s">"bisque"</span><span class="x">)</span>
    <span class="n">sethue</span><span class="x">(</span><span class="s">"gray60"</span><span class="x">)</span>
    <span class="n">setopacity</span><span class="x">(</span><span class="mf">0.1</span><span class="x">)</span>
    <span class="n">blot</span><span class="x">(</span><span class="n">pos</span><span class="o">=</span><span class="n">O</span> <span class="o">+</span> <span class="x">(</span><span class="o">-</span><span class="mi">10</span><span class="x">,</span> <span class="o">-</span><span class="mi">50</span><span class="x">),</span> <span class="n">radius</span><span class="o">=</span><span class="mi">100</span><span class="x">)</span>
    <span class="n">sethue</span><span class="x">(</span><span class="s">"springgreen2"</span><span class="x">)</span>
    <span class="n">brush</span><span class="x">(</span><span class="n">O</span> <span class="o">+</span> <span class="x">(</span><span class="mi">20</span><span class="x">,</span> <span class="mi">270</span><span class="x">),</span> <span class="n">O</span> <span class="o">+</span> <span class="x">(</span><span class="mi">0</span><span class="x">,</span> <span class="o">-</span><span class="mi">270</span><span class="x">),</span> <span class="mi">3</span><span class="x">)</span> <span class="c"># wonk y-axis</span>
    <span class="n">brush</span><span class="x">(</span><span class="n">O</span> <span class="o">-</span> <span class="x">(</span><span class="mi">350</span><span class="x">,</span> <span class="mi">0</span><span class="x">),</span> <span class="n">O</span> <span class="o">+</span> <span class="x">(</span><span class="mi">350</span><span class="x">,</span> <span class="mi">10</span><span class="x">),</span> <span class="mi">3</span><span class="x">)</span>  <span class="c"># wonk x-axis</span>

    <span class="n">sine</span> <span class="o">=</span> <span class="x">[(</span><span class="n">Point</span><span class="x">(</span><span class="mi">50</span><span class="n">x</span><span class="x">,</span> <span class="o">-</span><span class="mi">200</span><span class="n">sin</span><span class="x">(</span><span class="n">x</span><span class="x">)),</span> <span class="n">Point</span><span class="x">(</span><span class="mi">50</span><span class="x">(</span><span class="n">x</span> <span class="o">+</span> <span class="nb">pi</span><span class="o">/</span><span class="mi">6</span><span class="x">),</span> <span class="o">-</span><span class="mi">200</span><span class="n">sin</span><span class="x">(</span><span class="n">x</span> <span class="o">+</span> <span class="nb">pi</span><span class="o">/</span><span class="mi">6</span><span class="x">)))</span> <span class="k">for</span> <span class="n">x</span> <span class="k">in</span> <span class="o">-</span><span class="mi">2</span><span class="nb">pi</span><span class="x">:</span><span class="nb">pi</span><span class="o">/</span><span class="mi">10</span><span class="x">:</span><span class="mi">2</span><span class="nb">pi</span><span class="x">]</span>

    <span class="n">sethue</span><span class="x">(</span><span class="s">"pink1"</span><span class="x">)</span>
    <span class="n">brush</span><span class="x">(</span><span class="n">Point</span><span class="x">(</span><span class="o">-</span><span class="mi">300</span><span class="x">,</span> <span class="o">-</span><span class="mi">200</span><span class="x">),</span> <span class="n">Point</span><span class="x">(</span><span class="mi">300</span><span class="x">,</span> <span class="o">-</span><span class="mi">200</span><span class="x">),</span> <span class="mf">0.5</span><span class="x">)</span>

    <span class="n">sethue</span><span class="x">(</span><span class="s">"mediumorchid"</span><span class="x">)</span>
    <span class="n">foreach</span><span class="x">(</span><span class="n">pr</span> <span class="o">-&gt;</span> <span class="n">brush</span><span class="x">(</span><span class="n">pr</span><span class="x">[</span><span class="mi">1</span><span class="x">],</span> <span class="n">pr</span><span class="x">[</span><span class="mi">2</span><span class="x">],</span> <span class="n">twist</span><span class="o">=</span><span class="mi">5</span><span class="x">,</span> <span class="n">highhandle</span><span class="o">=</span><span class="mi">4</span><span class="x">,</span> <span class="n">strokes</span><span class="o">=</span><span class="mi">3</span><span class="x">),</span> <span class="n">sine</span><span class="x">)</span>
<span class="k">end</span> <span class="mi">800</span> <span class="mi">600</span> <span class="s">"images/bezier/graph.png"</span></code></pre></figure>

<p><img src="/images/bezier/graph.png" alt="a graph" /></p>

<p>Unfortunately you’ve got the imprecise finish <em>without</em> the reassuring and lovable hand-made quirks. Like those imitation hand-writing fonts, it’s presenting the illusion of manual labour.</p>

<figure class="highlight"><pre><code class="language-julia" data-lang="julia"><span class="nd">@png</span> <span class="n">begin</span>
    <span class="n">fontsize</span><span class="x">(</span><span class="mi">30</span><span class="x">)</span>
    <span class="n">fontface</span><span class="x">(</span><span class="s">"SnellRoundhand-Script"</span><span class="x">)</span>
    <span class="n">text</span><span class="x">(</span><span class="s">"pint of milk   cat food   stamps   something for dinner? "</span><span class="x">,</span> <span class="n">halign</span><span class="o">=</span><span class="x">:</span><span class="n">center</span><span class="x">)</span>
<span class="k">end</span> <span class="mi">800</span> <span class="mi">100</span> <span class="s">"images/bezier/shoppinglist.png"</span></code></pre></figure>

<p><img src="/images/bezier/shoppinglist.png" alt="a shopping list" /></p>

<h2 id="a-fist-full-of-brushes">A fist full of brushes</h2>

<p>But it’s always fun to explore an idea to see where it leads:</p>

<figure class="highlight"><pre><code class="language-julia" data-lang="julia"><span class="nd">@png</span> <span class="n">begin</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">Table</span><span class="x">(</span><span class="mi">5</span><span class="x">,</span> <span class="mi">5</span><span class="x">,</span> <span class="mi">130</span><span class="x">,</span> <span class="mi">100</span><span class="x">)</span>
    <span class="n">l</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">colwidths</span><span class="x">[</span><span class="mi">1</span><span class="x">]</span>
    <span class="n">fontsize</span><span class="x">(</span><span class="mi">4</span><span class="x">)</span>
    <span class="k">for</span> <span class="x">(</span><span class="n">pos</span><span class="x">,</span> <span class="n">n</span><span class="x">)</span> <span class="k">in</span> <span class="n">t</span>
        <span class="n">weight</span> <span class="o">=</span> <span class="n">rand</span><span class="x">(</span><span class="mi">0</span><span class="x">:</span><span class="mi">2</span><span class="x">:</span><span class="mi">20</span><span class="x">)</span>
        <span class="n">strokes</span> <span class="o">=</span> <span class="n">rand</span><span class="x">(</span><span class="mi">1</span><span class="x">:</span><span class="mi">20</span><span class="x">)</span>
        <span class="n">minwidth</span><span class="o">=</span><span class="n">rand</span><span class="x">(</span><span class="mf">0.0</span><span class="x">:</span><span class="mf">0.1</span><span class="x">:</span><span class="mf">0.3</span><span class="x">)</span>
        <span class="n">maxwidth</span><span class="o">=</span><span class="n">rand</span><span class="x">(</span><span class="n">minwidth</span><span class="o">+</span><span class="mf">0.1</span><span class="x">:</span><span class="mf">0.1</span><span class="x">:</span><span class="n">minwidth</span><span class="o">+</span><span class="mf">0.3</span><span class="x">)</span>
        <span class="n">twist</span> <span class="o">=</span> <span class="n">rand</span><span class="x">(</span><span class="o">-</span><span class="mi">10</span><span class="x">:</span><span class="mi">10</span><span class="x">)</span>
        <span class="n">randomopacity</span> <span class="o">=</span> <span class="n">rand</span><span class="x">(</span><span class="kt">Bool</span><span class="x">)</span>
        <span class="n">lowhandle</span> <span class="o">=</span> <span class="n">rand</span><span class="x">(</span><span class="mf">0.0</span><span class="x">:</span><span class="mf">0.1</span><span class="x">:</span><span class="mf">0.5</span><span class="x">)</span>
        <span class="n">highhandle</span> <span class="o">=</span> <span class="n">rand</span><span class="x">(</span><span class="n">lowhandle</span><span class="x">:</span><span class="mf">0.1</span><span class="x">:</span><span class="n">lowhandle</span><span class="o">+.</span><span class="mi">5</span><span class="x">)</span>
        <span class="n">tidystart</span> <span class="o">=</span> <span class="n">rand</span><span class="x">(</span><span class="kt">Bool</span><span class="x">)</span>
        <span class="nd">@layer</span> <span class="n">begin</span>
            <span class="n">translate</span><span class="x">(</span><span class="n">pos</span><span class="x">)</span>
            <span class="n">rotate</span><span class="x">(</span><span class="o">-</span><span class="mf">0.2</span><span class="x">)</span>
            <span class="n">randomhue</span><span class="x">()</span>
            <span class="n">brush</span><span class="x">(</span><span class="n">O</span> <span class="o">-</span> <span class="x">(</span><span class="n">l</span><span class="o">/</span><span class="mi">2</span><span class="x">,</span> <span class="mi">0</span><span class="x">),</span> <span class="n">O</span> <span class="o">+</span> <span class="x">(</span><span class="n">l</span><span class="o">/</span><span class="mi">2</span><span class="x">,</span> <span class="mi">0</span><span class="x">),</span> <span class="n">weight</span><span class="x">,</span>
                <span class="n">strokes</span><span class="o">=</span><span class="n">strokes</span><span class="x">,</span>
                <span class="n">minwidth</span><span class="o">=</span><span class="n">minwidth</span><span class="x">,</span>
                <span class="n">maxwidth</span><span class="o">=</span><span class="n">maxwidth</span><span class="x">,</span>
                <span class="n">lowhandle</span><span class="o">=</span><span class="n">lowhandle</span><span class="x">,</span>
                <span class="n">highhandle</span><span class="o">=</span><span class="n">highhandle</span><span class="x">,</span>
                <span class="n">twist</span><span class="o">=</span><span class="n">twist</span><span class="x">,</span>
                <span class="n">randomopacity</span><span class="o">=</span><span class="n">randomopacity</span><span class="x">,</span>
                <span class="n">tidystart</span><span class="o">=</span><span class="n">tidystart</span><span class="x">)</span>
        <span class="k">end</span>

        <span class="n">textwrap</span><span class="x">(</span><span class="s">"weight: </span><span class="si">$</span><span class="s">weight
            strokes: </span><span class="si">$</span><span class="s">strokes
            minwidth: </span><span class="si">$</span><span class="s">minwidth
            maxwidth </span><span class="si">$</span><span class="s">maxwidth
            twist: </span><span class="si">$</span><span class="s">twist
            randomopacity: </span><span class="si">$</span><span class="s">randomopacity
            tidystart :</span><span class="si">$</span><span class="s">tidystart"</span><span class="x">,</span> <span class="n">t</span><span class="o">.</span><span class="n">colwidths</span><span class="x">[</span><span class="mi">1</span><span class="x">]</span> <span class="o">-</span> <span class="mi">30</span><span class="x">,</span> <span class="n">pos</span> <span class="o">+</span> <span class="x">(</span><span class="o">-</span><span class="n">l</span><span class="o">/</span><span class="mi">2</span><span class="x">,</span> <span class="mi">30</span><span class="x">))</span>
    <span class="k">end</span>

    <span class="n">sethue</span><span class="x">(</span><span class="s">"black"</span><span class="x">)</span>
    <span class="n">fontsize</span><span class="x">(</span><span class="mi">30</span><span class="x">)</span>
    <span class="n">fontface</span><span class="x">(</span><span class="s">"Elephant"</span><span class="x">)</span>
    <span class="n">text</span><span class="x">(</span><span class="s">"brush strokes"</span><span class="x">,</span> <span class="n">boxtop</span><span class="x">(</span><span class="n">BoundingBox</span><span class="x">())</span> <span class="o">+</span> <span class="x">(</span><span class="mi">0</span><span class="x">,</span> <span class="mi">40</span><span class="x">),</span> <span class="n">halign</span><span class="o">=</span><span class="x">:</span><span class="n">center</span><span class="x">)</span>
<span class="k">end</span> <span class="mi">800</span> <span class="mi">600</span> <span class="s">"images/bezier/brushes.png"</span></code></pre></figure>

<p><img src="/images/bezier/brushes.png" alt="a catalog of brushes" /></p>

<p>The line quality can make for simple painterly graphics, good for the occasional <a href="https://en.wikipedia.org/wiki/Bob_Ross">Bob Ross</a> painting:</p>

<figure class="highlight"><pre><code class="language-julia" data-lang="julia"><span class="n">using</span> <span class="n">ColorSchemes</span>
<span class="k">function</span><span class="nf"> drawsunset</span><span class="x">()</span>
    <span class="n">colscheme</span><span class="o">=</span> <span class="n">ColorSchemes</span><span class="o">.</span><span class="n">sunset</span>
    <span class="nd">@png</span> <span class="n">begin</span>
        <span class="n">background</span><span class="x">(</span><span class="s">"burlywood4"</span><span class="x">)</span>
        <span class="n">sethue</span><span class="x">(</span><span class="s">"orange"</span><span class="x">)</span>
        <span class="n">circle</span><span class="x">(</span><span class="n">O</span> <span class="o">+</span> <span class="x">(</span><span class="mi">0</span><span class="x">,</span> <span class="mi">60</span><span class="x">),</span> <span class="mi">60</span><span class="x">,</span> <span class="x">:</span><span class="n">fill</span><span class="x">)</span>
        <span class="n">setopacity</span><span class="x">(</span><span class="mf">0.5</span><span class="x">)</span>
        <span class="k">for</span> <span class="n">y</span> <span class="k">in</span> <span class="o">-</span><span class="mi">200</span><span class="x">:</span><span class="mi">20</span><span class="x">:</span><span class="mi">180</span>
            <span class="n">sethue</span><span class="x">(</span><span class="n">get</span><span class="x">(</span><span class="n">colscheme</span><span class="x">,</span> <span class="n">rescale</span><span class="x">(</span><span class="n">y</span><span class="x">,</span> <span class="o">-</span><span class="mi">200</span><span class="x">,</span> <span class="mi">180</span><span class="x">,</span> <span class="mi">1</span><span class="x">,</span> <span class="mi">0</span><span class="x">)))</span>
            <span class="k">for</span> <span class="n">w</span> <span class="k">in</span> <span class="mi">10</span><span class="x">:</span><span class="mi">5</span><span class="x">:</span><span class="mi">20</span>
                <span class="n">brush</span><span class="x">(</span><span class="n">Point</span><span class="x">(</span><span class="o">-</span><span class="mi">350</span><span class="x">,</span> <span class="n">y</span><span class="x">),</span> <span class="n">Point</span><span class="x">(</span><span class="mi">350</span><span class="x">,</span> <span class="n">y</span><span class="x">),</span> <span class="n">w</span><span class="x">,</span>
                    <span class="n">strokes</span> <span class="o">=</span> <span class="mi">1</span><span class="x">,</span>
                    <span class="n">twist</span> <span class="o">=</span> <span class="mi">5</span><span class="x">,</span>
                    <span class="n">minwidth</span><span class="o">=</span><span class="mf">0.02</span><span class="x">,</span>
                    <span class="n">maxwidth</span><span class="o">=</span><span class="mf">0.04</span><span class="x">,</span>
                    <span class="n">randomopacity</span><span class="o">=</span><span class="n">true</span>
                <span class="x">)</span>
            <span class="k">end</span>
        <span class="k">end</span>
        <span class="n">fontsize</span><span class="x">(</span><span class="mi">30</span><span class="x">)</span>
        <span class="n">fontface</span><span class="x">(</span><span class="s">"Pique-Black"</span><span class="x">)</span>
        <span class="n">text</span><span class="x">(</span><span class="s">"Sunset over Luxor"</span><span class="x">,</span> <span class="n">Point</span><span class="x">(</span><span class="mi">0</span><span class="x">,</span> <span class="mi">230</span><span class="x">),</span> <span class="n">halign</span><span class="o">=</span><span class="x">:</span><span class="n">center</span><span class="x">)</span>
    <span class="k">end</span> <span class="mi">800</span> <span class="mi">500</span> <span class="s">"images/bezier/sunset.png"</span>
<span class="k">end</span>
<span class="n">drawsunset</span><span class="x">()</span></code></pre></figure>

<p><img src="/images/bezier/sunset.png" alt="sunset over luxor" /></p>

<p>Each time you evaluate this the result is slightly different, yet always the same. Perhaps the next one will be better — wait, no, perhaps I preferred the previous one…</p>

<p>And because we started in France, let’s paint some graffiti:</p>

<figure class="highlight"><pre><code class="language-julia" data-lang="julia"><span class="k">function</span><span class="nf"> drawfrenchflag</span><span class="x">()</span>
    <span class="n">w</span><span class="x">,</span> <span class="n">h</span> <span class="o">=</span> <span class="mi">700</span><span class="x">,</span> <span class="mi">400</span>
    <span class="nd">@png</span> <span class="n">begin</span>
        <span class="n">background</span><span class="x">(</span><span class="s">"azure"</span><span class="x">)</span>
        <span class="n">setopacity</span><span class="x">(</span><span class="mf">0.85</span><span class="x">)</span>
        <span class="n">setline</span><span class="x">(</span><span class="mf">0.5</span><span class="x">)</span>
        <span class="n">colscheme</span> <span class="o">=</span> <span class="x">[</span><span class="n">Colors</span><span class="o">.</span><span class="n">RGB</span><span class="o">.</span><span class="x">(</span><span class="n">sethue</span><span class="x">(</span><span class="s">"royalblue1"</span><span class="x">)</span><span class="o">...</span><span class="x">),</span>
        <span class="n">Colors</span><span class="o">.</span><span class="n">RGB</span><span class="o">.</span><span class="x">(</span><span class="n">sethue</span><span class="x">(</span><span class="s">"white"</span><span class="x">)</span><span class="o">...</span><span class="x">),</span>
        <span class="n">Colors</span><span class="o">.</span><span class="n">RGB</span><span class="o">.</span><span class="x">(</span><span class="n">sethue</span><span class="x">(</span><span class="s">"red"</span><span class="x">)</span><span class="o">...</span><span class="x">)]</span>
        <span class="k">for</span> <span class="n">x</span> <span class="k">in</span> <span class="o">-</span><span class="n">w</span><span class="o">/</span><span class="mi">2</span><span class="x">:</span><span class="mi">40</span><span class="x">:</span><span class="n">w</span><span class="o">/</span><span class="mi">2</span>
            <span class="c"># reduce x to 1, 2, or 3, then to [0-1] to get red/white/blue</span>
            <span class="n">col</span> <span class="o">=</span> <span class="n">rescale</span><span class="x">(</span><span class="n">div</span><span class="x">(</span><span class="n">x</span><span class="o">+</span><span class="n">w</span><span class="o">/</span><span class="mi">2</span><span class="x">,</span> <span class="n">w</span><span class="o">/</span><span class="mi">3</span><span class="x">)</span> <span class="o">+</span> <span class="mi">1</span><span class="x">,</span> <span class="mi">1</span><span class="x">,</span> <span class="mi">3</span><span class="x">,</span> <span class="mi">0</span><span class="x">,</span> <span class="mi">1</span><span class="x">)</span>
            <span class="n">sethue</span><span class="x">(</span><span class="n">get</span><span class="x">(</span><span class="n">colscheme</span><span class="x">,</span> <span class="n">col</span><span class="x">))</span>
            <span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="mi">5</span><span class="x">:</span><span class="mi">10</span><span class="x">:</span><span class="mi">50</span>
                <span class="n">brush</span><span class="x">(</span><span class="n">Point</span><span class="x">(</span><span class="n">x</span><span class="x">,</span> <span class="o">-</span><span class="n">h</span><span class="o">/</span><span class="mi">2</span><span class="x">),</span> <span class="n">Point</span><span class="x">(</span><span class="n">x</span><span class="x">,</span> <span class="n">h</span><span class="o">/</span><span class="mi">2</span><span class="x">),</span>
                    <span class="n">i</span><span class="x">,</span>
                    <span class="n">strokes</span><span class="o">=</span><span class="mi">2</span><span class="x">,</span>
                    <span class="n">twist</span><span class="o">=</span><span class="mi">10</span><span class="x">,</span>
                    <span class="n">highhandle</span><span class="o">=</span><span class="mi">1</span><span class="x">)</span>
            <span class="k">end</span>
        <span class="k">end</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">box</span><span class="x">(</span><span class="n">O</span><span class="x">,</span> <span class="mi">675</span><span class="x">,</span> <span class="mi">375</span><span class="x">,</span> <span class="n">vertices</span><span class="o">=</span><span class="n">true</span><span class="x">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="mi">1</span><span class="x">:</span><span class="n">length</span><span class="x">(</span><span class="n">b</span><span class="x">)</span>
            <span class="n">sethue</span><span class="x">(</span><span class="s">"purple"</span><span class="x">)</span>
            <span class="n">brush</span><span class="x">(</span><span class="n">b</span><span class="x">[</span><span class="n">i</span><span class="x">],</span> <span class="n">b</span><span class="x">[</span><span class="n">mod1</span><span class="x">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="x">,</span> <span class="n">length</span><span class="x">(</span><span class="n">b</span><span class="x">))],</span> <span class="mi">30</span><span class="x">,</span>
                <span class="n">strokes</span><span class="o">=</span><span class="mi">20</span><span class="x">,</span>
                <span class="n">minwidth</span><span class="o">=</span><span class="mf">0.01</span><span class="x">,</span>
                <span class="n">maxwidth</span><span class="o">=</span><span class="mf">0.05</span><span class="x">)</span>
        <span class="k">end</span>
        <span class="n">fontface</span><span class="x">(</span><span class="s">"MistralStd"</span><span class="x">)</span>
        <span class="n">setopacity</span><span class="x">(</span><span class="mf">0.7</span><span class="x">)</span>
        <span class="n">sethue</span><span class="x">(</span><span class="s">"purple"</span><span class="x">)</span>
        <span class="n">fontsize</span><span class="x">(</span><span class="mi">100</span><span class="x">)</span>
        <span class="n">text</span><span class="x">(</span><span class="s">"Vive la France!"</span><span class="x">,</span> <span class="n">O</span> <span class="o">+</span> <span class="x">(</span><span class="mi">10</span><span class="x">,</span> <span class="mi">80</span><span class="x">),</span> <span class="n">halign</span><span class="o">=</span><span class="x">:</span><span class="n">center</span><span class="x">,</span> <span class="n">angle</span><span class="o">=-</span><span class="nb">pi</span><span class="o">/</span><span class="mi">10</span><span class="x">)</span>
    <span class="k">end</span> <span class="mi">800</span> <span class="mi">500</span> <span class="s">"images/bezier/frenchflag.png"</span>
<span class="k">end</span>

<span class="n">drawfrenchflag</span><span class="x">()</span></code></pre></figure>

<p><img src="/images/bezier/frenchflag.png" alt="drapeau francais" /></p>

<p>…and then speed off in our curvaceous old Citroen DS and drive to the France/Swiss border, where CERN are busy recreating the big bang:</p>

<figure class="highlight"><pre><code class="language-julia" data-lang="julia"><span class="n">using</span> <span class="n">ColorSchemes</span>
<span class="k">function</span><span class="nf"> unpetitbang</span><span class="x">()</span>
    <span class="nd">@png</span> <span class="n">begin</span>
        <span class="n">background</span><span class="x">(</span><span class="s">"gray10"</span><span class="x">)</span>

        <span class="c"># rays</span>
        <span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="mi">1</span><span class="x">:</span><span class="mi">300</span>
            <span class="n">sethue</span><span class="x">(</span><span class="n">get</span><span class="x">(</span><span class="n">ColorSchemes</span><span class="o">.</span><span class="n">inferno</span><span class="x">,</span> <span class="n">rand</span><span class="x">()))</span>
            <span class="n">rotate</span><span class="x">(</span><span class="n">rand</span><span class="x">())</span>
            <span class="n">brush</span><span class="x">(</span><span class="n">O</span> <span class="o">+</span> <span class="x">(</span><span class="n">rand</span><span class="x">(</span><span class="mi">30</span><span class="x">:</span><span class="mi">500</span><span class="x">),</span> <span class="mi">0</span><span class="x">),</span> <span class="n">O</span> <span class="o">+</span> <span class="x">(</span><span class="n">rand</span><span class="x">(</span><span class="mi">501</span><span class="x">:</span><span class="mi">1000</span><span class="x">),</span> <span class="mi">0</span><span class="x">),</span> <span class="mi">1</span><span class="x">,</span>
                <span class="n">strokes</span><span class="o">=</span><span class="mi">5</span><span class="x">,</span>
                <span class="n">twist</span><span class="o">=</span><span class="n">rand</span><span class="x">(</span><span class="o">-</span><span class="mi">1</span><span class="x">:</span><span class="mf">0.1</span><span class="x">:</span><span class="mi">1</span><span class="x">),</span>
                <span class="n">lowhandle</span>  <span class="o">=</span> <span class="mf">0.0</span><span class="x">,</span>
                <span class="n">highhandle</span> <span class="o">=</span> <span class="mf">0.5</span>
                <span class="x">)</span>
            <span class="n">l</span> <span class="o">=</span> <span class="n">rand</span><span class="x">(</span><span class="mi">100</span><span class="x">:</span><span class="mi">600</span><span class="x">)</span>
            <span class="n">l1</span> <span class="o">=</span> <span class="n">l</span> <span class="o">+</span> <span class="n">rand</span><span class="x">(</span><span class="mi">5</span><span class="x">:</span><span class="mi">50</span><span class="x">)</span>
            <span class="n">sethue</span><span class="x">(</span><span class="s">"white"</span><span class="x">)</span>
            <span class="n">brush</span><span class="x">(</span><span class="n">O</span> <span class="o">+</span> <span class="x">(</span><span class="n">l</span><span class="x">,</span> <span class="mi">0</span><span class="x">),</span> <span class="n">O</span> <span class="o">+</span> <span class="x">(</span><span class="n">l1</span><span class="x">,</span> <span class="mi">0</span><span class="x">),</span> <span class="mi">1</span><span class="x">,</span>
                <span class="n">strokes</span><span class="o">=</span><span class="mi">10</span><span class="x">,</span>
                <span class="n">twist</span><span class="o">=</span><span class="n">rand</span><span class="x">(</span><span class="o">-</span><span class="mi">1</span><span class="x">:</span><span class="mf">0.1</span><span class="x">:</span><span class="mi">1</span><span class="x">),</span>
                <span class="n">lowhandle</span>  <span class="o">=</span> <span class="mf">0.0</span><span class="x">,</span>
                <span class="n">highhandle</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="x">)</span>
        <span class="k">end</span>

        <span class="c"># plasmas</span>
        <span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="mi">1</span><span class="x">:</span><span class="mi">20</span>
            <span class="n">sethue</span><span class="x">(</span><span class="n">get</span><span class="x">(</span><span class="n">ColorSchemes</span><span class="o">.</span><span class="n">plasma</span><span class="x">,</span> <span class="n">rand</span><span class="x">()))</span>
            <span class="n">setopacity</span><span class="x">(</span><span class="n">rand</span><span class="x">(</span><span class="mf">0.25</span><span class="x">:</span><span class="o">.</span><span class="mi">05</span><span class="x">:</span><span class="mf">0.75</span><span class="x">))</span>
            <span class="n">rotate</span><span class="x">(</span><span class="n">rand</span><span class="x">())</span>
            <span class="n">brush</span><span class="x">(</span><span class="n">O</span> <span class="o">-</span> <span class="x">(</span><span class="mi">20</span><span class="x">,</span> <span class="mi">0</span><span class="x">),</span> <span class="n">O</span> <span class="o">+</span> <span class="x">(</span><span class="mi">20</span><span class="x">,</span> <span class="mi">0</span><span class="x">),</span> <span class="mi">20</span><span class="x">,</span>
                <span class="n">maxwidth</span> <span class="o">=</span> <span class="mi">10</span><span class="x">,</span>
                <span class="n">highhandle</span> <span class="o">=</span> <span class="mi">10</span><span class="x">)</span>
        <span class="k">end</span>

        <span class="c"># orbits</span>
        <span class="n">sethue</span><span class="x">(</span><span class="s">"ivory"</span><span class="x">)</span>
        <span class="n">setline</span><span class="x">(</span><span class="mf">0.5</span><span class="x">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="mi">1</span><span class="x">:</span><span class="mi">10</span>
            <span class="n">rotate</span><span class="x">(</span><span class="n">rand</span><span class="x">())</span>
            <span class="n">brush</span><span class="x">(</span><span class="n">O</span> <span class="o">-</span> <span class="x">(</span><span class="mi">0</span><span class="x">,</span> <span class="mi">0</span><span class="x">),</span> <span class="n">O</span> <span class="o">+</span> <span class="x">(</span><span class="mi">50</span><span class="x">,</span> <span class="mi">0</span><span class="x">),</span> <span class="mi">10</span><span class="x">,</span>
                <span class="n">maxwidth</span> <span class="o">=</span> <span class="mi">20</span><span class="x">,</span>
                <span class="n">highhandle</span> <span class="o">=</span> <span class="mi">20</span><span class="x">,</span>
                <span class="n">action</span><span class="o">=</span><span class="x">:</span><span class="n">stroke</span><span class="x">)</span>
        <span class="k">end</span>

    <span class="k">end</span> <span class="mi">1000</span> <span class="mi">1000</span> <span class="s">"images/bezier/unpetitbang.png"</span>
<span class="k">end</span>
<span class="n">unpetitbang</span><span class="x">()</span></code></pre></figure>

<p><img src="/images/bezier/unpetitbang.png" alt="un petit bang" /></p>

<p>[2018-06-20]</p>

<h3 id="footnotes">Footnotes</h3>

<h4 id="don-lancaster"><em>Don Lancaster</em></h4>

<p>Don Lancaster is the totally awesome dude who was active in the very early days of personal computing, and probably knows more about PostScript than most of the current Adobe Systems employees put together. Travel back in time by visiting his wacky website at http://www.tinaja.com.</p>

<h4 id="graphic-formats"><em>Graphic formats</em></h4>

<p>All the images in this post are in PNG, but they looked better in the vector-based SVG format. However, there’s an annoying ‘bug’ in Jupyter/IJulia/IPython involving text in SVG images created by Cairo. What happens is that Cairo tries to be smart and stores text in XML symbols, suitable for re-use. A good idea, but unfortunately they’re stored in the notebook’s ‘global XML scope’, and so later cells accidentally pick up symbol definitions from earlier cells and re-use them, even though that’s not always what you want. A solution would be to somehow encapsulate the SVG image in a cell to prevent the definitions leaking. I don’t know how to do that yet, but there’s an <a href="https://github.com/JuliaLang/IJulia.jl/issues/662">open issue</a> if you can help me find a workround…</p>

<p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p>

<p><img src="http://steampiano.net/cormullionknot.gif?bezier" alt="cormullion signing off" class="center-image" /></p>

  </div><a class="u-url" href="/blog/2018/06/21/bezier.html" hidden></a>
</article>

      </div>
    </main><footer>
<pre class="smallheading">comments or questions - open an issue at <a href="https://github.com/cormullion/cormullion.github.io">github.com/cormullion/</a></pre>
</footer>
</body>

</html>
